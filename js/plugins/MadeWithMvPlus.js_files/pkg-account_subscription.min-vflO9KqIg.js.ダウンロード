define("modules/clean/account_page/tabs/billing",["require","exports","tslib","modules/clean/event_handler","modules/core/browser","modules/clean/payments/billing_info_modal","modules/clean/dbmodal_stack","modules/clean/deprecated/dbmodal_loading","external/react","external/react-redux","modules/clean/react/css","modules/core/i18n","modules/clean/web_timing_logger","modules/clean/account_page/util","modules/clean/teams/admin/lib/billing_history","modules/clean/account_page/widgets/billing/payment_methods_util","modules/clean/account_page/widgets/billing/action_creators","modules/clean/account_page/widgets/plan/action_creators","modules/clean/account_page/widgets/plan/add_ons/action_creators","modules/clean/teams/admin/widgets/billing_history/billing_history_table","modules/clean/account_page/widgets/plan/views/cancel_subs_warning_modal","modules/clean/account_page/widgets/plan/views/change_schedule_modal","modules/clean/account_page/widgets/plan/views/disable_stacked_transitions_modal","modules/clean/react/payments/edit_invoice_address_modal/edit_invoice_address_modal_loader","modules/clean/react/payments/update_billing_individual/individual_update_billing_modal_loader","modules/clean/account_page/components/key_value_block","modules/clean/account_page/widgets/billing/views/license_keys","modules/clean/account_page/components/loading","modules/clean/payments/skus/constants","modules/constants/account_page","modules/constants/trademark","modules/clean/analytics","modules/clean/payments/validation","modules/clean/payments/skus/subscription_status"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m,h,_,g,f,b,y,S,v,E,P,C,w,T,N,x,I,k,L,A,D){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var M=function(e){return{billingInfo:e.billingInfo.billingInfo,loadingState:e.billingInfo.loadingState,dataLoadedForTTI:"ready"===e.billingInfo.loadingState}},B=function(e){return{loadBillingInfo:function(t){return void 0===t&&(t=!1),e(g.loadDataIfNecessary(t))},loadPlanDataIfNecessary:function(t){return void 0===t&&(t=!1),e(f.loadDataIfNecessary(t))},loadEvhInfoIfNecessary:function(t){return void 0===t&&(t=!1),e(b.loadEvhInfoIfNecessary(t))}}},O=(function(e){function t(t){var n=e.call(this,t)||this;return n.handlePaymentUpdate=function(){L.ProEventsLogger.log("de_billing_tab_update_payment_method_click"),n.props.billingInfo.scheduled_for_downgrade?S.CancelChangesModalConfirmation.showInstance({transitionPerformed:n.reloadData,subStatus:n.subStatus}):C.IndividualUpdateBillingModalLoader.showInstance()},n.handlePaymentAdd=function(){L.ProEventsLogger.log("de_billing_tab_add_payment_method_click"),l.DBModalStack.push(new o({element_id:"add_billing_info",endpoint_url:"/add_billing_info_modal",html_in_error_msg:!0}))},n.handlePaymentAddToResubscribe=function(){L.ProEventsLogger.log("de_billing_tab_add_payment_method_resubscribe_click"),l.DBModalStack.push(new o({element_id:"update_billing_info",endpoint_url:"/billing_info_modal",html_in_error_msg:!0,parameters:{resubscribe:!0}}))},n.reloadData=function(){var e=n.props,t=e.loadBillingInfo,a=e.loadPlanDataIfNecessary,i=e.loadEvhInfoIfNecessary;t(!0),i(!0),a(!0)},n.handleBillingChange=function(){L.ProEventsLogger.log("de_billing_tab_change_billing_modal_open");var e=n.props.billingInfo,t=e.payment_info,a=e.scheduled_for_downgrade;if(I.NO_RESET_INTERVAL_FOR_USERS&&I.DE_DISABLE_STACKED_TRANSITIONS&&n.pendingScheduledChange())return void E.DisableStackedTransitionsModal.showInstance();a?S.CancelChangesModalConfirmation.showInstance({transitionPerformed:n.reloadData,subStatus:n.subStatus}):v.ChangeScheduleModalView.showInstance({transitionPerformed:n.reloadData,paymentInfo:t})},n.onEditInvoiceDetailsClick=function(){L.ProEventsLogger.log("de_billing_tab_edit_invoice_modal_open"),P.EditInvoiceAddressModalLoader.showUpdateTaxProfileModal(!1,n.onInvoiceDetailsUpdated)},n.onInvoiceDetailsUpdated=function(){n.props.loadBillingInfo(!0)},n.renderLicenseKeys=function(){return s.createElement("div",{className:"account-page-block"},s.createElement(T.LicenseKeys,{licenseKeys:n.props.billingInfo.license_keys}))},n.renderBillingHistory=function(){var e=n.props.billingInfo,t=e.transactions,a=e.show_edit_invoice_modal,i=e.edit_past_invoices,r=[],l=!1;return null!==t&&t.transactions.length>0&&(r=h.getHistoryData(t.transactions),l=r.length>3,r=r.slice(0,3)),s.createElement("div",{className:"account-page-block"},s.createElement("span",{className:"account-page-block__heading"},d._("Billing history")),s.createElement("p",{className:"account-page-block__subtext"},d._("View invoices and receipts for all payments made on your Dropbox account.")),s.createElement("div",{className:"billing-table-container"},s.createElement(y.BillingHistoryTable,{billingHistoryRecords:r,amountLabel:d._("Amount"),displayNoTransactionsOnEmptyRecords:!0,showEditInvoiceModal:a&&i,noTransactionLabel:d._("No transaction history"),footer:n.buildFooter(l),logAccountBillingTabEvents:!0,isTeam:!1})))},n.buildFooter=function(e){if(e)return s.createElement("tr",{className:"billing-history-row"},s.createElement("td",{colSpan:4,className:"billing-history-col"},s.createElement("a",{href:"/payments",target:"_blank",rel:"noopener noreferrer",onClick:n.logViewAll},d._("View all billing history"))))},n.logViewAll=function(){L.ProEventsLogger.log("de_billing_tab_view_all_click")},n.renderPaymentMethod=function(){if(n.user.paid){var e=n.props.billingInfo.payment_info,t=e.gateway_id,a=e.expiration_date,i=e.description,r=e.is_external_billing,l=e.end_date,o=e.deactivated,c=e.is_on_trial,u=e.reseller_name,p=e.reseller_link;if(r){var m=d._("Go to %(reseller_name)s to view or make changes to your account details").format({reseller_name:u}),h=s.createElement("a",{href:p,target:"_blank",rel:"noopener noreferrer"},m);return s.createElement(w.KeyValueBlock,{keyText:h})}if(t!==-1){if(!_.shouldHidePaymentMethod(t)&&!n.props.billingInfo.payment_method)return s.createElement(w.KeyValueBlock,{className:"add-payment",keyText:d._("You can add your payment information now to have           your subscription automatically renew when it expires"),linkText:d._("Add"),onLinkClick:n.handlePaymentAddToResubscribe});if(_.isLicenseKey(t))return s.createElement("div",{className:"account-page-block"},s.createElement(w.KeyValueBlock,{keyText:d._("Payment method"),subtext:d._("Add your payment information now to have           your subscription automatically renew when it expires"),linkText:d._("Add payment method"),onLinkClick:n.handlePaymentAdd}));if(_.shouldHidePaymentMethod(t)){var g=_.getPaymentMethodDisabledMessage(t,r,k.TRADEMARK_PLUS,l,o,c);return s.createElement(w.KeyValueBlock,{keyText:g})}var f=i;return null!==a&&(f=d._("%(payment_description)s, exp: %(expiration_date)s").format({payment_description:i,expiration_date:a,comment:'Payment description is a card information, already translated           (ex> Visa ending in 2543). Date is in format MM / YYYY ( ex> 08 / 2017 ).           An example translated string is "Visa ending in 2543, exp: 08 / 2017 ).'})),s.createElement(w.KeyValueBlock,{keyText:d._("Payment method"),valueText:f,linkText:d._("Update"),onLinkClick:n.handlePaymentUpdate})}}},n.renderBillingPeriod=function(){if(n.user.paid){var e=n.props.billingInfo,t=e.payment_info,a=e.scheduled_for_downgrade;if(!_.shouldHideBillingChange(t.gateway_id,t.is_external_billing)&&t.period){if(!t.schedule_switchable&&!a&&!n.isProfessionalTrialPlan)return s.createElement(w.KeyValueBlock,{keyText:d._("Sorry, you cannot change your billing schedule at this time.")});var i=d._("Plan billed %(period)s").format({period:t.period});return s.createElement(w.KeyValueBlock,{keyText:d._("Billing period"),valueText:i,linkText:d._("Change"),onLinkClick:n.handleBillingChange})}}},n.renderInvoiceDetails=function(){var e=n.props.billingInfo,t=e.show_edit_invoice_modal,a=e.payment_info,i=e.payment_method,r=e.has_invoice_details;if(n.user.paid&&t&&!_.shouldHideBillingChange(a.gateway_id,a.is_external_billing)&&a.period){var l=d._("Add details to your invoice, such as company name and address."),o=null;void 0!==i&&(o=i.country_code),o&&A.hasVat(o)&&(l=d._("Add details to your invoice, such as company name, address, and VAT ID."));var c=d._("Update");return r||(c=d._("Add invoice details")),s.createElement(w.KeyValueBlock,{keyText:d._("Invoice details"),linkText:c,subtext:l,onLinkClick:n.onEditInvoiceDetailsClick})}},n.user=m.getCurrentUser(),l.DBModalStack.register(r.BILLING_INFO_UPDATED,function(){L.ProEventsLogger.log("de_payment_modal_save_click"),n.props.loadBillingInfo(!0),n.props.loadPlanDataIfNecessary(!0)}),n}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;this.props.loadBillingInfo(),this.checkTTIstate(),L.ProEventsLogger.log("de_billing_tab_view"),this.events.on(window,"hashchange",function(){e.displayResubscribeBillingModal(),e.displayUpdateBillingModal()}),this.displayResubscribeBillingModal(),this.displayUpdateBillingModal()},t.prototype.componentDidUpdate=function(){this.checkTTIstate()},t.prototype.displayUpdateBillingModal=function(){var e=i.get_hash();if(void 0!==e&&e.search("billing_info")!==-1&&e.search("resubscribe_billing_info")===-1){if(!this.user.paid)return;C.IndividualUpdateBillingModalLoader.showInstance()}},t.prototype.displayResubscribeBillingModal=function(){var e=i.get_hash();void 0!==e&&e.search("resubscribe_billing_info")!==-1&&C.IndividualUpdateBillingModalLoader.showInstance()},Object.defineProperty(t.prototype,"subStatus",{get:function(){var e=this.props.billingInfo.serialized_sub_status;if(e)return D.SubscriptionStatus.deserialize(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isProfessionalTrialPlan",{get:function(){return!(!this.subStatus||!this.subStatus.subState.plan)&&this.subStatus.subState.plan.productType===x.ProductPlanType.PROFESSIONAL_TRIAL},enumerable:!0,configurable:!0}),t.prototype.pendingScheduledChange=function(){return this.isPlanScheduledToChange()||this.isBillingScheduleToChange()||this.isEvhScheduledToChange()},t.prototype.isPlanScheduledToChange=function(){var e=this.subStatus;return!!this.props.billingInfo||!!(e&&e.subState.plan&&e.finalSubState.plan)&&e.subState.plan.productType!==e.finalSubState.plan.productType},t.prototype.isEvhScheduledToChange=function(){var e=this.subStatus;return!(!e||!e.scheduledSubState)&&e.subState.quantityForEvhAddOn()!==e.scheduledSubState.quantityForEvhAddOn()},t.prototype.isBillingScheduleToChange=function(){var e=this.subStatus;return!!(e&&e.subState.billingSchedule&&e.finalSubState.billingSchedule)&&e.subState.billingSchedule.id!==e.finalSubState.billingSchedule.id},t.prototype.checkTTIstate=function(){this.props.dataLoadedForTTI&&(p.mark_time_to_view(),p.mark_time_to_interactive())},t.prototype.isLoading=function(){return"ready"!==this.props.loadingState},t.prototype.render=function(){return this.isLoading()?s.createElement(N.Loading,null):s.createElement("div",{className:"account-page-tab"},this.renderPaymentMethod(),this.renderBillingPeriod(),this.renderInvoiceDetails(),this.renderLicenseKeys(),this.renderBillingHistory())},t=n.__decorate([a.eventHandler],t)})(s.Component),R=c.connect(M,B)(O);t.BillingTab=u(R,["/static/css/account/pagelet/billing_tab-vflb68jtJ.css","/static/css/plan_management-vfl04dPHk.css"])}),define("modules/clean/account_page/tabs/plan",["require","exports","tslib","external/react","modules/clean/account_page/widgets/plan/views/plan_container"],function(e,t,n,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return a.createElement(i.PlanContainer,null)},t})(a.Component);t.PlanTab=r}),define("modules/clean/account_page/widgets/billing/action_creators",["require","exports","tslib","modules/clean/account_page/widgets/billing/api","modules/clean/account_page/util"],function(e,t,n,a,i){"use strict";function r(e){var t=this;return void 0===e&&(e=!1),function(r,l){return n.__awaiter(t,void 0,void 0,function(){var t;return n.__generator(this,function(n){switch(n.label){case 0:return"never_loaded"===l().billingInfo.loadingState||e?(r({type:"billing_info_load"}),[4,a.getBillingInfo(i.getCurrentUser().id)]):[3,2];case 1:return t=n.sent(),r({type:"billing_info_loaded",billingInfo:t}),[2,!0];case 2:return[2,!1]}})})}}Object.defineProperty(t,"__esModule",{value:!0}),t.loadDataIfNecessary=r}),define("modules/clean/account_page/widgets/billing/api",["require","exports","modules/clean/ajax_as_promised"],function(e,t,n){"use strict";function a(e){return n.WebRequest({url:"/account/ajax_billing_tab_model",subject_user:e,dataType:"json"})}Object.defineProperty(t,"__esModule",{value:!0}),t.getBillingInfo=a}),define("modules/clean/account_page/widgets/billing/views/license_keys",["require","exports","tslib","modules/core/i18n","modules/core/browser","external/react","modules/clean/react/css","modules/clean/account_page/components/account_table","modules/clean/account_page/components/key_value_block"],function(e,t,n,a,i,r,l,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(t){var n=e.call(this,t)||this;return n.licenseRowsIncrement=3,n.handleRedeemClick=function(){i.redirect("/pro/redeem_key")},n.buildLicenseFooter=function(){if(n.state.showViewMore)return r.createElement("tr",{className:"license-footer-row"},r.createElement("td",{colSpan:4},r.createElement("a",{onClick:n.showMoreLicense,href:"",rel:"noopener noreferrer"},a._("View more license keys"))))},n.showMoreLicense=function(e){e.preventDefault(),n.setState(function(e,t){var a=e.maxShow+n.licenseRowsIncrement;return{maxShow:a,showViewMore:a<t.licenseKeys.length}})},n.buildStatus=function(e){return e.activated?a._("Activated on %(activated_date)s").format({activated_date:e.activated_date}):a._("Scheduled for future use")},n.buildDuration=function(e){return e.duration?e.duration:a._("N/A")},n.buildLicenseKeyTable=function(){var e=n.props.licenseKeys;if(0!==e.length)return r.createElement("div",{className:"license-table-container"},r.createElement(o.Table,{className:"license-table"},r.createElement(o.TableHead,null,r.createElement(o.HeaderRow,{className:"license-header-row"},r.createElement(o.HeaderCell,{className:"license-key-header"},a._("Key")),r.createElement(o.HeaderCell,{className:"license-redeemed-header"},a._("Redeemed")),r.createElement(o.HeaderCell,{className:"license-duration-header"},a._("Duration")),r.createElement(o.HeaderCell,{className:"license-status-header"},a._("Status")))),r.createElement(o.TableFooter,{className:"license-footer"},n.buildLicenseFooter()),r.createElement(o.TableBody,null,e.map(function(e,t){if(!(t>=n.state.maxShow))return r.createElement(o.BodyRow,{className:"license-body-row "+(e.activated?"activated":"unused"),key:e.key},r.createElement(o.BodyCell,{className:"license-key"},e.key),r.createElement(o.BodyCell,{className:"license-redeemded"},e.redeemed_date),r.createElement(o.BodyCell,{className:"license-duration"},n.buildDuration(e)),r.createElement(o.BodyCell,{className:"license-status"},n.buildStatus(e)))}))))},n.state={maxShow:3,showViewMore:!1},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.setState(function(e,t){return{showViewMore:e.maxShow<t.licenseKeys.length}})},t.prototype.render=function(){return r.createElement("div",{className:"license-keys"},r.createElement(s.KeyValueBlock,{className:"redeem-license-key",keyText:a._("License keys"),linkText:a._("Redeem a license key"),onLinkClick:this.handleRedeemClick,subtext:a._("License keys will be applied before any other form of payment method")}),this.buildLicenseKeyTable())},t})(r.Component);t.LicenseKeys=l(c,["/static/css/account/pagelet/license_keys-vfltd2Jh8.css"])}),define("modules/clean/account_page/widgets/plan/action_creators",["require","exports","tslib","modules/clean/account_page/widgets/plan/api","modules/clean/account_page/util"],function(e,t,n,a,i){"use strict";function r(e){var t=this;return function(r,l){return n.__awaiter(t,void 0,void 0,function(){var t;return n.__generator(this,function(n){switch(n.label){case 0:return"never_loaded"===l().planTab.loadingState||e?(r({type:"plan_tab_load_info"}),[4,a.getPlanInfo(i.getCurrentUser().id)]):[3,2];case 1:return t=n.sent(),r({type:"plan_tab_info_loaded",planInfo:t}),[2,!0];case 2:return[2,!1]}})})}}Object.defineProperty(t,"__esModule",{value:!0}),t.loadDataIfNecessary=r}),define("modules/clean/account_page/widgets/plan/add_ons/action_creators",["require","exports","tslib","modules/clean/account_page/util","modules/clean/account_page/widgets/plan/add_ons/api"],function(e,t,n,a,i){"use strict";function r(e){var t=this;return function(r,l){return n.__awaiter(t,void 0,void 0,function(){var t;return n.__generator(this,function(n){switch(n.label){case 0:return"never_loaded"===l().planTab.evhLoadingState||e?(r({type:"load_evh_info"}),[4,i.getEvhInfo(a.getCurrentUser().id)]):[3,2];case 1:return t=n.sent(),r({type:"evh_info_loaded",evhInfo:t}),[2,!0];case 2:return[2,!1]}})})}}Object.defineProperty(t,"__esModule",{value:!0}),t.loadEvhInfoIfNecessary=r}),define("modules/clean/account_page/widgets/plan/add_ons/api",["require","exports","tslib","modules/clean/ajax_as_promised"],function(e,t,n,a){"use strict";function i(e){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(t){return[2,a.WebRequest({url:"/account/ajax_get_evh_info",subject_user:e,dataType:"json"})]})})}Object.defineProperty(t,"__esModule",{value:!0}),t.getEvhInfo=i}),define("modules/clean/account_page/widgets/plan/api",["require","exports","tslib","modules/clean/ajax_as_promised"],function(e,t,n,a){"use strict";function i(e){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(t){return[2,a.WebRequest({url:"/account/ajax_plan_tab_model",subject_user:e,dataType:"json"})]})})}Object.defineProperty(t,"__esModule",{value:!0}),t.getPlanInfo=i}),define("modules/clean/account_page/widgets/plan/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CHANGE_IND_PLAN_MODAL_UPDATED="change_inv_plan_modal:updated"}),define("modules/clean/account_page/widgets/plan/plan_spectrum/action_creators",["require","exports","tslib","modules/clean/account_page/util","modules/clean/growth/gating"],function(e,t,n,a,i){"use strict";function r(e){var t=this;return function(r,l){return n.__awaiter(t,void 0,void 0,function(){var t;return n.__generator(this,function(n){switch(n.label){case 0:return"never_loaded"===l().planTab.planSpectrumLoadingState||e?(r({type:"plan_spectrum_load_info"}),[4,i.growthCheckGating(a.getCurrentUser(),"uj_plan_spectrum_upsell")]):[3,2];case 1:return t=n.sent(),r({type:"plan_spectrum_info_loaded",planSpectrumInfo:t}),[2,!0];case 2:return[2,!1]}})})}}Object.defineProperty(t,"__esModule",{value:!0}),t.loadPlanSpectrum=r}),define("modules/clean/account_page/widgets/plan/plan_spectrum/types",["require","exports","tslib","modules/clean/growth/user_action/tracker"],function(e,t,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e.BasicView="uj_plan_spectrum_upsell_basic_user_view",e.BasicPlusClick="uj_plan_spectrum_upsell_basic_user_plus_click",e.BasicProClick="uj_plan_spectrum_upsell_basic_user_pro_click",e.BasicUpgradeClick="uj_plan_spectrum_upsell_basic_user_upgrade_click",e.PlusView="uj_plan_spectrum_upsell_plus_user_view",e.PlusProClick="uj_plan_spectrum_upsell_plus_user_pro_click",e.PlusChangePlanClick="uj_plan_spectrum_upsell_plus_user_change_plan_click"})(t.PlanSpectrumActions||(t.PlanSpectrumActions={}));(function(e){e.Basic="basic",e.Plus="plus",e.Professional="pro"})(t.PlanType||(t.PlanType={}));var i=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.project="uj_plan_spectrum_upsell",t}return n.__extends(t,e),t})(a.GrowthUserActionTracker);t.PlanSpectrumTracker=i}),define("modules/clean/account_page/widgets/plan/referral_history/action_creators",["require","exports","tslib","modules/clean/account_page/util","modules/clean/account_page/widgets/plan/referral_history/api"],function(e,t,n,a,i){"use strict";function r(e,t){var r=this;return function(l,o){return n.__awaiter(r,void 0,void 0,function(){var r;return n.__generator(this,function(n){switch(n.label){case 0:return"never_loaded"===o().planTab.referralLoadingState||e?(l({type:"load_referral_history"}),[4,i.getReferralHistory(a.getCurrentUser().id,t)]):[3,2];case 1:return r=n.sent(),l({type:"referral_history_loaded",history:r}),[2,!0];case 2:return[2,!1]}})})}}Object.defineProperty(t,"__esModule",{value:!0}),t.loadReferralHistoryIfNecessary=r}),define("modules/clean/account_page/widgets/plan/referral_history/api",["require","exports","tslib","modules/clean/ajax_as_promised"],function(e,t,n,a){"use strict";function i(e,t){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){return[2,a.WebRequest({url:"/account/bonus_page/"+t,subject_user:e,dataType:"json"})]})})}Object.defineProperty(t,"__esModule",{value:!0}),t.getReferralHistory=i}),define("modules/clean/account_page/widgets/plan/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.MONTHLY=1]="MONTHLY",e[e.YEARLY=2]="YEARLY",e[e.PLUS=3]="PLUS",e[e.PROFESSIONAL=4]="PROFESSIONAL",e[e.ADD_EVH=5]="ADD_EVH",e[e.REMOVE_EVH=6]="REMOVE_EVH"})(t.PerformPlanTransition||(t.PerformPlanTransition={}))}),define("modules/clean/account_page/widgets/plan/views/add_ons",["require","exports","tslib","modules/core/i18n","modules/clean/react/css","external/react","modules/clean/static_urls","modules/constants/account_page","modules/clean/payments/skus/constants","modules/clean/account_page/widgets/plan/views/cancel_subs_warning_modal","modules/clean/account_page/widgets/plan/views/disable_stacked_transitions_modal","modules/clean/account_page/widgets/plan/views/evh_modal","modules/constants/account_page","modules/clean/analytics"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.openEvhModal=function(e){var a=t.props.scheduledForDowngrade;if(e.stopPropagation(),p.NO_RESET_INTERVAL_FOR_USERS&&p.DE_DISABLE_STACKED_TRANSITIONS&&t.pendingScheduledChange())return void u.DisableStackedTransitionsModal.showInstance();a?c.CancelChangesModalConfirmation.showInstance({transitionPerformed:t.props.transitionPerformed,subStatus:t.props.subStatus}):d.EvhModalView.showInstance(n.__assign({},t.props))},t}return n.__extends(t,e),Object.defineProperty(t.prototype,"evhTitle",{get:function(){return this.props.evhInfo.is_unlimited_evh?a._("Unlimited version history"):a._("Extended version history")},enumerable:!0,configurable:!0}),t.prototype.isLoading=function(){return"ready"!==this.props.evhLoadingState},t.prototype.pendingScheduledChange=function(){return this.isPlanScheduledToChange()||this.isBillingScheduleToChange()||this.isEvhScheduledToChange()},t.prototype.isPlanScheduledToChange=function(){var e=this.props,t=e.subStatus;return!!e.scheduledForDowngrade||!!(t&&t.subState.plan&&t.finalSubState.plan)&&t.subState.plan.productType!==t.finalSubState.plan.productType},t.prototype.isEvhScheduledToChange=function(){var e=this.props.subStatus;return!(!e||!e.scheduledSubState)&&e.subState.quantityForEvhAddOn()!==e.scheduledSubState.quantityForEvhAddOn()},t.prototype.isBillingScheduleToChange=function(){var e=this.props.subStatus;return!!(e&&e.subState.billingSchedule&&e.finalSubState.billingSchedule)&&e.subState.billingSchedule.id!==e.finalSubState.billingSchedule.id},t.prototype.evhLink=function(){var e=this.props.evhInfo,t=e.purchased,n=e.scheduled_to_remove,i=e.is_free_evh;if(!n&&!i){var l=t?a._("Remove EVH"):a._("Add EVH");return t?m.ProEventsLogger.log("de_plan_tab_evh_remove_link_click"):m.ProEventsLogger.log("de_plan_tab_evh_add_link_click"),r.createElement("a",{className:"evh-link",href:"#",onClick:this.openEvhModal},l)}},t.prototype.showExtendedVersionHistory=function(){var e=this.props,t=e.subStatus,n=e.evhInfo;if(t.subState.billingSchedule){var i=a._("One year file version history for %(evh_price)s per %(billing_period)s").format({evh_price:n.evh_price,billing_period:t.subState.billingSchedule.scheduleDescriptionNoun});if(t.subState.addons.peekSkus())switch(t.subState.addons.sku.adminCxId){case s.AdminCxId.UNLIMITED_FREE_VERSION_HISTORY:i=a._("Free unlimited file version history");break;case s.AdminCxId.UNLIMITED_MONTHLY_VERSION_HISTORY:case s.AdminCxId.UNLIMITED_YEARLY_VERSION_HISTORY:case s.AdminCxId.UNLIMITED_PAID_VERSION_HISTORY:i=a._("Unlimited file version history for %(evh_price)s per %(billing_period)s").format({evh_price:n.evh_price,billing_period:t.subState.billingSchedule.scheduleDescriptionNoun});break;case s.AdminCxId.ONE_YEAR_PAID_VERSION_HISTORY:i=a._("One year file version history for %(evh_price)s per %(billing_period)s").format({evh_price:n.evh_price,billing_period:t.subState.billingSchedule.scheduleDescriptionNoun});break;case s.AdminCxId.ONE_YEAR_FREE_VERSION_HISTORY:i=a._("Free one year file version history");break;case s.AdminCxId.FREE_120_DAYS_VERSION_HISTORY:i=a._("Free 120 days file version history");break;default:throw new Error("Unknown extended version history add-on")}return r.createElement("div",{className:"evh-container"},r.createElement("div",{className:"evh-body"},r.createElement("div",{className:"evh-text"},r.createElement("p",{className:"evh-title"},this.evhTitle),r.createElement("p",{className:"evh-content"},i)),this.evhLink()))}},t.prototype.render=function(){var e=this.props.evhInfo.is_available;return o.ACCOUNT_TAURUS_PLANS&&!e?r.createElement("noscript",null):this.isLoading()?r.createElement("div",{className:"loading-indicator"},r.createElement("img",{src:l.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:a._("Loading")})):r.createElement("div",{className:"add-ons"},r.createElement("p",{className:"header"},a._("Available add-ons")),r.createElement("p",{className:"context"},a._("Extend the functionality of your Dropbox plan with add-ons")),this.showExtendedVersionHistory())},t})(r.Component);t.AddOns=i(h,["/static/css/account/pagelet/add_ons-vflZFLEQS.css"])}),define("modules/clean/account_page/widgets/plan/views/cancel_changes_modal",["require","exports","tslib","external/react","modules/clean/ajax","modules/clean/account_page/widgets/plan/constants","modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal","modules/clean/react/modal","modules/clean/analytics","modules/clean/payments/skus/subscription_service","modules/constants/trademark","modules/core/i18n","modules/clean/dbmodal_stack","modules/clean/account_page/util","modules/core/notify"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(t){var n=e.call(this,t)||this;return n.onAccept=function(){var e=n.props.cancellationType;n.cancelScheduledChange(e)},new c.SubscriptionService,n.state={submitting:!1},n}return n.__extends(t,e),t.showInstance=function(e){o.Modal.showInstance(a.createElement(t,n.__assign({},e)))},t.prototype.submittingRequest=function(){this.setState(function(e){return e.submitting=!0,e})},t.prototype.doneSubmittingRequest=function(){this.setState(function(e){return e.submitting=!1,e})},t.prototype.cancelScheduledChange=function(e){var t=this,n=this.props.transitionPerformed;this.submittingRequest(),i.WebRequest({url:"/account/ajax_cancel_scheduled_change",data:{scheduled_change_type:e},subject_user:m.getCurrentUser().id,success:function(a){h.Notify.success(d._("You’ve cancelled your change!")),e===l.CancellationType.SCHEDULE&&s.ProEventsLogger.log("de_change_billing_cancel_change"),e===l.CancellationType.EVH_ADDON&&s.ProEventsLogger.log("de_evh_modal_cancel_change"),n&&n(),t.doneSubmittingRequest(),o.Modal.close(),t.props.reOpenModalDialogAfterCancellation&&p.DBModalStack.trigger(r.CHANGE_IND_PLAN_MODAL_UPDATED,null)},error:function(){h.Notify.error(d._("Failed to cancel changes.")),t.doneSubmittingRequest(),o.Modal.close(),t.props.reOpenModalDialogAfterCancellation&&p.DBModalStack.trigger(r.CHANGE_IND_PLAN_MODAL_UPDATED,null)}})},t.prototype.render=function(){var e=this.props,t=e.cancellationType,n=e.subStatus;if(!n.subState.plan||!n.subState.billingSchedule)return a.createElement("noscript",null);var i,r=d._("Confirm cancelling change");switch(t){case l.CancellationType.PLAN:i=d._("You’re cancelling your scheduled plan change. Your Dropbox %(plan)s plan           will renew on %(date)s and you will be billed %(schedule)s.").format({trademark_plus:u.TRADEMARK_PLUS,plan:n.subState.plan.displayName(),date:n.subState.formattedNextBillingDate,schedule:n.finalSubState.billingSchedule.scheduleDescriptionAdjective});break;case l.CancellationType.SCHEDULE:i=d._("You’re cancelling your scheduled billing change. Your Dropbox %(plan)s plan           will renew on %(date)s and you will be billed %(schedule)s.").format({plan:n.finalSubState.plan.displayName(),date:n.subState.formattedNextBillingDate,schedule:n.subState.billingSchedule.scheduleDescriptionAdjective});break;case l.CancellationType.EVH_ADDON:i=d._("You’re cancelling your EVH changes. Your Dropbox %(plan)s plan           will renew on %(date)s and you will be billed %(schedule)s.").format({plan:n.finalSubState.plan.displayName(),date:n.subState.formattedNextBillingDate,schedule:n.finalSubState.billingSchedule.scheduleDescriptionAdjective});break;case l.CancellationType.IND_SUBSCRIPTION:r=d._("Confirmation"),i=d._("By confirming, your downgrade to Dropbox Basic scheduled change will be cancelled.");break;case l.CancellationType.ALL:r=d._("Confirmation"),i=d._("By confirming, all existing scheduled changes will be cancelled.");break;default:r=d._("Confirmation"),i=d._("By confirming, the scheduled change will be cancelled.")}return a.createElement(o.Modal,{acceptButtonDisabled:this.state.submitting,acceptButtonText:d._("Confirm"),autoClose:!1,dismissButtonText:d._("Don’t cancel"),onAccept:this.onAccept,title:r,submitting:this.state.submitting},a.createElement("p",null,i))},t})(a.Component);t.CancelChangesModalConfirmationView=_}),define("modules/clean/account_page/widgets/plan/views/cancel_plan",["require","exports","tslib","external/react","modules/core/uri","modules/core/i18n","modules/clean/display_format","modules/clean/account_page/widgets/plan/views/disable_stacked_transitions_modal","modules/constants/account_page","modules/clean/payments/skus/constants","modules/clean/analytics","modules/clean/payments/skus/sku_content"],function(e,t,n,a,i,r,l,o,s,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cancelPlanClick=function(e){if(u.ProEventsLogger.log("de_cancel_plan_subscription_click"),s.NO_RESET_INTERVAL_FOR_USERS&&s.DE_DISABLE_STACKED_TRANSITIONS&&t.pendingScheduledChange())return e.preventDefault(),void o.DisableStackedTransitionsModal.showInstance()},t}return n.__extends(t,e),Object.defineProperty(t.prototype,"quota",{get:function(){return this.props.usageBreakdown.quota||.01},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cancelURL",{get:function(){return new i.URI({path:"/downgrade",query:{oqa:"acc_cancel"}}).toString()},enumerable:!0,configurable:!0}),t.prototype.pendingScheduledChange=function(){return this.isPlanScheduledToChange()||this.isBillingScheduleToChange()||this.isEvhScheduledToChange()},t.prototype.isPlanScheduledToChange=function(){var e=this.props.subStatus;return!!(e&&e.subState.plan&&e.finalSubState.plan)&&e.subState.plan.productType!==e.finalSubState.plan.productType},t.prototype.isEvhScheduledToChange=function(){var e=this.props.subStatus;return!(!e||!e.scheduledSubState)&&e.subState.quantityForEvhAddOn()!==e.scheduledSubState.quantityForEvhAddOn()},
t.prototype.isBillingScheduleToChange=function(){var e=this.props.subStatus;return!!(e&&e.subState.billingSchedule&&e.finalSubState.billingSchedule)&&e.subState.billingSchedule.id!==e.finalSubState.billingSchedule.id},t.prototype.render=function(){var e=this.props,t=e.subStatus,n=e.eligibleFor1tb,i=e.basicSkuContent;if(!t||!t.subState.plan||t.subState.plan.productType===c.ProductPlanType.FREE)return a.createElement("noscript",null);var o=d.SkuContentClient.deserialize(i);return a.createElement("div",{className:"cancel-plan"},a.createElement("span",{className:"cancel-plan__header"},r._("Cancel %(plan)s plan").format({plan:t.subState.plan.displayName(n)})),a.createElement("div",null,a.createElement("p",{className:"cancel-plan__desc"},r._("If you cancel your plan, your account will drop from %(quota)s             to %(basic_space_short_form_gb)s of space (plus any bonus space earned previously)").format({quota:l.format_bytes(this.quota),basic_space_short_form_gb:o.spaceShortFormGb()})),a.createElement("span",{className:"cancel-plan__downgrade-link"},a.createElement("a",{href:this.cancelURL,onClick:this.cancelPlanClick},r._("Cancel plan")))))},t})(a.Component);t.CancelPlan=p}),define("modules/clean/account_page/widgets/plan/views/cancel_subs_warning_modal",["require","exports","tslib","modules/clean/ajax","modules/clean/react/css","modules/core/notify","external/react","modules/core/i18n","modules/clean/account_page/util","modules/clean/static_urls","modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal","modules/clean/react/modal","spectrum/button"],function(e,t,n,a,i,r,l,o,s,c,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(t){var n=e.call(this,t)||this;return n.onDismiss=function(e){e.preventDefault(),d.Modal.close()},n.onAccept=function(){n.cancelScheduledChange()},n.state={submitting:!1},n}return n.__extends(t,e),t.showInstance=function(e){d.Modal.showInstance(l.createElement(t.cancelChangesModalConfirmationView,n.__assign({},e)))},t.prototype.submittingRequest=function(){this.setState(function(e){return e.submitting=!0,e})},t.prototype.doneSubmittingRequest=function(){this.setState(function(e){return e.submitting=!1,e})},t.prototype.cancelScheduledChange=function(){var e=this,t=this.props,n=t.transitionPerformed,i=t.userIdOverride,l=null;l=i?i:s.getCurrentUser().id,this.submittingRequest(),a.WebRequest({url:"/account/ajax_cancel_scheduled_change",data:{scheduled_change_type:u.CancellationType.IND_SUBSCRIPTION},subject_user:l,success:function(t){r.Notify.success(o._("You’ve cancelled your change!")),n&&n(),e.doneSubmittingRequest(),d.Modal.close()},error:function(){r.Notify.error(o._("Failed to cancel changes.")),e.doneSubmittingRequest(),d.Modal.close()}})},t.prototype.render=function(){var e=this.props.subStatus,t=this.state.submitting;if(!e)return l.createElement("noscript",null);var n=l.createElement("div",{className:"loading-indicator"},l.createElement("img",{src:c.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:o._("Loading")})),a=t?n:l.createElement("div",null,l.createElement("div",{className:"cancel-subscription-warning-modal__cancel-btn"},l.createElement(p.Button,{variant:"primary",onClick:this.onAccept,disabled:t},o._("Cancel downgrade"))),l.createElement("div",{className:"cancel-subscription-warning-modal__dismiss-btn"},l.createElement("a",{href:"#",onClick:this.onDismiss},o._("Dismiss"))));return l.createElement(d.Modal,{acceptButtonDisabled:this.state.submitting,autoClose:!1,className:"cancel-subscription-warning-modal",buttonComponent:l.createElement(d.ModalButtons,null),submitting:this.state.submitting},l.createElement("div",null,l.createElement("p",{className:"cancel-subscription-warning-modal__title"},o._("Plan downgrade scheduled")),l.createElement("p",{className:"cancel-subscription-warning-modal__desc"},o._("Your plan is scheduled to be downgraded to Dropbox Basic on %(date)s.               If you want to make any changes, first cancel your scheduled downgrade.").format({date:e.subState.formattedNextBillingDate})),a))},t.cancelChangesModalConfirmationView=i(t,["/static/css/account/pagelet/cancel_subs_warning-vfl-s2mqh.css"]),t})(l.Component);t.CancelChangesModalConfirmation=m}),define("modules/clean/account_page/widgets/plan/views/cancellable_notifications_view",["require","exports","tslib","external/react","external/react-dom-factories","modules/clean/react/css","modules/core/i18n","modules/clean/account_page/widgets/billing/payment_methods_util","modules/clean/teams/admin/widgets/billing_notifications/cancellable_item","modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal","modules/clean/payments/skus/constants","modules/clean/react_format","modules/constants/trademark","modules/clean/account_page/widgets/plan/views/cancel_changes_modal"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleCancelSubscriptionAction=function(){t.handleCancelActions(c.CancellationType.IND_SUBSCRIPTION)},t.handleCancelPlanAction=function(){t.handleCancelActions(c.CancellationType.PLAN)},t.handleCancelScheduleAction=function(){t.handleCancelActions(c.CancellationType.SCHEDULE)},t.handleCancelEvhAction=function(){t.handleCancelActions(c.CancellationType.EVH_ADDON)},t.handleCancelActions=function(e){var n=t.props,a=n.subStatus,i=n.transitionPerformed,r=n.reOpenModalDialogAfterCancellation;a&&m.CancelChangesModalConfirmationView.showInstance({subStatus:a,transitionPerformed:i,cancellationType:e,reOpenModalDialogAfterCancellation:r})},t}return n.__extends(t,e),t.prototype.renderCancelSubscriptionNotification=function(){var e=this.props,t=e.subStatus,n=e.scheduledForDowngrade;if(t)return n?a.createElement(s.CancellableItemView,{title:l._("Scheduled plan change"),description:l._("Dropbox Basic"),handleAction:this.handleCancelSubscriptionAction,useSingleCancelLink:!1}):void 0},t.prototype.renderDowngradePlanNotification=function(){var e=this.props,t=e.subStatus,n=e.scheduledForDowngrade;if(t&&!n){var i=t.scheduledSubState;if(i){var r=t.subState.plan,o=i.plan;if(r&&o&&(r.productType!==o.productType||r.productType===o.productType&&r.productSpec!==o.productSpec)){var c=l._("Dropbox %(scheduled_plan)s").format({trademark_plus:p.TRADEMARK_PLUS,scheduled_plan:o.displayName()});return a.createElement(s.CancellableItemView,{title:l._("Scheduled plan change"),description:c,handleAction:this.handleCancelPlanAction,useSingleCancelLink:!1,className:"cancel-plan-schedule"})}}}},t.prototype.renderScheduledChange=function(){var e=this.props,t=e.subStatus,n=e.scheduledForDowngrade;if(t&&!n){var i=t.scheduledSubState;if(i&&i.billingSchedule&&t.subState.billingSchedule&&t.subState.billingSchedule.id!==i.billingSchedule.id){var r=i.billingSchedule.scheduleDescriptionAdjective;return a.createElement(s.CancellableItemView,{title:l._("Scheduled billing period"),description:l._("%(billing)s billing").format({billing:r.charAt(0).toUpperCase()+r.slice(1)}),handleAction:this.handleCancelScheduleAction,useSingleCancelLink:!1,className:"cancel-billing-schedule"})}}},t.prototype.renderEvhChange=function(){var e=this.props,t=e.subStatus,n=e.scheduledForDowngrade;if(t&&!n){var i=t.scheduledSubState;if(i)return t.subState.addons.skus.length>0&&1===t.subState.quantityForEvhAddOn()&&0===i.quantityForEvhAddOn()?a.createElement(s.CancellableItemView,{title:l._("Scheduled add-on change"),description:l._("Remove extended version history"),handleAction:this.handleCancelEvhAction,useSingleCancelLink:!1,className:"cancel-evh-schedule"}):void 0}},t.prototype.appendAllCancellationTypes=function(e){e.push(this.renderCancelSubscriptionNotification()),e.push(this.renderDowngradePlanNotification()),e.push(this.renderScheduledChange()),e.push(this.renderEvhChange())},t.prototype.render=function(){var e=this.props,t=e.displaySingleChangeCancellationItem,n=e.scheduledForDowngrade,r=e.subStatus,s=e.paymentInfo,p=e.hasLicenseKey,m=e.displayNewTotal;if(!r)return a.createElement("noscript",null);if(!s||o.shouldHideBillingChange(s.gateway_id,s.is_external_billing))return a.createElement("noscript",null);var h=[];if(!r.finalSubState.plan)return a.createElement("noscript",null);if(t)switch(t){case c.CancellationType.IND_SUBSCRIPTION:h.push(this.renderCancelSubscriptionNotification());break;case c.CancellationType.PLAN:h.push(this.renderDowngradePlanNotification());break;case c.CancellationType.SCHEDULE:h.push(this.renderScheduledChange());break;case c.CancellationType.EVH_ADDON:h.push(this.renderEvhChange());break;case c.CancellationType.ALL:this.appendAllCancellationTypes(h)}if(h=h.filter(function(e){return void 0!==e}),!h.length)return a.createElement("noscript",null);var _="";!n&&m&&(_=l._("Your new %(schedule)s total will be %(total)s.").format({schedule:u.productScheduleToProductScheduleDescription(r.finalSubState.plan.schedule),total:r.nextBillingSummary.total}));var g=a.createElement("div",{className:"cancellable-scheduled-notifications cancellable-scheduled-notifications__header"},d.reactFormat(l._("Changes are scheduled for <strong>%(date)s</strong>.").format({date:r.subState.formattedNextBillingDate}),{strong:i.strong()})," ",_);return a.createElement("div",{className:"cancellable-scheduled-notifications personal-cancellable-scheduled-notifications"},g,!p&&a.createElement("div",{className:"cancellable-scheduled-notifications cancellable-scheduled-notifications__items"},h))},t})(a.Component);t.CancellableNotificationsViewControl=h,t.CancellableNotificationsView=r(h,["/static/css/teams/admin/widgets/billing_notifications/cancellable_scheduled_notifications-vflQdegLi.css"])}),define("modules/clean/account_page/widgets/plan/views/change_plan_modal",["require","exports","tslib","modules/core/browser","modules/clean/react/image","modules/core/notify","external/react","modules/clean/ajax","modules/clean/react/css","modules/clean/teams/admin/widgets/admin_priced_list/admin_priced_list","modules/clean/teams/admin/widgets/admin_priced_list/admin_priced_list_item","modules/clean/account_page/widgets/plan/constants","modules/constants/individual_invoice_modal","modules/clean/account_page/widgets/plan/views/cancel_changes_modal","modules/clean/payments/validation","modules/clean/account_page/widgets/plan/views/cancellable_notifications_view","modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal","modules/clean/payments/cash","modules/clean/dbmodal_stack","modules/clean/account_page/widgets/plan/views/individual_inline_payment_method","modules/clean/react/modal","modules/constants/account_page","modules/clean/analytics","modules/clean/payments/skus/constants","modules/clean/payments/skus/subscription_change_plan","modules/clean/payments/skus/subscription_status","modules/constants/trademark","modules/core/i18n","modules/clean/account_page/util","modules/clean/react_format","modules/clean/static_urls","modules/clean/react/arbor/aspen/elements/arbor_inputs","modules/clean/account_page/widgets/plan/views/pro_upsell_modal_content"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m,h,_,g,f,b,y,S,v,E,P,C,w,T,N,x,I,k,L,A){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var D;(function(e){e[e.MONTHLY=1]="MONTHLY",e[e.YEARLY=2]="YEARLY",e[e.PLUS=3]="PLUS",e[e.PROFESSIONAL=4]="PROFESSIONAL"})(D=t.PerformPlanTransition||(t.PerformPlanTransition={}));var M=(function(e){function t(t){var n=e.call(this,t)||this;return n.onAccept=function(){var e,t,i=n.getSubChangePlan();if(i){i.finalSubState.planSku.productType!==P.ProductPlanType.PLUS&&i.finalSubState.planSku.productType!==P.ProductPlanType.STANDARD||(t=D.PROFESSIONAL,e=D.PLUS),i.finalSubState.planSku.productType===P.ProductPlanType.PROFESSIONAL&&(t=D.PLUS,e=D.PROFESSIONAL),n.setState(function(e){return{showErrors:!0}});var l=n.state,s=l.vat,c=l.paymentMethod;if(c&&c.country_code&&n.vatValidator(c.country_code,s))if(E.ProEventsLogger.log("de_change_plan_modal_confirm_change_click"),e&&t){n.setState(function(e){return{submitting:!0}});var u={transition_change_type:e};s&&(u.vat=s,E.ProEventsLogger.log("vat_provided_on_upgrade")),o.WebRequest({url:"/account/perform_personal_transition",data:u,subject_user:n.getUserId(),success:function(l){if(r.Notify.success(N._("You’ve changed your plan!")),n.removeShowModalParams(),n.logChangePlan(t,e),n.props.transitionPerformed&&n.props.transitionPerformed(),i.finalSubState.planSku.productType===P.ProductPlanType.PROFESSIONAL){if(n.state.expSubgrowthProConfirmationPage)return a.redirect("/professional_onboarding");n.setState({displayUpgradedToProfessionalContent:!0,loadingContent:!1,submitting:!1})}else S.Modal.close()},error:function(){r.Notify.error(N._("There was an error changing the plan!")),n.setState(function(e){return{submitting:!1}})}})}else r.Notify.error(N._("There was an error changing the plan!"))}},n.onDismiss=function(){E.ProEventsLogger.log("de_change_plan_modal_cancel_click")},n.onVatChange=function(e,t,a){var i=a;n.setState(function(e){return{vat:i,loadingChangeSummary:!0,showErrors:!1}});var r=n.state.paymentMethod;r&&r.country_code&&n.repriceTransitions(h.validateVat(r.country_code,i)?i:"")},n.handleCancelScheduleAction=function(e){n.handleCancelActions(g.CancellationType.SCHEDULE),e.preventDefault()},n.handleCancelActions=function(e){var t=n.state.subStatus;return t&&m.CancelChangesModalConfirmationView.showInstance({subStatus:t,transitionPerformed:n.props.transitionPerformed,cancellationType:e,reOpenModalDialogAfterCancellation:!0}),!1},n.transitionPerformedClosure=function(e){if(n.props.transitionPerformed)return n.props.transitionPerformed()},n.getStartedClick=function(){a.redirect("/professional_onboarding")},n.state={loadingContent:!0,schedule:P.ScheduleId.MONTHLY,subChangePlans:[],submitting:!1,type:P.ProductPlanType.STANDARD,displayUpgradedToProfessionalContent:!1,showErrors:!1,vat:"",loadingChangeSummary:!1},n}return n.__extends(t,e),t.prototype.getUrlOption=function(e){var t=e,n=a.get_href().match(/option=([a-zA-Z_]*)/);if(n&&n.length>1){var i=n[1];"plus"===i&&(t=e===P.ProductPlanType.PROFESSIONAL?P.ProductPlanType.PLUS:e),"pro"===i&&(t=P.ProductPlanType.PROFESSIONAL)}return t},t.showInstance=function(e){S.Modal.showInstance(l.createElement(t.ChangePlanModal,n.__assign({},e)))},t.prototype.componentDidMount=function(){this.loadPlanTransitions()},t.prototype.onLoadPlanTransitions=function(e){var t=this;this.setState(function(n){var a=w.SubscriptionStatus.deserialize(e.serializedSubStatus),i=e.paymentMethod,r=a.finalSubState;if(!r.billingSchedule||!r.plan)throw"A base plan is required, in order to change it.";var l=a.subState.billingSchedule.id,o=e.serializedSubChangePlans.map(function(e){return C.SubscriptionChangePlan.deserialize(e)}),s=o.map(function(e){return e});s.push(a);var c=t.getUrlOption(a.subState.plan.productType),u=e.exp_subgrowth_pro_plans_modal_simplification||"OFF";return["V1","V2","V3"].indexOf(u)>-1&&(c=P.ProductPlanType.PROFESSIONAL),{loadingContent:!1,subStatus:a,paymentMethod:i,schedule:l,subChangePlans:o,allSubStatuses:s,type:c,expProPlansModal:u,expSubgrowthProConfirmationPage:e.exp_subgrowth_pro_confirmation_page||!1}})},t.prototype.loadPlanTransitions=function(){var e=this;this.retrieveViewModel(function(t){e.onLoadPlanTransitions(t)},this.onLoadTransitionsError)},t.prototype.onLoadTransitionsError=function(){r.Notify.error(N._("Failed to load modal.")),S.Modal.close()},t.prototype.onRepriceTransitions=function(e){this.setState(function(t){var n=w.SubscriptionStatus.deserialize(e.serializedSubStatus),a=e.serializedSubChangePlans.map(function(e){return C.SubscriptionChangePlan.deserialize(e)}),i=a.map(function(e){return e});i.push(n);return{subStatus:n,subChangePlans:a,allSubStatuses:i,loadingChangeSummary:!1}})},t.prototype.onRepriceError=function(){r.Notify.error(N._("Request failed")),S.Modal.close()},t.prototype.repriceTransitions=function(e){var t=this;this.retrieveViewModel(function(e){t.onRepriceTransitions(e)},this.onRepriceError,e)},t.prototype.getUserId=function(){return this.props.userIdOverride?this.props.userIdOverride:x.getCurrentUser().id},t.prototype.retrieveViewModel=function(e,t,n){var a=this,i=this.state,r=i.withVat,l=i.withoutVat,s=n?{vat:n}:void 0,c=n?r:l;c?e(c):o.WebRequest({url:"/account/ajax_change_plan",data:s,subject_user:this.getUserId(),success:function(t){var i=JSON.parse(t);a.setState(function(e){return n?{withVat:i}:{withoutVat:i}}),e(i)},error:t})},t.prototype.getSubChangePlan=function(e){return void 0===e&&(e=this.state.type),this.state.subChangePlans.filter(function(t){var n=t.finalSubState;return!(!n.plan||!n.billingSchedule)&&n.plan.productType===e}).pop()},Object.defineProperty(t.prototype,"hasTypeChanged",{get:function(){var e=this.state.subStatus;return e&&e.finalSubState.plan&&e.finalSubState.plan.productType!==this.state.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasCurrentPlanChanged",{get:function(){return this.hasTypeChanged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subStatusScheduleId",{get:function(){var e=this.state.subStatus;return e&&e.finalSubState.billingSchedule?e.finalSubState.billingSchedule.id:P.ScheduleId.MONTHLY},enumerable:!0,configurable:!0}),t.prototype.logChangePlan=function(e,t){var n=this.state.subStatus;n&&n.subState.billingSchedule&&E.ProEventsLogger.log("de_change_plan_modal_change_plan",{from:e===D.PLUS?T.TRADEMARK_PLUS:"Professional",to:t===D.PROFESSIONAL?"Professional":T.TRADEMARK_PLUS})},t.prototype.removeShowModalParams=function(){var e=a.get_href().match(/modal=([a-zA-Z_]*)/);if(e&&e.length>1){"plan"===e[1]&&window.history.replaceState({},document.title,a.get_href().split("?")[0])}},t.prototype.changeProductPlanAndScheduleType=function(e,t){e===P.ProductPlanType.PROFESSIONAL?E.ProEventsLogger.log("de_change_plan_modal_professional_section_click"):E.ProEventsLogger.log("de_change_plan_modal_plus_section_click"),this.setState(function(n){return{type:e,schedule:t}})},t.prototype.getPlanDescription=function(e){var t=e.content&&e.content.spaceShortFormTb();switch(e.productType){case P.ProductPlanType.STANDARD:case P.ProductPlanType.PLUS:return t?N._("Stress-free sharing, offline folders on mobile, and %(plan_space)s storage.").format({plan_space:t}):N._("Stress-free sharing and offline folders on mobile.");case P.ProductPlanType.PROFESSIONAL:return t?N._("Smart Sync, Showcase, shared link controls, and %(plan_space)s storage.").format({plan_space:t}):N._("Smart Sync, Showcase, and shared link controls.")}return""},t.prototype.changeProductPlanAndScheduleTypeClosure=function(e,t){var n=this;return function(){n.changeProductPlanAndScheduleType(e,t)}},t.prototype.renderPlanItems=function(){var e=this,t=this.state,n=t.type,a=t.allSubStatuses,i=t.subStatus,r=[P.ProductPlanType.STANDARD,P.ProductPlanType.PLUS,P.ProductPlanType.PROFESSIONAL];if(a&&i)return a.filter(function(t){return!!(t.finalSubState.plan&&i.subState.plan&&i.finalSubState.plan&&i.subState.planSku&&i.finalSubState.planSku&&i.subState.billingSchedule&&t.finalSubState.billingSchedule)&&(!e.isBillingScheduleToChange()||t.subState.billingSchedule.id===i.subState.billingSchedule.id)}).sort(function(e,t){return e.finalSubState.plan&&t.finalSubState.plan?r.indexOf(e.finalSubState.plan.productType)-r.indexOf(t.finalSubState.plan.productType):0}).map(function(t){var a=t.finalSubState.plan,r=t.finalSubState.billingSchedule;if(a&&r&&!(i&&i.subState&&i.subState.plan&&i.subState.plan.isLegacyPlan&&a.isAdvancePlan)&&i.scheduledSubState&&i.scheduledSubState.billingSchedule&&t&&t.subState.billingSchedule&&t.finalSubState.plan&&t.finalSubState.billingSchedule&&i.subState.billingSchedule&&i.subState.plan){var o,s=void 0,c=i.isOnTrial?i.finalSubState.plan:i.subState.plan;c&&a.productType===c.productType&&(o=N._("(current plan)"));var d=l.createElement("span",null,l.createElement("br",null),l.createElement("a",{href:"/plans/individual",target:"_blank",rel:"noreferrer noopener"},N._("See plan details"))),p=N._("Dropbox %(plan_name)s").format({plan_name:a.displayName()});return l.createElement(u.AdminPricedListItem,{key:a.code,isSelected:n===a.productType,title:p,titleWarningText:s,titleSecondaryText:o,description:e.getPlanDescription(a),detailsLink:d,price:a.displayCost,unit:a.billingSchedule.id===P.ScheduleId.MONTHLY?N._("per month"):N._("per year"),onClick:e.changeProductPlanAndScheduleTypeClosure(a.productType,r.id),disableItem:e.isPlanScheduledToChange()})}})},t.prototype.renderSubgrowthProPlansModalSimplificationExperiment=function(){var e=this,t=this.state,n=t.expProPlansModal,a=t.allSubStatuses,i=t.subStatus;if(!a||!i||!n)return null;for(var r,o=a.filter(function(t){return!!(t.finalSubState.plan&&i.subState.plan&&i.finalSubState.plan&&i.subState.planSku&&i.finalSubState.planSku&&i.subState.billingSchedule&&t.finalSubState.billingSchedule)&&(!e.isBillingScheduleToChange()||t.subState.billingSchedule.id===i.subState.billingSchedule.id)}),s=0,c=o;s<c.length;s++){var u=c[s];u.finalSubState.plan.productType===P.ProductPlanType.PROFESSIONAL&&(r=u)}if(!r||!r.finalSubState.plan)return null;var d=r.finalSubState.plan;return l.createElement(A.ProUpsellModalContent,{variant:n,price:d.displayCost,unit:d.billingSchedule.id===P.ScheduleId.MONTHLY?N._("per month"):N._("per year")})},t.prototype.renderBillingSection=function(){return l.createElement("div",null,this.state.expProPlansModal&&["V1","V2","V3"].indexOf(this.state.expProPlansModal)>-1?this.renderSubgrowthProPlansModalSimplificationExperiment():l.createElement(c.AdminPricedList,null,this.renderPlanItems()),this.renderVat())},t.prototype.renderVat=function(){var e=null;if(!this.vatDisplayEnabled)return e;var t=this.state,n=t.vat,a=t.paymentMethod,i=t.showErrors,r=a&&a.country_code?a.country_code:void 0;if(r){var o=h.getVatPrefix(r),s=N._("Please enter a valid VAT number, e.g. %(examples)s.").format({examples:h.getVatExamples(r).join(", ")});e=l.createElement(L.ArborTextInput,{name:"vat",placeholderText:o,labelText:N._("VAT number (optional)"),isValid:!i||this.vatValidator(r,n),errorText:s,value:n,onChange:this.onVatChange})}return e},t.prototype.vatValidator=function(e,t){return!t||h.validateVat(e,t)},t.prototype.renderPaymentMethod=function(){var e=this.state.paymentMethod;if(e&&!this.isPlanScheduledToChange())return l.createElement("div",{className:"upgrade-payment-method-link"},l.createElement(y.IndividualInlinePaymentMethodView,{paymentMethod:e,showModal:this.showModalClosure(this.props)}))},t.prototype.showModalClosure=function(e){return function(){t.showInstance(e)}},t.prototype.isScheduledToChange=function(){return this.isPlanScheduledToChange()||this.isBillingScheduleToChange()||this.isEvhScheduledToChange()},t.prototype.isEvhScheduledToChange=function(){var e=this.state.subStatus;return!(!e||!e.scheduledSubState)&&e.subState.quantityForEvhAddOn()!==e.scheduledSubState.quantityForEvhAddOn()},t.prototype.isPlanScheduledToChange=function(){var e=this.state.subStatus;return!!(e&&e.subState.plan&&e.finalSubState.plan)&&e.subState.plan.productType!==e.finalSubState.plan.productType},t.prototype.isBillingScheduleToChange=function(){var e=this.state.subStatus;return!!(e&&e.subState.billingSchedule&&e.finalSubState.billingSchedule)&&e.subState.billingSchedule.id!==e.finalSubState.billingSchedule.id},t.prototype.getPlanNameWithEvhText=function(e){var t=this.state.subStatus;return t&&t.scheduledSubState&&t.scheduledSubState.quantityForEvhAddOn()>0?e+" "+N._("+ extended version history"):e},t.prototype.renderScheduleTransitionText=function(){var e=this.state.subStatus,t=this.getSubChangePlan();if(e&&e.subState.plan){var n=l.createElement("a",{href:"#",onClick:this.handleCancelScheduleAction},N._("Cancel change"));if(this.isPlanScheduledToChange())return l.createElement("span",{className:"plan-transition"},N._("You’ve already requested a change to your plan. If you want           to choose a different plan or billing period, first cancel your pending change.")," ",n);if((!t||e.subState.planSku.productType===t.finalSubState.planSku.productType)&&e.subState.billingSchedule&&e.currentBillingSummary){if(!this.isScheduledToChange()||!v.NO_RESET_INTERVAL_FOR_USERS)return l.createElement("span",{className:"plan-transition"},N._("Your Dropbox %(plan)s plan will renew on %(date)s.                 Your current %(schedule)s total is %(recurring_total)s.").format({plan:this.getPlanNameWithEvhText(e.subState.plan.displayName()),schedule:e.subState.billingSchedule.scheduleDescriptionAdjective,recurring_total:f.Cash.formatWithTaxLabels(e.currentBillingSummary.total,e.currentBillingSummary),date:e.subState.formattedNextBillingDate}));if(e.scheduledSubState&&e.scheduledSubState.plan)return l.createElement("div",null,l.createElement("span",{className:"change-summary"},N._("Change summary")),l.createElement("p",{className:"plan-transition"},I.reactFormat(N._("Starting on %(date)s, we’ll bill you once a %(schedule_noun)s for your Dropbox                     %(plan)s. Your new %(schedule)s total will be %(scheduled_total)s.").format({plan:this.getPlanNameWithEvhText(e.scheduledSubState.plan.displayName()),date:e.subState.formattedNextBillingDate,schedule:e.scheduledSubState.billingSchedule.scheduleDescriptionAdjective,schedule_noun:e.scheduledSubState.billingSchedule.scheduleDescriptionNoun,scheduled_total:f.Cash.formatWithTaxLabels(e.nextBillingSummary.total,e.nextBillingSummary)}),{strong:l.createElement("strong",null)})))}if(t&&t.finalSubState.plan){var a=void 0!==t.tvm;return t&&t.tvm&&a?l.createElement("div",null,l.createElement("span",{className:"change-summary"},N._("Change summary")),l.createElement("p",{className:"plan-transition"},I.reactFormat(N._("You’re upgrading your plan to Dropbox %(plan)s.                 <strong>We’ll charge you %(prorated_price)s now</strong>, which is prorated for the current                 billing period. Starting on %(date)s and until you <cancelLink>cancel</cancelLink>, we’ll bill you once a %(schedule_noun)s and your new                 %(schedule)s total will be %(scheduled_total)s. If you cancel, previous charges won’t be refunded                 <legalLink>unless it’s legally required</legalLink>.").format({plan:this.getPlanNameWithEvhText(t.finalSubState.plan.displayName()),prorated_price:f.Cash.formatWithTaxLabels(t.tvm.getTotalPrice(),t.nextBillingSummary),date:t.subState.formattedNextBillingDate,schedule_noun:t.finalSubState.billingSchedule.scheduleDescriptionNoun,schedule:t.finalSubState.billingSchedule.scheduleDescriptionAdjective,scheduled_total:f.Cash.formatWithTaxLabels(t.nextBillingSummary.total,t.nextBillingSummary)}),{strong:l.createElement("strong",null),cancelLink:l.createElement("a",{href:"/help/billing/cancel-dropbox-plus"}),legalLink:l.createElement("a",{href:"/help/billing/plus-refund"})}))):a?void 0:l.createElement("div",null,l.createElement("span",{className:"change-summary"},N._("Change summary")),l.createElement("p",{className:"plan-transition"},I.reactFormat(N._("Starting on %(date)s, your plan will be downgraded to Dropbox %(plan)s                 and your new %(schedule)s total will be %(scheduled_total)s. Charges will                 continue until you <cancelLink>cancel</cancelLink>, and previous charges won’t be refunded                 <legalLink>unless it’s legally required</legalLink>.").format({plan:this.getPlanNameWithEvhText(t.finalSubState.plan.displayName()),date:e.subState.formattedNextBillingDate,schedule:t.finalSubState.billingSchedule.scheduleDescriptionAdjective,scheduled_total:f.Cash.formatWithTaxLabels(t.nextBillingSummary.total,t.nextBillingSummary)}),{strong:l.createElement("strong",null),cancelLink:l.createElement("a",{href:"/help/billing/cancel-dropbox-plus"}),legalLink:l.createElement("a",{href:"/help/billing/plus-refund"})})))}}},t.prototype.renderChangeFooter=function(){var e;return this.state.loadingChangeSummary?l.createElement("div",{className:"loading-indicator"},l.createElement("img",{src:k.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:N._("Loading")})):(this.isPlanScheduledToChange()||(e=this.renderPaymentMethod()),l.createElement("div",{className:"plan-footer u-font-meta"},this.renderScheduleTransitionText(),e))},Object.defineProperty(t.prototype,"acceptButtonDisabled",{get:function(){var e=this.state.paymentMethod,t=this.state,n=t.loadingContent,a=t.loadingChangeSummary,i=t.submitting;return!(!(n||a||i)&&e)||!this.hasUserSelectedDifferentPlan()},enumerable:!0,configurable:!0}),t.prototype.isValidVatCountry=function(){var e=this.state.paymentMethod;return e&&e.country_code&&h.hasVat(e.country_code)},t.prototype.isUserOnPlus=function(){var e=this.state.subStatus;return e&&e.subState&&e.subState.plan&&e.subState.plan.productType===P.ProductPlanType.PLUS},t.prototype.hasUserSelectedDifferentPlan=function(){return!this.isPlanScheduledToChange()&&this.hasTypeChanged},Object.defineProperty(t.prototype,"vatDisplayEnabled",{get:function(){var e=this.state,t=e.loadingContent,n=e.submitting;return p.INDIVIDUAL_INVOICE_MODAL&&!t&&!n&&this.isValidVatCountry()&&this.isUserOnPlus()&&this.hasUserSelectedDifferentPlan()},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e,n=this,a=this.props,r=a.transitionPerformed,o=a.paymentInfo,s=this.state,c=s.subStatus,u=s.displayUpgradedToProfessionalContent,p=s.loadingContent,m=s.submitting,h=N._("Change plan"),f=N._("Cancel"),y=N._("Confirm change");if(c&&u)y="",f="",e=l.createElement("div",{className:"upgrade-to-professional"},l.createElement(i.Image,{className:"upgrade-to-professional__img",src:k.static_url("/static/images/account_page/successful-upgrade-conf-vfljF71a-.png"),srcHiRes:k.static_url("/static/images/account_page/successful-upgrade-conf@2x-vflKbwL4c.png"),alt:N._("")}),l.createElement("h3",{className:"upgrade-to-professional__title"},N._("Congrats! You’ve upgraded to Dropbox Professional")),l.createElement("p",{className:"upgrade-to-professional__desc"},N._("Get ready to take advantage of advanced features like Smart Sync, Showcase, and more support options.")),l.createElement("button",{className:"button-primary upgrade-to-professional_cta_btn",onClick:this.getStartedClick},N._("Got it")));else if(p)e=l.createElement("div",{className:"loading-indicator"},l.createElement("img",{src:k.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:N._("Loading")}));else{var v=void 0;if(c&&r){b.DBModalStack.clear(),b.DBModalStack.register(d.CHANGE_IND_PLAN_MODAL_UPDATED,function(){t.showInstance({transitionPerformed:n.transitionPerformedClosure})}),v=l.createElement(_.CancellableNotificationsView,{subStatus:c,transitionPerformed:this.transitionPerformedClosure,displaySingleChangeCancellationItem:g.CancellationType.ALL,reOpenModalDialogAfterCancellation:!0,paymentInfo:o,displayNewTotal:!1})}this.state.expProPlansModal&&["V1","V2","V3"].indexOf(this.state.expProPlansModal)>-1&&(h=N._("Upgrade account"),y=N._("Upgrade now")),e=l.createElement("div",null,v,this.renderBillingSection(),this.renderChangeFooter())}return l.createElement(S.Modal,{acceptButtonDisabled:this.acceptButtonDisabled,acceptButtonText:y,className:"change-plan-modal",dismissButtonText:f,autoClose:!1,onAccept:this.onAccept,onDismiss:this.onDismiss,submitting:m,title:h},e)},t.ChangePlanModal=s(t,["/static/css/teams/admin/widgets/change_plan_modal/change_plan_modal-vfl_9HI5q.css"]),t})(l.Component);t.ChangePlanModalView=M}),
define("modules/clean/account_page/widgets/plan/views/change_schedule_modal",["require","exports","tslib","modules/core/notify","external/react","modules/clean/ajax","modules/clean/react/css","modules/clean/teams/admin/widgets/admin_priced_list/admin_priced_list","modules/clean/teams/admin/widgets/admin_priced_list/admin_priced_list_item","modules/clean/account_page/widgets/plan/constants","modules/clean/account_page/widgets/plan/views/cancel_changes_modal","modules/clean/account_page/widgets/plan/views/cancellable_notifications_view","modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal","modules/clean/payments/cash","modules/clean/dbmodal_stack","modules/clean/account_page/widgets/billing/payment_methods_util","modules/clean/account_page/widgets/plan/views/individual_inline_payment_method","modules/clean/react/modal","modules/constants/account_page","modules/clean/account_page/widgets/plan/views/change_plan_modal","modules/clean/analytics","modules/clean/payments/skus/constants","modules/clean/payments/skus/subscription_change_plan","modules/clean/payments/skus/subscription_status","modules/core/i18n","modules/clean/account_page/util","modules/clean/react_format","modules/clean/static_urls"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m,h,_,g,f,b,y,S,v,E,P,C,w,T,N){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var x=(function(e){function t(t){var n=e.call(this,t)||this;return n.onAccept=function(){var e,t,i=n.getSubChangePlan();i&&(i.finalSubState.billingSchedule.id===v.ScheduleId.MONTHLY&&(t=y.PerformPlanTransition.YEARLY,e=y.PerformPlanTransition.MONTHLY),i.finalSubState.billingSchedule.id===v.ScheduleId.YEARLY&&(t=y.PerformPlanTransition.MONTHLY,e=y.PerformPlanTransition.YEARLY),e&&t?(n.setState(function(e){return e.submitting=!0,e}),r.WebRequest({url:"/account/perform_personal_transition",data:{transition_change_type:e},subject_user:w.getCurrentUser().id,success:function(e){a.Notify.success(C._("You’ve changed your billing period!")),n.logChangeSchedule(),n.props.transitionPerformed&&n.props.transitionPerformed(),f.Modal.close()},error:function(){a.Notify.error(C._("There was an error changing the billing period!")),n.setState(function(e){return e.submitting=!1,e})}})):a.Notify.error(C._("There was an error changing the billing period!")))},n.handleCancelScheduleAction=function(){return n.handleCancelActions(p.CancellationType.SCHEDULE),!1},n.handleCancelActions=function(e){var t=n.state.subStatus;return t&&u.CancelChangesModalConfirmationView.showInstance({subStatus:t,transitionPerformed:n.props.transitionPerformed,cancellationType:e,reOpenModalDialogAfterCancellation:!0}),!1},n.transitionPerformedClosure=function(e){if(n.props.transitionPerformed)return n.props.transitionPerformed()},n.onDismissModal=function(){S.ProEventsLogger.log("de_cancel_billing_change_modal")},n.state={loadingContent:!0,schedule:v.ScheduleId.MONTHLY,subChangePlans:[],submitting:!1,type:v.ProductPlanType.STANDARD,hasLicenseKey:!1},n}return n.__extends(t,e),Object.defineProperty(t.prototype,"isProfessionalTrialPlan",{get:function(){var e=this.state.subStatus;return!(!e||!e.subState.plan)&&e.subState.plan.productType===v.ProductPlanType.PROFESSIONAL_TRIAL},enumerable:!0,configurable:!0}),t.showInstance=function(e){f.Modal.showInstance(i.createElement(t.ChangeScheduleModal,n.__assign({},e)))},t.prototype.componentDidMount=function(){this.loadPlanTransitions()},t.prototype.loadPlanTransitions=function(){var e=this;r.WebRequest({url:"/account/ajax_change_plan_schedule",subject_user:w.getCurrentUser().id,success:function(t){var n=JSON.parse(t);e.setState(function(e){e.loadingContent=!1,e.subStatus=P.SubscriptionStatus.deserialize(n.serializedSubStatus),e.paymentMethod=n.paymentMethod,e.hasLicenseKey=n.hasLicenseKey;var t=e.subStatus.finalSubState;if(!t.billingSchedule||!t.plan)throw"A base plan is required, in order to change it.";return e.hasLicenseKey?e.schedule=e.subStatus.scheduledSubState.billingSchedule.id:e.schedule=e.subStatus.subState.billingSchedule.id,e.subChangePlans=n.serializedSubChangePlans.map(function(e){return E.SubscriptionChangePlan.deserialize(e)}),e.allSubStatuses=e.subChangePlans.map(function(e){return e}),e.allSubStatuses.push(e.subStatus),e.type=e.subStatus.subState.plan.productType,e})},error:function(){a.Notify.error(C._("Failed to load modal.")),f.Modal.close()}})},t.prototype.getSubChangePlan=function(e,t){return void 0===e&&(e=this.state.type),void 0===t&&(t=this.state.schedule),this.state.subChangePlans.filter(function(n){var a=n.finalSubState;return!(!a.plan||!a.billingSchedule)&&(a.plan.productType===e&&a.billingSchedule.id===t)}).pop()},Object.defineProperty(t.prototype,"hasTypeChanged",{get:function(){var e=this.state.subStatus;return e&&e.finalSubState.plan&&e.finalSubState.plan.productType!==this.state.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasScheduleChanged",{get:function(){var e=this.state.subStatus;return e&&e.finalSubState.billingSchedule&&e.finalSubState.billingSchedule.id!==this.state.schedule},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasCurrentPlanChanged",{get:function(){return this.hasTypeChanged||this.hasScheduleChanged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subStatusScheduleId",{get:function(){var e=this.state.subStatus;return e&&e.finalSubState.billingSchedule?e.finalSubState.billingSchedule.id:v.ScheduleId.MONTHLY},enumerable:!0,configurable:!0}),t.prototype.logChangeSchedule=function(){var e=this.state.subStatus;e&&e.subState.billingSchedule&&S.ProEventsLogger.log("de_change_billing_change_schedule",{from:e.subState.billingSchedule.id===v.ScheduleId.MONTHLY?"yearly":"monthly",to:e.subState.billingSchedule.id===v.ScheduleId.MONTHLY?"monthly":"yearly"})},t.prototype.changeProductPlanAndScheduleType=function(e,t){this.setState(function(n){return n.type=e,n.schedule=t,n})},t.prototype.changeProductPlanAndScheduleTypeClosure=function(e,t){var n=this;return function(){n.changeProductPlanAndScheduleType(e,t)}},t.prototype.getScheduleDescription=function(e,t,n){var a=this.state.subStatus;if(!(e.finalSubState.billingSchedule&&e.finalSubState.plan&&a&&a.scheduledSubState&&a.scheduledSubState.plan&&a.subState.plan))return"";var i=this.getOriginalStatusForCurrentStatus(a.subState.plan.productType,v.ScheduleId.MONTHLY);if(this.isPlanScheduledToChange()&&this.isBillingScheduleToChange()&&(i=this.getSubStatusFromSubChangePlans(a.subState.plan.productType,v.ScheduleId.MONTHLY)),!i||!i.subState.planSku||!i.finalSubState.planSku)return"";var r;r=this.isPlanScheduledToChange()?i.finalSubState.planSku.displayCost.multiply(12):a.subState.billingSchedule.id===v.ScheduleId.MONTHLY?i.subState.planSku.displayCost.multiply(12):i.finalSubState.planSku.displayCost.multiply(12);var l="";switch(l=this.isPlanScheduledToChange()&&this.isBillingScheduleToChange()?a.subState.plan.displayName():a.scheduledSubState.plan.displayName(),e.finalSubState.billingSchedule.id){case v.ScheduleId.YEARLY:var o=n.amount,s=r.amount,c=C.format_percent(Math.round(100*(1-o/s)));return C._("Dropbox %(plan_name)s is %(price_per_year)s per year.           You’ll save %(save_percentage)s over monthly billing.").format({plan_name:l,price_per_year:n,save_percentage:c});case v.ScheduleId.MONTHLY:return C._("Dropbox %(plan_name)s is %(price_per_month)s per month.           You’ll spend %(price_per_year)s per year.").format({plan_name:l,price_per_month:t,price_per_year:n})}return""},t.prototype.getBillingItemTitle=function(e){switch(e){case v.ScheduleId.YEARLY:return C._("Billed yearly");case v.ScheduleId.MONTHLY:return C._("Billed monthly")}return""},t.prototype.getOriginalStatusForCurrentStatus=function(e,t){var n=this,a=this.state,i=a.allSubStatuses,r=a.subStatus;if(i&&r)return i.filter(function(a){return!!(a.finalSubState.plan&&r.finalSubState.plan&&a.finalSubState.billingSchedule)&&((a.subState.plan.productType===e||n.isProfessionalTrialPlan)&&a.finalSubState.billingSchedule.id===t)}).pop()},t.prototype.getSubStatusFromSubChangePlans=function(e,t){var n=this.state,a=n.subChangePlans,i=n.subStatus;if(a&&i)return a.filter(function(n){return!!(n.finalSubState.plan&&i.finalSubState.plan&&n.finalSubState.billingSchedule)&&(n.finalSubState.plan.productType===e&&n.finalSubState.billingSchedule.id===t)}).pop()},t.prototype.renderBillingScheduleItems=function(){var e=this,t=this.state,n=t.allSubStatuses,a=t.subStatus,r=t.schedule,l=t.hasLicenseKey;if(n&&a)return n.filter(function(t){return!!(t.finalSubState.plan&&a.subState.plan&&a.finalSubState.plan)&&(!e.isPlanScheduledToChange()||!e.isBillingScheduleToChange()||t.finalSubState.plan.productType===a.subState.plan.productType)}).sort(function(e,t){return e.finalSubState.billingSchedule&&t.finalSubState.billingSchedule?e.finalSubState.billingSchedule.id-t.finalSubState.billingSchedule.id:0}).map(function(t){var n=t.finalSubState.plan,o=t.finalSubState.billingSchedule;if(n&&o&&a.subState.billingSchedule&&a.subState.plan&&t.finalSubState.billingSchedule){var c=e.getOriginalStatusForCurrentStatus(a.subState.plan.productType,t.finalSubState.billingSchedule.id);if(c&&c.finalSubState.billingSchedule&&t.subState.billingSchedule){var u,d=n.displayCost,p=n.displayCost,m=n.displayCost,h=t.finalSubState.billingSchedule.id,_=a.subState.billingSchedule.id;switch(l&&a.scheduledSubState&&a.scheduledSubState.billingSchedule&&(_=a.scheduledSubState.billingSchedule.id),_){case v.ScheduleId.MONTHLY:u=C._("per month"),h===v.ScheduleId.YEARLY&&(p=d.divide(12),d=p),h===v.ScheduleId.MONTHLY&&(m=p.multiply(12));break;case v.ScheduleId.YEARLY:u=C._("per year"),h===v.ScheduleId.YEARLY&&(p=d.divide(12)),h===v.ScheduleId.MONTHLY&&(m=d.multiply(12),d=m)}var g,f,b=void 0,y=o.id===r;e.isPlanScheduledToChange()&&!e.isProfessionalTrialPlan&&(f=i.createElement("span",null,i.createElement("br",null),i.createElement("a",{href:"/plans/individual",target:"_blank",rel:"noreferrer noopener"},C._("See other plans"))));return a.subState.billingSchedule.id===o.id&&(g=C._("(current billing period)")),i.createElement(s.AdminPricedListItem,{key:n.code,isSelected:y,title:e.getBillingItemTitle(o.id),titleWarningText:b,titleSecondaryText:g,description:e.getScheduleDescription(c,p,m),price:d,detailsLink:f,unit:u,onClick:e.changeProductPlanAndScheduleTypeClosure(n.productType,o.id),disableItem:e.isBillingScheduleToChange()})}}})},t.prototype.renderBillingSection=function(){return i.createElement("div",null,i.createElement(o.AdminPricedList,null,this.renderBillingScheduleItems()))},t.prototype.renderPaymentMethod=function(){var e=this.state.paymentMethod;if(e&&!this.isBillingScheduleToChange())return i.createElement("div",{className:"upgrade-payment-method-link"},i.createElement(g.IndividualInlinePaymentMethodView,{paymentMethod:e,showModal:this.showModalClosure(this.props)}))},t.prototype.showModalClosure=function(e){return function(){t.showInstance(e)}},t.prototype.isPlanScheduledToChange=function(){var e=this.state.subStatus;return!!(e&&e.subState.plan&&e.finalSubState.plan)&&e.subState.plan.productType!==e.finalSubState.plan.productType},t.prototype.isScheduledToChange=function(){return this.isPlanScheduledToChange()||this.isBillingScheduleToChange()||this.isEvhScheduledToChange()},t.prototype.isEvhScheduledToChange=function(){var e=this.state.subStatus;return!(!e||!e.scheduledSubState)&&e.subState.quantityForEvhAddOn()!==e.scheduledSubState.quantityForEvhAddOn()},t.prototype.isBillingScheduleToChange=function(){var e=this.state,t=e.subStatus;return!e.hasLicenseKey&&!!(t&&t.subState.billingSchedule&&t.finalSubState.billingSchedule)&&t.subState.billingSchedule.id!==t.finalSubState.billingSchedule.id},t.prototype.getPlanNameWithEvhText=function(e){var t=this.state.subStatus;return t&&t.scheduledSubState&&t.scheduledSubState.quantityForEvhAddOn()>0?e+" "+C._("+ extended version history"):e},t.prototype.renderScheduleTransitionText=function(){var e=this.state.subStatus,t=this.getSubChangePlan();if(e&&e.subState.plan){var n=i.createElement("a",{href:"#",onClick:this.handleCancelScheduleAction},C._("Cancel change"));if(this.isBillingScheduleToChange())return i.createElement("span",{className:"plan-transition"},C._("You’ve already requested a change to your billing period. If you want             to choose a different billing period, first cancel your pending change.")," ",n);if(this.isProfessionalTrialPlan&&!this.hasScheduleChanged)return i.createElement("div",null,i.createElement("span",{className:"change-summary"},C._("Change summary")),i.createElement("p",{className:"plan-transition"},_.getProfessionalTrialScheduleDescription(e)));if((!t||this.isBillingScheduleToChange())&&e.currentBillingSummary)return b.NO_RESET_INTERVAL_FOR_USERS&&this.isScheduledToChange()&&e.scheduledSubState&&e.scheduledSubState.plan?i.createElement("div",null,i.createElement("span",{className:"change-summary"},C._("Change summary")),i.createElement("p",{className:"plan-transition"},T.reactFormat(C._("Starting on %(date)s, we’ll bill you once a %(schedule_noun)s for your                   Dropbox %(plan_name)s plan. Your new %(schedule)s total will be %(scheduled_total)s.").format({plan_name:this.getPlanNameWithEvhText(e.scheduledSubState.plan.displayName()),date:e.subState.formattedNextBillingDate,schedule:e.scheduledSubState.billingSchedule.scheduleDescriptionAdjective,schedule_noun:e.scheduledSubState.billingSchedule.scheduleDescriptionNoun,scheduled_total:m.Cash.formatWithTaxLabels(e.nextBillingSummary.total,e.nextBillingSummary)}),{strong:i.createElement("strong",null)}))):i.createElement("div",null,i.createElement("p",{className:"plan-transition"},C._("Your Dropbox %(plan)s plan will renew on %(date)s.                 Your current %(schedule)s total is %(recurring_total)s.").format({plan:this.getPlanNameWithEvhText(e.subState.plan.displayName()),schedule:e.subState.billingSchedule.scheduleDescriptionAdjective,recurring_total:m.Cash.formatWithTaxLabels(e.currentBillingSummary.total,e.currentBillingSummary),date:e.subState.formattedNextBillingDate})));if(e.scheduledSubState&&e.scheduledSubState.plan){if(!t||!t.finalSubState.plan)return i.createElement("div",null,i.createElement("span",{className:"change-summary"},C._("Change summary")),i.createElement("p",{className:"plan-transition"},T.reactFormat(C._("Starting on %(date)s, we’ll bill you once a %(schedule_noun)s for your                 Dropbox %(plan_name)s plan. Your new %(schedule)s total will be %(scheduled_total)s.                 Charges will continue until you <cancelLink>cancel</cancelLink>, and previous charges won’t be refunded                 <legalLink>unless it’s legally required</legalLink>.").format({plan_name:this.getPlanNameWithEvhText(e.scheduledSubState.plan.displayName()),date:e.subState.formattedNextBillingDate,schedule:e.scheduledSubState.billingSchedule.scheduleDescriptionAdjective,schedule_noun:e.scheduledSubState.billingSchedule.scheduleDescriptionNoun,scheduled_total:m.Cash.formatWithTaxLabels(e.nextBillingSummary.total,e.nextBillingSummary)}),{strong:i.createElement("strong",null),cancelLink:i.createElement("a",{href:"/help/billing/cancel-dropbox-plus"}),legalLink:i.createElement("a",{href:"/help/billing/plus-refund"})})));if(b.NO_RESET_INTERVAL_FOR_USERS)return i.createElement("div",null,i.createElement("span",{className:"change-summary"},C._("Change summary")),i.createElement("p",{className:"plan-transition"},T.reactFormat(C._("Starting on %(date)s, we’ll bill you once a %(schedule_noun)s for your                 Dropbox %(plan_name)s plan. Your new %(schedule)s total will be %(scheduled_total)s.                 Charges will continue until you <cancelLink>cancel</cancelLink>, and previous charges won’t be refunded                 <legalLink>unless it’s legally required</legalLink>.").format({plan_name:this.getPlanNameWithEvhText(e.scheduledSubState.plan.displayName()),date:e.subState.formattedNextBillingDate,schedule:t.finalSubState.billingSchedule.scheduleDescriptionAdjective,schedule_noun:t.finalSubState.billingSchedule.scheduleDescriptionNoun,scheduled_total:m.Cash.formatWithTaxLabels(t.nextBillingSummary.total,t.nextBillingSummary)}),{strong:i.createElement("strong",null),cancelLink:i.createElement("a",{href:"/help/billing/cancel-dropbox-plus"}),legalLink:i.createElement("a",{href:"/help/billing/plus-refund"})})));var a=void 0!==t.tvm;if(t&&t.tvm&&a){var r="",l="";return this.isPlanScheduledToChange()&&(r=" "+C._("Upgrading will cancel all scheduled changes.")),this.isEvhScheduledForDowngrade()&&(l=" "+C._("Your scheduled add-on change will take place immediately.")),i.createElement("div",null,i.createElement("span",{className:"change-summary"},C._("Change summary")),i.createElement("p",{className:"plan-transition"},T.reactFormat(C._("You’re changing to %(schedule)s billing.%(evh_upgrade_warning)s                 <strong>We’ll charge you %(prorated_price)s now</strong>, which is prorated for the current                 billing period. Your plan will renew on %(date)s. Your new %(schedule)s total                 will be %(scheduled_total)s.%(upgrade_warning)s").format({prorated_price:m.Cash.formatWithTaxLabels(t.tvm.getTotalPrice(),t.nextBillingSummary),date:t.subState.formattedNextBillingDate,schedule:t.finalSubState.billingSchedule.scheduleDescriptionAdjective,scheduled_total:m.Cash.formatWithTaxLabels(t.nextBillingSummary.total,t.nextBillingSummary),upgrade_warning:r,evh_upgrade_warning:l}),{strong:i.createElement("strong",null)})))}return a?void 0:i.createElement("div",null,i.createElement("span",{className:"change-summary"},C._("Change summary")),i.createElement("p",{className:"plan-transition"},T.reactFormat(C._("You’re changing to %(schedule)s billing.                 Starting on %(date)s, we’ll bill you once a %(schedule_noun)s.                 Your new %(schedule)s total will be %(scheduled_total)s.").format({date:e.subState.formattedNextBillingDate,schedule:t.finalSubState.billingSchedule.scheduleDescriptionAdjective,schedule_noun:t.finalSubState.billingSchedule.scheduleDescriptionNoun,scheduled_total:m.Cash.formatWithTaxLabels(t.nextBillingSummary.total,t.nextBillingSummary)}),{strong:i.createElement("strong",null)})))}}},t.prototype.renderFooter=function(){return this.renderScheduleChangeFooter()},t.prototype.renderScheduleChangeFooter=function(){var e;return this.isBillingScheduleToChange()||(e=this.renderPaymentMethod()),i.createElement("div",{className:"plan-footer u-font-meta"},this.renderScheduleTransitionText(),e)},Object.defineProperty(t.prototype,"acceptButtonDisabled",{get:function(){var e=this.state.paymentMethod,t=this.state,n=t.loadingContent,a=t.submitting;return!(!n&&!a&&e)||(!this.hasScheduleChanged||this.isBillingScheduleToChange())},enumerable:!0,configurable:!0}),t.prototype.isEvhScheduledForDowngrade=function(){var e=this.state.subStatus;if(!e)return!1;var t=e.scheduledSubState;return!!t&&(e.subState.addons.skus.length>0&&1===e.subState.quantityForEvhAddOn()&&0===t.quantityForEvhAddOn())},t.prototype.render=function(){var e,n=this,a=this.state.subStatus,r=this.props,l=r.transitionPerformed,o=r.paymentInfo,s=this.state,u=s.loadingContent,m=s.submitting,_=s.hasLicenseKey;if(u)e=i.createElement("div",{className:"loading-indicator"},i.createElement("img",{src:N.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:C._("Loading")}));else{var g=void 0;if(a&&l&&!this.isProfessionalTrialPlan){h.DBModalStack.clear(),h.DBModalStack.register(c.CHANGE_IND_PLAN_MODAL_UPDATED,function(){t.showInstance({transitionPerformed:n.transitionPerformedClosure})}),g=i.createElement(d.CancellableNotificationsView,{subStatus:a,transitionPerformed:this.transitionPerformedClosure,displaySingleChangeCancellationItem:p.CancellationType.ALL,reOpenModalDialogAfterCancellation:!0,paymentInfo:o,hasLicenseKey:_,displayNewTotal:!1})}e=i.createElement("div",null,g,this.renderBillingSection(),this.renderFooter())}return i.createElement(f.Modal,{acceptButtonDisabled:this.acceptButtonDisabled,acceptButtonText:C._("Confirm change"),className:"change-plan-modal",dismissButtonText:C._("Cancel"),onDismiss:this.onDismissModal,autoClose:!1,onAccept:this.onAccept,submitting:m,title:C._("Change billing period")},e)},t.ChangeScheduleModal=l(t,["/static/css/teams/admin/widgets/change_plan_modal/change_plan_modal-vfl_9HI5q.css"]),t})(i.Component);t.ChangeScheduleModalView=x}),define("modules/clean/account_page/widgets/plan/views/disable_stacked_transitions_modal",["require","exports","tslib","modules/clean/react/css","external/react","modules/core/i18n","modules/clean/react/modal"],function(e,t,n,a,i,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onAccept=function(){l.Modal.close()},t}return n.__extends(t,e),t.showInstance=function(){l.Modal.showInstance(i.createElement(t.DisableStackedTransitionsModalView,null))},t.prototype.render=function(){return i.createElement(l.Modal,{title:r._("Cancel scheduled changes"),autoClose:!1,dismissButtonText:r._(""),onAccept:this.onAccept,className:"evh-removal-warning-modal"},i.createElement("div",null,i.createElement("p",{className:"evh-removal-warning-modal__desc"},r._("You’ll need to cancel your scheduled changes before making further changes.").format({}))))},t.DisableStackedTransitionsModalView=a(t,["/static/css/account/pagelet/evh_removal_warning-vfloW5p1U.css"]),t})(i.Component);t.DisableStackedTransitionsModal=o}),define("modules/clean/account_page/widgets/plan/views/evh_modal",["require","exports","tslib","modules/core/notify","external/react","modules/clean/ajax","modules/clean/react/css","external/classnames","modules/core/i18n","modules/clean/react_format","modules/clean/payments/skus/constants","modules/constants/account_page","modules/clean/account_page/widgets/plan/views/cancellable_notifications_view","modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal","modules/clean/account_page/widgets/plan/views/cancel_changes_modal","modules/clean/payments/cash","spectrum/checkbox","modules/clean/account_page/widgets/plan/views/individual_inline_payment_method","modules/clean/dbmodal_stack","modules/clean/account_page/widgets/plan/views/evh_removal_warning","modules/clean/react/modal","modules/constants/account_page","modules/clean/account_page/widgets/plan/types","modules/clean/analytics","modules/clean/payments/skus/subscription_service","modules/clean/payments/skus/subscription_change_plan","modules/clean/account_page/util"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m,h,_,g,f,b,y,S,v,E,P,C,w,T){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var N=(function(e){function t(t){var n=e.call(this,t)||this;return n.onAccept=function(){var e=n.props.evhInfo.purchased,t=e?E.PerformPlanTransition.REMOVE_EVH:E.PerformPlanTransition.ADD_EVH;n.setState(function(e){return e.submitting=!0,e}),r.WebRequest({url:"/account/perform_personal_transition",data:{transition_change_type:t},subject_user:T.getCurrentUser().id,success:function(e){a.Notify.success(s._("You’ve changed your plan!")),P.ProEventsLogger.log("de_evh_modal_toggle_evh"),n.props.transitionPerformed&&n.props.transitionPerformed(),S.Modal.close()},error:function(){a.Notify.error(s._("There was an error updating your plan!")),n.setState(function(e){return e.submitting=!1,e})}})},n.toggleEvh=function(){var e=n.props.evhInfo,t=n.state.isEvhSelected;e.scheduled_to_remove||(P.ProEventsLogger.log("de_evh_modal_change_evh_election",{from:t?"evh_on":"evh_off",to:t?"evh_off":"evh_on"}),n.setState({isEvhSelected:!t}))},n.cancelEvhChange=function(){return n.handleCancelActions(m.CancellationType.EVH_ADDON),!1},n.handleCancelActions=function(e){var t=n.props.subStatus;return t&&h.CancelChangesModalConfirmationView.showInstance({subStatus:t,transitionPerformed:n.props.transitionPerformed,cancellationType:e,reOpenModalDialogAfterCancellation:!0}),!1},n.transitionPerformedClosure=function(){if(n.props.transitionPerformed)return n.props.transitionPerformed()},n.onAcceptEvhRemovalWarning=function(){y.EvhRemovalWarningModal.showInstance({evhInfo:n.props.evhInfo,transitionPerformed:n.props.transitionPerformed,subStatus:n.props.subStatus})},new C.SubscriptionService,n.state={isEvhSelected:t.evhInfo.purchased,submitting:!1},n}return n.__extends(t,e),t.showInstance=function(e){S.Modal.showInstance(i.createElement(t.EvhModalViewModal,n.__assign({},e)))},t.prototype.isProfessionalPlanScheduled=function(){var e=this.props.subStatus;return!!(e&&e.scheduledSubState&&e.scheduledSubState.plan)&&(e.scheduledSubState.plan.productType===u.ProductPlanType.PROFESSIONAL||e.scheduledSubState.plan.productType===u.ProductPlanType.PROFESSIONAL_TRIAL)},t.prototype.isPlanScheduledToChange=function(){var e=this.props.subStatus;return!!(e&&e.subState.plan&&e.finalSubState.plan)&&e.subState.plan.productType!==e.finalSubState.plan.productType},t.prototype.isScheduledToChange=function(){return this.isPlanScheduledToChange()||this.isBillingScheduleToChange()||this.isEvhScheduledToChange()},t.prototype.isEvhScheduledToChange=function(){var e=this.props.subStatus;return!(!e||!e.scheduledSubState)&&e.subState.quantityForEvhAddOn()!==e.scheduledSubState.quantityForEvhAddOn()},t.prototype.isBillingScheduleToChange=function(){var e=this.props.subStatus;return!!(e&&e.subState.billingSchedule&&e.finalSubState.billingSchedule)&&e.subState.billingSchedule.id!==e.finalSubState.billingSchedule.id},t.prototype.renderFooter=function(){var e=this.props,t=e.evhInfo,n=e.subStatus,a=this.state.isEvhSelected;if(t.scheduled_to_remove)return i.createElement("p",{className:"evh-modal-footer"},s._("You’ve already requested a plan change. If you want to choose a different plan,           first cancel your pending change.")," ",i.createElement("a",{onClick:this.cancelEvhChange},s._("Cancel change")));if(t.evh_transition&&n.subState&&n.subState.plan&&n.scheduledSubState&&n.scheduledSubState.plan){var r=w.SubscriptionChangePlan.deserialize(t.evh_transition);if(a){if(t.purchased)return v.NO_RESET_INTERVAL_FOR_USERS&&this.isScheduledToChange()&&n.scheduledSubState&&n.scheduledSubState.plan?i.createElement("p",{className:"evh-modal-footer"},c.reactFormat(s._("Starting on %(date)s, we’ll bill you once a %(schedule_noun)s for your                 Dropbox %(plan_name)s plan and your new %(schedule)s total will be %(scheduled_total)s.").format({plan_name:n.scheduledSubState.plan.displayName(),date:n.subState.formattedNextBillingDate,schedule:n.scheduledSubState.billingSchedule.scheduleDescriptionAdjective,schedule_noun:n.scheduledSubState.billingSchedule.scheduleDescriptionNoun,scheduled_total:_.Cash.formatWithTaxLabels(n.nextBillingSummary.total,n.nextBillingSummary)}),{strong:i.createElement("strong",null)})):i.createElement("p",{className:"evh-modal-footer"},s._("Your Dropbox %(plan_name)s + extended version history plan will renew on %(date)s.                 Your current %(billing_schedule)s total is %(total)s.").format({plan_name:n.subState.plan.displayName(),date:n.subState.formattedNextBillingDate,billing_schedule:n.subState.billingSchedule.scheduleDescriptionAdjective,total:n.currentBillingSummary?_.Cash.formatWithTaxLabels(n.currentBillingSummary.total,n.currentBillingSummary):""}));var l="";return r.tvm&&(l=_.Cash.formatWithTaxLabels(r.tvm.getTotalPrice(),r.nextBillingSummary)),i.createElement("div",{className:"evh-modal-footer"},i.createElement("span",{className:"change-summary"},s._("Change summary")),i.createElement("p",null,c.reactFormat(s._("You’re adding extended version history to your Dropbox %(plan_name)s plan.                   <strong>We’ll charge you %(prorated_price)s now</strong>, which has been prorated                   for the current billing period. Your plan will renew on %(date)s. Your new %(billing_schedule)s                   total will be %(recurring_total)s.").format({plan_name:n.scheduledSubState.plan.displayName(),prorated_price:l,date:n.subState.formattedNextBillingDate,billing_schedule:r.subState.billingSchedule.scheduleDescriptionAdjective,recurring_total:_.Cash.formatWithTaxLabels(r.nextBillingSummary.total,r.nextBillingSummary)}),{strong:i.createElement("strong",null)})))}return t.purchased&&r.scheduledSubState?i.createElement("div",{className:"evh-modal-footer"},i.createElement("span",{className:"change-summary"},s._("Change summary")),i.createElement("p",null,c.reactFormat(s._("Starting on %(date)s, your plan will be downgraded to Dropbox %(plan_name)s                 <strong>without</strong> extended version history. You will revert to %(days)s day version history.                 Your new %(billing_schedule)s total will be %(scheduled_total)s.").format({date:n.subState.formattedNextBillingDate,plan_name:n.scheduledSubState.plan.displayName(),days:this.isProfessionalPlanScheduled()?"120":"30",billing_schedule:r.scheduledSubState.billingSchedule.scheduleDescriptionAdjective,scheduled_total:_.Cash.formatWithTaxLabels(r.nextBillingSummary.total,r.nextBillingSummary)}),{strong:i.createElement("strong",null)}))):i.createElement("p",{className:"evh-modal-footer"},s._("Your Dropbox %(plan_name)s plan will renew on %(date)s.").format({plan_name:n.subState.plan.displayName(),date:n.subState.formattedNextBillingDate})," ",s._("Your current %(billing_schedule)s total is %(total)s.").format({billing_schedule:n.subState.billingSchedule.scheduleDescriptionAdjective,total:n.currentBillingSummary?_.Cash.formatWithTaxLabels(n.currentBillingSummary.total,n.currentBillingSummary):""}))}},t.prototype.showModalClosure=function(e){var t=this;return function(){t.props.transitionPerformed&&t.props.transitionPerformed()}},t.prototype.getModalContent=function(){var e=this.props,t=e.evhInfo,n=e.subStatus,a=e.paymentInfo,r=this.state.isEvhSelected,l=r,c=s._("year");n.subState.billingSchedule&&(c=n.subState.billingSchedule.scheduleDescriptionNoun);var d=o({"evh-modal-toggle-box-price-box__price":!0,"evh-modal-toggle-box-price-box__price--disabled":t.scheduled_to_remove}),h=s._("See all deletion and version history of your files for one year.");return n.subState.addons.peekSkus()&&n.subState.addons.sku.adminCxId===u.AdminCxId.UNLIMITED_PAID_VERSION_HISTORY&&(h=s._("See all deletion and version history of your files for unlimited time.")),i.createElement("div",null,i.createElement(p.CancellableNotificationsView,{subStatus:n,transitionPerformed:this.transitionPerformedClosure,displaySingleChangeCancellationItem:m.CancellationType.ALL,reOpenModalDialogAfterCancellation:!0,paymentInfo:a,displayNewTotal:!1}),i.createElement("div",{className:"evh-modal-toggle-box"},i.createElement("div",{className:"evh-modal-toggle-box__toggle-btn"},i.createElement(g.Checkbox,{checked:l?"checked":"unchecked",onChange:this.toggleEvh,disabled:t.scheduled_to_remove})),i.createElement("div",{className:"evh-modal-toggle-box__desc"},i.createElement("label",{onClick:this.toggleEvh},i.createElement("p",{className:"evh-modal-toggle-box__desc-title"},s._("Extended version history"))),i.createElement("p",{className:"evh-modal-toggle-box__desc-description"},h),i.createElement("a",{className:"evh-modal-toggle-box__desc-link",href:"/help/security/extended-version-history",target:"_blank",rel:"noopener noreferrer"},s._("See EVH details"))),i.createElement("div",{className:"evh-modal-toggle-box-price-box"},i.createElement("p",{className:d},t.evh_price),i.createElement("span",{className:"evh-modal-toggle-box-price-box__price-desc"},s._("per %(schedule_noun)s").format({schedule_noun:c})))),this.renderFooter(),this.renderPaymentMethod())},t.prototype.renderPaymentMethod=function(){var e=this.props.paymentMethod;if(!this.acceptButtonDisabled&&e)return i.createElement("div",{className:"upgrade-payment-method-link"},i.createElement(f.IndividualInlinePaymentMethodView,{paymentMethod:e,showModal:this.showModalClosure(this.props)}))},Object.defineProperty(t.prototype,"acceptButtonDisabled",{get:function(){var e=this.props.evhInfo
;return this.state.isEvhSelected===e.purchased||e.scheduled_to_remove},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this.props,t=e.subStatus,n=e.transitionPerformed,a=this.state,r=a.submitting,l=a.isEvhSelected;t&&n&&b.DBModalStack.clear();var o=this.onAccept;return d.ACCOUNT_TAURUS_PLANS&&!l&&(o=this.onAcceptEvhRemovalWarning),i.createElement(S.Modal,{autoClose:!1,acceptButtonDisabled:this.acceptButtonDisabled,acceptButtonText:s._("Save change"),dismissButtonText:s._("Cancel"),onAccept:o,submitting:r,className:"evh-modal",title:s._("Edit EVH add-on")},this.getModalContent())},t.EvhModalViewModal=l(t,["/static/css/account/pagelet/evh_modal-vfltl8w3-.css"]),t})(i.Component);t.EvhModalView=N}),define("modules/clean/account_page/widgets/plan/views/evh_removal_warning",["require","exports","tslib","modules/clean/ajax","modules/clean/react/css","modules/core/notify","external/react","modules/core/i18n","modules/clean/account_page/util","modules/clean/account_page/widgets/plan/types","modules/clean/react/modal","modules/clean/analytics","modules/clean/payments/skus/constants"],function(e,t,n,a,i,r,l,o,s,c,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(t){var n=e.call(this,t)||this;return n.onAccept=function(){var e=n.props.evhInfo.purchased,t=e?c.PerformPlanTransition.REMOVE_EVH:c.PerformPlanTransition.ADD_EVH;n.setState(function(e){return e.submitting=!0,e}),a.WebRequest({url:"/account/perform_personal_transition",data:{transition_change_type:t},subject_user:s.getCurrentUser().id,success:function(e){r.Notify.success(o._("You’ve changed your plan!")),d.ProEventsLogger.log("de_evh_modal_toggle_evh"),n.props.transitionPerformed&&n.props.transitionPerformed(),u.Modal.close()},error:function(){r.Notify.error(o._("There was an error updating your plan!")),n.setState(function(e){return e.submitting=!1,e})}})},n.state={submitting:!1},n}return n.__extends(t,e),t.showInstance=function(e){u.Modal.showInstance(l.createElement(t.EvhRemovalWarningModalView,n.__assign({},e)))},t.prototype.render=function(){var e=this.props.subStatus,t=this.state.submitting;if(!e||!e.subState.plan)return l.createElement("noscript",null);var n=e.subState.plan.productType===p.ProductPlanType.PROFESSIONAL?"120":"30";return l.createElement(u.Modal,{title:o._("Removing EVH is permanent"),acceptButtonDisabled:this.state.submitting,autoClose:!1,acceptButtonText:o._("Confirm removal"),dismissButtonText:o._("Cancel change"),onAccept:this.onAccept,className:"evh-removal-warning-modal",submitting:t},l.createElement("div",null,l.createElement("p",{className:"evh-removal-warning-modal__desc"},o._("Are you sure you want to remove extended version history? Once you remove it,\n                  you won’t be able to add it back again. Your plan will change from one year of\n                  version history to the Dropbox %(plan)s length of %(days)s days\n                  of version history.").format({plan:e.subState.plan.displayName(!1,!0),days:n}))))},t.EvhRemovalWarningModalView=i(t,["/static/css/account/pagelet/evh_removal_warning-vfloW5p1U.css"]),t})(l.Component);t.EvhRemovalWarningModal=m}),define("modules/clean/account_page/widgets/plan/views/individual_inline_payment_method",["require","exports","tslib","modules/clean/payments/billing_info_modal","modules/clean/dbmodal_stack","external/react","modules/core/i18n","modules/clean/react_format","modules/clean/account_page/widgets/billing/payment_method_constants","modules/clean/react/payments/update_billing_individual/individual_update_billing_modal_loader","modules/clean/react/modal"],function(e,t,n,a,i,r,l,o,s,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.updateBillingInfo=function(e){var n=t.props.showModal;e.stopPropagation(),e.preventDefault(),u.Modal.close(),i.DBModalStack.register(a.BILLING_INFO_UPDATED,function(){n&&n()}),c.IndividualUpdateBillingModalLoader.showInstance()},t}return n.__extends(t,e),t.prototype.renderCreditCard=function(){var e=this.props.paymentMethod;if(e){var t=e.account_short.slice(-4),n=l._("We’ll charge your card ending in %(last4)s.").format({last4:t});return r.createElement("span",null,n," ",this.renderUpdateLink())}return r.createElement("span",null)},t.prototype.renderDirectDebit=function(){var e=this.props.paymentMethod;if(e){var t=e.account_short.slice(-4),n=l._("We’ll charge your IBAN ending in %(last4)s.").format({last4:t});return r.createElement("span",null,n," ",this.renderUpdateLink())}return r.createElement("span",null)},t.prototype.renderPaypal=function(){return r.createElement("span",null,l._("We’ll charge your PayPal account.")," ",this.renderUpdateLink())},t.prototype.renderUpdateLink=function(){return o.reactFormat(l._("<a>Update billing information</a>"),{a:r.createElement("a",{key:"updateBillingInfo",href:"#",onClick:this.updateBillingInfo})})},t.prototype.render=function(){var e=this.props.paymentMethod;if(!e)return r.createElement("span",null);switch(e.gateway_id){case s.BRAINTREE:return this.renderCreditCard();case s.ADYEN_SEPA_GATEWAY:return this.renderDirectDebit();case s.PAYPAL:case s.PAYPAL_REFERENCE_TRANSACTION:return this.renderPaypal();default:return r.createElement("span",null)}},t})(r.Component);t.IndividualInlinePaymentMethodView=d}),define("modules/clean/account_page/widgets/plan/views/plan_container",["require","exports","tslib","modules/clean/payments/billing_info_modal","external/react","external/react-redux","modules/clean/react/css","modules/clean/web_timing_logger","modules/clean/account_page/util","modules/clean/account_page/widgets/billing/payment_methods_util","modules/clean/account_page/widgets/plan/views/add_ons","modules/clean/account_page/widgets/plan/views/upsell_module","modules/clean/account_page/widgets/plan/views/cancel_plan","modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal","modules/clean/dbmodal_stack","modules/clean/account_page/widgets/plan/action_creators","modules/clean/account_page/widgets/billing/action_creators","modules/clean/account_page/widgets/plan/add_ons/action_creators","modules/clean/account_page/widgets/plan/plan_spectrum/action_creators","modules/clean/account_page/widgets/plan/referral_history/action_creators","modules/clean/account_page/widgets/plan/views/plan_status","modules/clean/account_page/widgets/plan/views/plan_spectrum","modules/clean/payments/skus/constants","modules/clean/account_page/widgets/plan/views/quota_usage","modules/clean/account_page/components/loading","modules/clean/account_page/widgets/plan/views/referral_space","modules/clean/account_page/widgets/plan/views/cancellable_notifications_view","modules/clean/analytics","modules/clean/payments/skus/subscription_status","modules/clean/stormcrow/experiment","modules/constants/trademark","modules/core/i18n","modules/clean/payments/skus/sku_content","modules/core/exception"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m,h,_,g,f,b,y,S,v,E,P,C,w,T,N,x,I,k,L,A,D){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var M=function(e){return{evhInfo:e.planTab.evhInfo,evhLoadingState:e.planTab.evhLoadingState,planInfo:e.planTab.planInfo,planSpectrumInfo:e.planTab.planSpectrumInfo,planSpectrumLoadingState:e.planTab.planSpectrumLoadingState,loadingState:e.planTab.loadingState,referralHistory:e.planTab.referralHistory,referralLoadingState:e.planTab.referralLoadingState,dataLoadedForTTI:"ready"===e.planTab.evhLoadingState&&"ready"===e.planTab.loadingState&&"ready"===e.planTab.referralLoadingState}},B=function(e){return{loadPlanInfo:function(t){return e(_.loadDataIfNecessary(t))},loadEvhInfo:function(t){return e(f.loadEvhInfoIfNecessary(t))},loadReferralHistory:function(t,n){return void 0===t&&(t=!1),void 0===n&&(n=0),e(y.loadReferralHistoryIfNecessary(t,n))},forceLoadBillingTab:function(t){return e(g.loadDataIfNecessary(t))},loadPlanSpectrum:function(t){return e(b.loadPlanSpectrum(t))}}},O=(function(e){function t(t){var n=e.call(this,t)||this;return n.forceReload=function(){var e=n.props,t=e.loadEvhInfo,a=e.loadPlanInfo,i=e.forceLoadBillingTab,r=e.loadPlanSpectrum;t(!0),a(!0),i(!0),r(!0)},h.DBModalStack.register(a.BILLING_INFO_UPDATED,function(){N.ProEventsLogger.log("de_payment_modal_save_click"),n.props.loadPlanInfo(!0),n.props.forceLoadBillingTab(!0)}),n}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.props.loadPlanInfo(),this.props.loadReferralHistory(),this.props.loadEvhInfo(),this.props.loadPlanSpectrum(),this.checkTTIstate(),N.ProEventsLogger.log("de_plan_tab_view")},t.prototype.componentDidUpdate=function(){this.checkTTIstate()},t.prototype.checkTTIstate=function(){this.props.dataLoadedForTTI&&(o.mark_time_to_view(),o.mark_time_to_interactive())},Object.defineProperty(t.prototype,"isPersonalUser",{get:function(){return"personal"===s.getCurrentUser().role},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBusinessUser",{get:function(){return!this.isPersonalUser},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLicensePlan",{get:function(){var e=this.props.planInfo;if(!e)return!1;var t=e.paymentInfo;return t&&c.isLicenseKey(t.gateway_id)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasLicenseKey",{get:function(){var e=this.props.planInfo;return!!e&&e.hasLicenseKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLimitedTeam",{get:function(){return this.props.planInfo.isLimitedTeam},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subStatus",{get:function(){var e=this.props.planInfo.serializedSubStatus;if(e)return x.SubscriptionStatus.deserialize(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isExternallyBilled",{get:function(){return void 0===this.subStatus},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPlusTrialPlan",{get:function(){return!(!this.subStatus||!this.subStatus.subState.plan)&&(this.subStatus.subState.plan.productType===E.ProductPlanType.TRIAL||this.subStatus.subState.plan.productType===E.ProductPlanType.PLUS_TRIAL)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isProfessionalTrialPlan",{get:function(){return!(!this.subStatus||!this.subStatus.subState.plan)&&this.subStatus.subState.plan.productType===E.ProductPlanType.PROFESSIONAL_TRIAL},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expSubgrowthBizWebClientUpsell",{get:function(){return I.Experiment(this.props.planInfo.expSubgrowthBizWebClientUpsell)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expUjPlanSpectrumUpsell",{get:function(){return I.Experiment(this.props.planSpectrumInfo.variant)},enumerable:!0,configurable:!0}),t.prototype.isLoading=function(){return"ready"!==this.props.loadingState},t.prototype.renderAddOnsIfAvailable=function(){var e=this.props,t=e.evhInfo,n=e.evhLoadingState,a=e.planInfo,r=this.props.planInfo,l=r.paymentMethod,o=r.paymentInfo;if(!this.isLicensePlan&&t.is_available&&this.subStatus&&this.subStatus.subState.plan&&this.subStatus.subState.plan.productType!==E.ProductPlanType.FREE&&(this.isPersonalUser||this.isLimitedTeam))return i.createElement(u.AddOns,{subStatus:this.subStatus,scheduledForDowngrade:a.scheduledForDowngrade,evhInfo:t,evhLoadingState:n,paymentInfo:o,paymentMethod:l,transitionPerformed:this.forceReload})},t.prototype.renderUsageBreakdown=function(){var e=this.props.planInfo,t=e.isMSLTeamMember,n=e.isMSLUserOn,a=e.usageBreakdown,r=e.isTeamAdmin,l=e.plusSkuContent;if(!t||n)return i.createElement(P.QuotaUsage,{subStatus:this.subStatus,usageBreakdown:a,isPersonalUser:this.isPersonalUser,isLimitedTeam:this.isLimitedTeam,isMSLTeamMember:t,isTeamAdmin:r,plusSkuContent:l})},t.prototype.renderTotalTeamUsageBreakdown=function(){var e=this.props.planInfo,t=e.teamUsageBreakdown,n=e.plusSkuContent;if(t)return i.createElement(P.QuotaUsage,{subStatus:this.subStatus,usageBreakdown:t,isPersonalUser:!1,isLimitedTeam:!1,isMSLTeamMember:!1,plusSkuContent:n})},t.prototype.renderUpsell=function(){var e,t,n,a=this.props.planInfo,r=a.bizTrialDays,l=a.ncctVariant,o=a.ncctVariantCoalesced,s=a.isNcctTeam,c=a.serializedSubStatus,u=a.standardSkuContent,p=A.SkuContentClient.deserialize(u);if(D.assert(!p.hasUnlimitedSpace(),"Unlimited space is not implemented yet"),I.Experiment(l).variantIn("V10","V11","V12","V13")&&s)e=L._("Want to keep using Dropbox with your team?"),t=L._("Add your billing information so you don’t have to later. You’ll still get the         remaining days in your trial for free, and you won’t be charged until %(trial_end_date)s         after your free trial ends.").format({trial_end_date:c.scheduledSubState.formattedNextBillingDate}),n={text:L._("Keep %(trademark_business)s").format({trademark_business:k.TRADEMARK_BUSINESS}),link:"/business/billing"};else{if(!this.expSubgrowthBizWebClientUpsell.variantIn("V1","V2"))return null;e=L._("Interested in Dropbox for your team?"),t=L._("With %(trademark_business)s, get %(plan_size)s or more for your team to securely share,         sync, and collaborate. Enjoy advanced data protection, admin controls, and dedicated support.").format({trademark_business:k.TRADEMARK_BUSINESS,plan_size:p.spaceShortFormTb()});n={text:I.Experiment(o).variantIs("V12")?L._("Try it free"):L._("Try free for %(trial_days)s days").format({trial_days:r}),link:"/business/try"}}return i.createElement(d.UpsellModule,{headline:e,text:t,cta:n})},t.prototype.render=function(){var e=this.props,t=e.evhInfo,n=e.planSpectrumInfo,a=this.props.planInfo,r=a.usageBreakdown,l=a.referralInfo,o=a.scheduledForDowngrade,u=a.paymentInfo,d=a.eligibleFor1tb,h=a.teamScheduledForDowngrade,_=a.isTeamAdmin,g=a.hasLicenseKey,f=a.hasUnusedLicenseKey,b=a.expWebAccountAndroidTrials,y=a.basicSkuContent,E=a.plusSkuContent,P=this.subStatus;if(this.isLoading())return i.createElement(C.Loading,null);var N=void 0;this.isExternallyBilled||o||this.isProfessionalTrialPlan||!this.isPersonalUser&&!this.isLimitedTeam||!u||c.shouldHideBillingChange(u.gateway_id,u.is_external_billing)||(N=i.createElement(p.CancelPlan,{usageBreakdown:r,subStatus:P,eligibleFor1tb:d,basicSkuContent:y}));var x,I=this.isBusinessUser&&!this.isLimitedTeam?void 0:i.createElement(w.ReferralSpace,{referralInfo:l,referralHistory:this.props.referralHistory,referralLoadingState:this.props.referralLoadingState}),k=this.isProfessionalTrialPlan?m.CancellationType.SCHEDULE:m.CancellationType.ALL;this.isExternallyBilled||this.isLicensePlan||this.isPlusTrialPlan||!this.isPersonalUser&&!this.isLimitedTeam||this.hasLicenseKey||(x=i.createElement(T.CancellableNotificationsView,{paymentInfo:u,subStatus:P,scheduledForDowngrade:o,transitionPerformed:this.forceReload,displaySingleChangeCancellationItem:k,reOpenModalDialogAfterCancellation:!1,displayNewTotal:!0}));var L=i.createElement(S.PlanStatus,{subStatus:P,scheduledForDowngrade:o,teamScheduledForDowngrade:h,showTeamScheduledForDowngrade:!1,evhInfo:t,onUpdate:this.forceReload,isPersonalUser:this.isPersonalUser,isLimitedTeam:this.isLimitedTeam,isExternallyBilled:this.isExternallyBilled,paymentInfo:u,isTeamAdmin:_,hasLicenseKey:g,hasUnusedLicenseKey:f,usageBreakdown:r,eligibleFor1tb:d,showCancelButton:!1,showChangeBillingPeriod:!0,isLoggedInUser:!0,isLoggedInAsTransactionOwner:!0,useSpecifiedRole:!1,planSpectrumVariant:n.variant,expWebAccountAndroidTrials:b});return i.createElement("div",{className:"account-plan-tab"},x,this.renderUpsell(),!this.expSubgrowthBizWebClientUpsell.variantIn("V1","V2","CONTROL")&&this.expUjPlanSpectrumUpsell.variantIs("ON")&&i.createElement(v.PlanSpectrum,{subStatus:P,user:s.getCurrentUser(),basicSkuContent:y,plusSkuContent:E}),this.expSubgrowthBizWebClientUpsell.variantIs("V2")?this.renderUsageBreakdown():L,this.renderAddOnsIfAvailable(),this.expSubgrowthBizWebClientUpsell.variantIs("V2")?L:this.renderUsageBreakdown(),this.renderTotalTeamUsageBreakdown(),I,N)},t})(i.Component);t.PlanContainerComponent=O;var R=r.connect(M,B)(O);t.PlanContainer=l(R,["/static/css/account/pagelet/plan_tab-vfl48_tPt.css"])}),define("modules/clean/account_page/widgets/plan/views/plan_spectrum",["require","exports","tslib","external/classnames","modules/clean/react/css","external/react","modules/core/browser","modules/core/i18n","modules/clean/static_urls","modules/constants/trademark","modules/clean/payments/skus/sku_content","modules/clean/payments/skus/constants","modules/clean/account_page/widgets/plan/plan_spectrum/types"],function(e,t,n,a,i,r,l,o,s,c,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=[d.ProductPlanType.PROFESSIONAL,d.ProductPlanType.PROFESSIONAL_TRIAL],h=function(e,t){var n=u.SkuContentClient.deserialize(e),a=u.SkuContentClient.deserialize(t);return i={},i[p.PlanType.Basic]={name:o._("Dropbox Basic"),image:"/static/images/growth/experiments/plan_spectrum/PlanIcons_Basic@2x-vflm-gFks.svg",faded:[p.PlanType.Plus,p.PlanType.Professional],caption:(r={},r[p.PlanType.Basic]={text:o._("Current plan")},r[p.PlanType.Plus]={text:n.spaceShortFormGb()},r[p.PlanType.Professional]={text:n.spaceShortFormGb()},r)},i[p.PlanType.Plus]={name:o._("Dropbox %(trademark_plus)s").format({trademark_plus:c.TRADEMARK_PLUS}),image:"/static/images/growth/experiments/plan_spectrum/PlanIcons_Plus@2x-vflCexdkY.svg",faded:[p.PlanType.Professional],caption:(l={},l[p.PlanType.Basic]={text:o._("Learn more"),link:"/plus?oqa=pspl",action:p.PlanSpectrumActions.BasicPlusClick},l[p.PlanType.Plus]={text:o._("Current plan")},l[p.PlanType.Professional]={text:a.spaceShortFormTb()},l)},i[p.PlanType.Professional]={name:o._("Dropbox Professional"),image:"/static/images/growth/experiments/plan_spectrum/PlanIcons_Professional@2x-vflUScX9j.svg",faded:[],caption:(s={},s[p.PlanType.Basic]={text:o._("Learn more"),link:"/pro?oqa=pspl",action:p.PlanSpectrumActions.BasicProClick},s[p.PlanType.Plus]={text:o._("Learn more"),link:"/pro?oqa=pspl",action:p.PlanSpectrumActions.PlusProClick},s[p.PlanType.Professional]={text:o._("Current plan")},s)},i;var i,r,l,s},_=(function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n.logAction=function(e){return function(t){t.preventDefault(),n.tracker.track(e),l.open_tab(t.currentTarget.href)}},n.renderColumn=function(e){var i=n.props,l=i.basicSkuContent,o=i.plusSkuContent,c=h(l,o)[e],u=n.state.planType,d=c.caption[u],p=a((m={},m[t.styles.column]=!0,m[t.styles.faded]=c.faded.indexOf(u)!==-1,m[t.styles.selected]=u===e,m));return r.createElement("div",{className:p,key:"column-"+e},r.createElement("img",{src:s.static_url(c.image),className:"illo",alt:""}),r.createElement("div",{className:t.styles.heading},c.name),d.link?r.createElement("a",{href:d.link,className:t.styles.captionLink,onClick:n.logAction(d.action)},d.text):r.createElement("div",{className:t.styles.caption},d.text));var m},n}return n.__extends(i,e),i.prototype.componentWillMount=function(){var e=this.props,t=e.subStatus,n=e.user,a=p.PlanType.Basic;t&&t.subState&&t.subState.plan&&(t.subState.plan.productFamily===d.ProductFamily.PRO?a=p.PlanType.Plus:m.indexOf(t.subState.plan.productType)!==-1&&(a=p.PlanType.Professional)),this.tracker=new p.PlanSpectrumTracker(n.id),this.setState({planType:a})},i.prototype.componentDidMount=function(){this.state.planType===p.PlanType.Basic?this.tracker.track(p.PlanSpectrumActions.BasicView):this.state.planType===p.PlanType.Plus&&this.tracker.track(p.PlanSpectrumActions.PlusView)},i.prototype.render=function(){var e=this.state.planType,n=[p.PlanType.Basic,p.PlanType.Plus,p.PlanType.Professional];return r.createElement("div",{className:t.styles.base},r.createElement("div",{className:t.styles.header},o._("Dropbox plans")),r.createElement("div",{className:t.styles.columns},n.map(this.renderColumn)),r.createElement("div",{className:t.styles.barWrapper},r.createElement("hr",{className:t.styles.bar}),r.createElement("div",{className:t.styles.barIcons},n.map(function(n){var i=a(t.styles.icon,(l={},l[t.styles.iconSelected]=n===e,l));return r.createElement("div",{className:i,key:"bar-"+n});var l}))))},i})(r.Component);t.PlanSpectrumComponent=_,t.styles={base:"plan-spectrum",header:"plan-spectrum__header",columns:"plan-spectrum__columns",column:"plan-spectrum__column",heading:"plan-spectrum__heading",caption:"plan-spectrum__caption",captionLink:"plan-spectrum__caption-link",faded:"plan-spectrum__column--faded",selected:"plan-spectrum__column--selected",plan:"plan-spectrum__plan",barWrapper:"plan-spectrum__bar-wrapper",bar:"plan-spectrum__bar",barIcons:"plan-spectrum__bar-icons",icon:"plan-spectrum__icon",iconSelected:"plan-spectrum__icon--selected"},t.PlanSpectrum=i(_,["/static/css/account/pagelet/plan_spectrum-vflhJiQUh.css"])}),define("modules/clean/account_page/widgets/plan/views/plan_status",["require","exports","tslib","modules/core/browser","modules/clean/deprecated/dbmodal_loading","external/react","modules/clean/viewer","modules/core/uri","modules/core/i18n","modules/core/exception","modules/constants/account_page","modules/clean/react/payments/update_billing_individual/individual_update_billing_modal_loader","modules/clean/account_page/widgets/billing/payment_methods_util","modules/clean/account_page/widgets/billing/payment_method_constants","modules/clean/account_page/util","modules/clean/static_urls","modules/clean/payments/cash","modules/clean/account_page/widgets/plan/views/change_plan_modal","modules/clean/account_page/widgets/plan/views/change_schedule_modal","modules/clean/account_page/widgets/plan/views/cancel_subs_warning_modal","modules/clean/dbmodal_stack","modules/clean/account_page/widgets/plan/views/disable_stacked_transitions_modal","modules/constants/account_page","modules/clean/payments/skus/constants","modules/clean/analytics","modules/clean/account_page/widgets/plan/plan_spectrum/types","modules/clean/react_format","modules/constants/trademark"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m,h,_,g,f,b,y,S,v,E,P,C,w,T,N){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var x;(function(e){e[e.Cancel=0]="Cancel",e[e.Change=1]="Change",e[e.Manage=2]="Manage",e[e.Upgrade=3]="Upgrade"})(x||(x={}));var I=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isOverQuota=function(){return t.usage>t.quota},t.logSeePlanDetails=function(){C.ProEventsLogger.log("de_plan_tab_details_click")},t.cancelPlanClick=function(){t.props.isPersonalUser?a.redirect("/downgrade"):a.redirect("/team/cancel")},t.onChangeBillingPeriodClick=function(e){if(e.preventDefault(),E.NO_RESET_INTERVAL_FOR_USERS&&E.DE_DISABLE_STACKED_TRANSITIONS&&t.pendingScheduledChange())return void v.DisableStackedTransitionsModal.showInstance();var n=t.props,a=n.scheduledForDowngrade,i=n.paymentInfo;a?y.CancelChangesModalConfirmation.showInstance({transitionPerformed:t.props.onUpdate,subStatus:t.props.subStatus}):(b.ChangeScheduleModalView.showInstance({transitionPerformed:t.props.onUpdate,paymentInfo:i}),C.ProEventsLogger.log("de_plan_tab_change_billing_open_modal"))},t.onUpdateBillingClick=function(e){e.preventDefault(),d.IndividualUpdateBillingModalLoader.showInstance()},t.redirectToUpgrade=function(){C.ProEventsLogger.log("de_plan_tab_upgrade_to_plus_click");var e=t.isOverQuota()?"acc_plan_upgrade_overquota_btn":"acc_plan_upgrade",n=new o.URI({path:"/upgrade",query:{oqa:e}}).toString();if("ON"===t.props.planSpectrumVariant){var i=h.getCurrentUser(),r=new w.PlanSpectrumTracker(i.id);n=new o.URI({path:"/upgrade",query:{oqa:"pspl"}}).toString(),r.track(w.PlanSpectrumActions.BasicUpgradeClick).then(function(){a.redirect(n)})}else a.redirect(n)},t.purchaseNowClick=function(){C.ProEventsLogger.log("de_plan_tab_purchase_now_click"),a.redirect("/pro/convert")},t.cancelTrialClick=function(){C.ProEventsLogger.log("de_plan_tab_cancel_trial_click"),a.redirect("/downgrade")},t.contactSupportClick=function(){C.ProEventsLogger.log("de_plan_tab_contact_support_click"),a.redirect("/support")},t.addPaymentClick=function(){C.ProEventsLogger.log("de_plan_tab_add_payment_method_click"),S.DBModalStack.push(new i({element_id:"add_billing_info",endpoint_url:"/add_billing_info_modal",html_in_error_msg:!0}))},t.openChangePlanModal=function(e){if(e&&e.preventDefault(),t.props.isLoggedInUser||(t.props.isPersonalUser?a.redirect("/account/plan"):a.redirect("/team/admin/billing/manage")),E.NO_RESET_INTERVAL_FOR_USERS&&E.DE_DISABLE_STACKED_TRANSITIONS&&t.pendingScheduledChange())return void v.DisableStackedTransitionsModal.showInstance();var n=t.props,i=n.scheduledForDowngrade,r=n.paymentInfo,l=n.planSpectrumVariant;if(i)y.CancelChangesModalConfirmation.showInstance({transitionPerformed:t.props.onUpdate,subStatus:t.props.subStatus,userIdOverride:t.getUserForModal()});else if(f.ChangePlanModalView.showInstance({transitionPerformed:t.props.onUpdate,paymentInfo:r,userIdOverride:t.getUserForModal()}),C.ProEventsLogger.log("de_plan_tab_change_plan_open_modal"),"ON"===l&&t.isPlusPlan()){var o=h.getCurrentUser(),s=new w.PlanSpectrumTracker(o.id);s.track(w.PlanSpectrumActions.PlusChangePlanClick)}},t.renderContactSupportLink=function(){return r.createElement("div",{className:"plan-status-section__contact_support_link"},r.createElement("a",{href:"#",onClick:t.contactSupportClick},s._("Contact support to change plan")))},t.renderBillingPeriod=function(){var e=t.props,n=e.paymentInfo,a=e.scheduledForDowngrade,i=e.hasUnusedLicenseKey;if(n&&t.props.showChangeBillingPeriod&&!i){var l=n.gateway_id,o=n.is_external_billing,c=n.end_date,u=n.deactivated,d=n.is_on_trial,m=n.reseller_name,h=n.reseller_link;if(!n.schedule_switchable&&!a&&!t.isProfessionalTrial()||p.shouldHideBillingChange(l,o)){var _=p.getBillingDisabledMessage({gatewayId:l,isExternalBilling:o,resellerName:m,resellerLink:h,dropboxPlan:N.TRADEMARK_PLUS,endDate:c,deactivated:u,isOnTrial:d});return r.createElement("span",{className:"plan-status-section__message"},_)}if(!t.isPlusTrial())return n.is_in_grace_period?r.createElement("a",{href:"#",className:"plan-status-section__link",onClick:t.onUpdateBillingClick},s._("Please update your billing information")):r.createElement("a",{href:"#",className:"plan-status-section__link",onClick:t.onChangeBillingPeriodClick},s._("Change billing period"))}},t.changePlanClick=function(){t.props.subStatus.subState.plan.isEnterprise?a.redirect("/team/admin/help?role=work"):a.redirect("/team/admin/billing/manage?show_switch_plan")},t.managePlanClick=function(){a.redirect("/team/admin/billing/manage")},t.createTrialCtaButtons=function(e,n){return void 0===e&&(e=!0),void 0===n&&(n=!1),n?r.createElement("div",{className:"plan-status-section__upgrade_btn trial-cta"},r.createElement("button",{className:"mc-button mc-button-secondary cancel-button",onClick:t.cancelTrialClick},s._("Cancel trial"))):e?r.createElement("div",{className:"plan-status-section__upgrade_btn trial-cta"},r.createElement("button",{className:"button-primary purchase-button",onClick:t.purchaseNowClick},s._("Purchase Now")),r.createElement("button",{className:"mc-button mc-button-secondary cancel-button",onClick:t.cancelTrialClick},s._("Cancel trial"))):r.createElement("div",{className:"plan-status-section__upgrade_btn trial-cta"},r.createElement("button",{className:"button-primary purchase-button",onClick:t.purchaseNowClick},s._("Purchase Now")))},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=a.get_href().match(/modal=([a-zA-Z_]*)/);if(e&&e.length>1){"plan"===e[1]&&this.isChangePlanSupported()&&this.openChangePlanModal()}},t.prototype.isChangePlanSupported=function(){var e=this.props,t=e.subStatus,n=e.eligibleFor1tb,a=e.isExternallyBilled,i=e.paymentInfo;return!!this.isInStandardSchedule()&&(!n&&(!!(i&&t&&t.subState.plan)&&(!p.shouldHideBillingChange(i.gateway_id,a)&&(this.isPlusPlan()||t.subState.plan.productType===P.ProductPlanType.PROFESSIONAL))))},Object.defineProperty(t.prototype,"usage",{get:function(){return this.props.usageBreakdown.usage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quota",{get:function(){return this.props.usageBreakdown.quota||.01},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"plansURL",{get:function(){var e=this.props,t=e.isLoggedInUser,n=e.isTransactionInformationPage,a={oqa:"acc_plan_upgrade"};return n&&!t&&(a.trigger="nr"),new o.URI({path:"/plans/individual",query:a}).toString()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"evhDisplayName",{get:function(){var e=this.props.evhInfo;return e.purchased?e.is_unlimited_evh?s._("unlimited version history"):s._("extended version history"):""},enumerable:!0,configurable:!0}),t.prototype.renderCancelPlanButton=function(){return this.props.isLoggedInUser&&!this.props.isLoggedInAsTransactionOwner?this.renderLoginInstructions(x.Cancel):r.createElement("div",{className:"plan-status-section__upgrade_btn"},r.createElement("button",{className:"mc-button-secondary",onClick:this.cancelPlanClick},s._("Cancel plan")))},t.prototype.isPlusPlan=function(){var e=this.props.subStatus;return!(!e||!e.subState.plan)&&(e.subState.plan.productType===P.ProductPlanType.STANDARD||e.subState.plan.productType===P.ProductPlanType.PLUS)},t.prototype.isProfessionalPlan=function(){var e=this.props.subStatus;return!(!e||!e.subState.plan)&&(e.subState.plan.productType===P.ProductPlanType.PROFESSIONAL||e.subState.plan.productType===P.ProductPlanType.PROFESSIONAL_TRIAL)},t.prototype.isFreePlusPlan=function(){var e=this.props.subStatus;return!(!e||!e.subState.plan)&&e.subState.plan.productType===P.ProductPlanType.FREE},t.prototype.isInStandardSchedule=function(){var e=this.props.subStatus;if(e&&e.subState&&e.subState.billingSchedule){var t=e.subState.billingSchedule.id;return t===P.ScheduleId.MONTHLY||t===P.ScheduleId.YEARLY}return!1},t.prototype.pendingScheduledChange=function(){return this.isPlanScheduledToChange()||this.isBillingScheduleToChange()||this.isEvhScheduledToChange()},t.prototype.isTaurusPlan=function(){var e=this.props.subStatus;if(e&&e.subState.plan){var t=e.subState.plan.productType;return t===P.ProductPlanType.PLUS||t===P.ProductPlanType.PLUS_TRIAL||t===P.ProductPlanType.PROFESSIONAL||t===P.ProductPlanType.PROFESSIONAL_TRIAL||t===P.ProductPlanType.PLUS_WITH_SS||t===P.ProductPlanType.PLUS_WITH_SS_TRIAL}return!1},t.prototype.isPlanScheduledToChange=function(){var e=this.props,t=e.subStatus;return!!e.scheduledForDowngrade||!!(t&&t.subState.plan&&t.finalSubState.plan)&&t.subState.plan.productType!==t.finalSubState.plan.productType},t.prototype.isEvhScheduledToChange=function(){var e=this.props.subStatus;return!(!e||!e.scheduledSubState)&&e.subState.quantityForEvhAddOn()!==e.scheduledSubState.quantityForEvhAddOn()},t.prototype.isBillingScheduleToChange=function(){var e=this.props.subStatus;return!!(e&&e.subState.billingSchedule&&e.finalSubState.billingSchedule)&&e.subState.billingSchedule.id!==e.finalSubState.billingSchedule.id},t.prototype.shouldDisplayChangePlan=function(){var e=this.getGatewayId();return e!==m.NOT_APPLICABLE&&!p.shouldHidePaymentMethod(e)&&!this.props.hasUnusedLicenseKey},t.prototype.getGatewayId=function(){var e=this.props.paymentInfo;return e?e.gateway_id:m.NOT_APPLICABLE},t.prototype.isTrialPlan=function(){return this.isPlusTrial()||this.isProfessionalTrial()},t.prototype.isPlusTrial=function(){var e=this.props.subStatus;return!(!e||!e.subState.plan)&&(e.subState.plan.productType===P.ProductPlanType.TRIAL||e.subState.plan.productType===P.ProductPlanType.PLUS_TRIAL)},t.prototype.isProfessionalTrial=function(){var e=this.props.subStatus;return!(!e||!e.subState.plan)&&e.subState.plan.productType===P.ProductPlanType.PROFESSIONAL_TRIAL},t.prototype.isLicensePlan=function(){var e=this.props,t=e.hasLicenseKey,n=e.paymentInfo;return!!n&&(t||p.isLicenseKey(n.gateway_id))},t.prototype.renderLoginInstructions=function(e){var t,n;return n=this.props.userEmail?this.props.userEmail:s._("the account user"),t=e===x.Cancel?T.reactFormat(s._("Please login as %(email)s<br />to cancel your plan."),{br:r.createElement("br",null),email:n
}):e===x.Change?T.reactFormat(s._("Please login as %(email)s<br />to change your plan."),{br:r.createElement("br",null),email:n}):e===x.Manage?T.reactFormat(s._("Please login as %(email)s<br />to manage your plan."),{br:r.createElement("br",null),email:n}):e===x.Upgrade?T.reactFormat(s._("Please login as %(email)s<br />to upgrade your plan."),{br:r.createElement("br",null),email:n}):T.reactFormat(s._("Please login as %(email)s."),{email:n}),r.createElement("div",{className:"plan-status-section__login-msg"},t)},t.prototype.getUserForModal=function(){var e=this.props,t=e.isPersonalUser,n=e.useSpecifiedRole,a=e.isLoggedInAsTransactionOwner,i=null;if(n&&a){var r=l.Viewer.get_viewer();i=t?r.personal_user?r.personal_user.id:null:r.work_user?r.work_user.id:null,c.assert(null!=i,"Could not find user for specified role; modal will fail")}return i},t.prototype.renderDropboxLogo=function(){return r.createElement("div",{className:"plan-status-section__icon u-mar-right-s"},r.createElement("img",{src:_.static_url("/static/images/logo_catalog/dropbox-business-icon_m1-vflczuza3.svg"),alt:""}))},t.prototype.getTeamName=function(){return this.props.isLoggedInAsTransactionOwner&&l.Viewer.get_viewer().team_name?l.Viewer.get_viewer().team_name:this.props.teamName?this.props.teamName:null},t.prototype.renderChangePlanButton=function(e){var t=this.props.paymentInfo;return this.props.isLoggedInUser&&!this.props.isLoggedInAsTransactionOwner?this.renderLoginInstructions(x.Change):r.createElement("div",{className:"plan-status-section__upgrade_btn"},r.createElement("button",{className:"button-primary",onClick:e,disabled:t&&t.is_in_grace_period},s._("Change plan")))},t.prototype.renderManagePlanButton=function(){return this.props.isLoggedInUser&&!this.props.isLoggedInAsTransactionOwner?this.renderLoginInstructions(x.Manage):r.createElement("div",{className:"plan-status-section__upgrade_btn"},r.createElement("button",{className:"button-tertiary",onClick:this.managePlanClick},s._("Manage plan")))},t.prototype.renderBusinessPlanSection=function(){var e=this.props,t=e.subStatus,n=e.isTeamAdmin,a=e.teamScheduledForDowngrade,i=e.showCancelButton;if(t&&t.subState.isDeactivatedTeam)return this.renderBasicPlanSection();if(t&&t.subState.plan){var l=t.subState.plan.productType===P.ProductPlanType.STANDARD,o=t.subState.plan.displayName(!1,l);l||(o=s._("%(trade_mark)s %(plan_title)s").format({trade_mark:N.TRADEMARK_BUSINESS,plan_title:o}));var c="",u=this.getTeamName();u&&(n?(c=s._("You’re an admin of the %(team_name)s Dropbox account.").format({team_name:u}),this.props.isLoggedInAsTransactionOwner||(c=s._("This account is an admin of the %(team_name)s Dropbox account.").format({team_name:u}))):(c=s._("You’re a member of the %(team_name)s Dropbox account.").format({team_name:u}),this.props.isLoggedInAsTransactionOwner||(c=s._("This account is a member of the %(team_name)s Dropbox account.").format({team_name:u}))));var d,p;if(this.props.isLoggedInUser&&!this.props.isLoggedInAsTransactionOwner)d=this.renderLoginInstructions(),p=null;else if(n||!this.props.isLoggedInUser){var m=t.subState.plan.productType;if(m===P.ProductPlanType.STANDARD||m===P.ProductPlanType.NEW_STANDARD||m===P.ProductPlanType.STANDARD_TRIAL?d=this.renderChangePlanButton(this.changePlanClick):m!==P.ProductPlanType.ADVANCED&&m!==P.ProductPlanType.ADVANCED_TRIAL||(d=this.renderManagePlanButton()),i&&(d=a?this.renderManagePlanButton():this.renderCancelPlanButton()),!t.subState.plan.isEnterprise){var h=s._("Manage your team in the Admin Console");this.props.isLoggedInAsTransactionOwner||(h=s._("Manage this team in the Admin Console")),p=r.createElement("p",null,r.createElement("a",{className:"plan-status-section__link",href:"/team/admin/billing/manage"},h))}}var _="";return this.props.showTeamScheduledForDowngrade&&a&&(_=s._("Any active members of your %(plan)s team will be downgraded to Dropbox Basic accounts         on %(date)s.").format({plan:o,date:t.formattedNextBillingDate}),this.props.isLoggedInAsTransactionOwner||(_=s._("Any active members of the %(plan)s team will be downgraded to Dropbox Basic accounts         on %(date)s.").format({plan:o,date:t.formattedNextBillingDate}))),r.createElement("div",{className:"plan-status-section"},this.renderDropboxLogo(),r.createElement("div",{className:"plan-status-section__description"},r.createElement("h1",{className:"plan-status-section__title"},o),r.createElement("span",null,c),r.createElement("br",null),r.createElement("span",null,_),p),d)}},t.prototype.renderUpgradePlanButton=function(e){return this.props.isLoggedInUser&&!this.props.isLoggedInAsTransactionOwner?this.renderLoginInstructions(x.Upgrade):r.createElement("div",{className:"plan-status-section__upgrade_btn"},r.createElement("button",{className:"button-primary",onClick:this.redirectToUpgrade},e))},t.prototype.renderBasicPlanSection=function(){var e=this.props,t=e.subStatus,n=e.isLimitedTeam,a=s._("Dropbox Basic");if(t){t.subState.plan&&(a=t.subState.plan.displayName());var i=void 0;if(n||t.subState.isDeactivatedTeam){var l=this.getTeamName(),o=s._("You’re a member of the %(team_name)s Dropbox account.").format({team_name:l});this.props.isLoggedInAsTransactionOwner||(o=s._("This account is a member of the %(team_name)s Dropbox account.").format({team_name:l})),i=r.createElement("p",{className:"plan-status-section__team_desc"},o)}var c=this.isOverQuota()?s._("Upgrade now"):s._("Upgrade");return r.createElement("div",{className:"plan-status-section"},this.renderDropboxLogo(),r.createElement("div",{className:"plan-status-section__description"},r.createElement("h1",{className:"plan-status-section__title"},a),i,r.createElement("a",{className:"plan-status-section__link",href:this.plansURL,target:"_blank",rel:"noopener noreferrer"},s._("See other plans"))),this.renderUpgradePlanButton(c))}},t.prototype.renderResellerPlan=function(){var e=s._("Dropbox %(plus)s 1TB").format({plus:N.TRADEMARK_PLUS});return r.createElement("div",{className:"plan-status-section"},this.renderDropboxLogo(),r.createElement("div",{className:"plan-status-section__description"},r.createElement("h1",{className:"plan-status-section__title"},e),r.createElement("p",{className:"plan-status-section__title_description"},this.renderBillingPeriod())))},t.prototype.renderPaidPlanSection=function(){var e=this.props,t=e.subStatus,n=e.evhInfo,a=e.expWebAccountAndroidTrials,i=e.isLimitedTeam,l=e.hasUnusedLicenseKey,o=e.paymentInfo,c=e.scheduledForDowngrade;if(t&&t.scheduledSubState&&t.subState.plan){var d,m=t.subState.plan;if(1024===m.specQuotaGb){var h=this.getGatewayId(),_=t.subState.plan.displayName(!1,!1,h,a);d=n.purchased?s._("Dropbox %(plus)s + %(evh)s").format({plus:_,evh:this.evhDisplayName,comment:"evh = Extended Version History"}):s._("Dropbox %(plus)s").format({plus:_})}else d=t.subState.plan.displayName(!0),n.purchased&&(d=s._("%(plus)s + %(evh)s").format({plus:d,evh:this.evhDisplayName,comment:"evh = Extended Version History"}));var f,b=void 0,y=void 0;if(o&&p.shouldHideBillingSummary(o.gateway_id,t.subState.plan.productType)?f="":t.currentBillingSummary&&t.subState.billingSchedule&&(f=s._("%(total)s per %(period)s.").format({total:g.Cash.formatWithTaxLabels(t.currentBillingSummary.total,t.currentBillingSummary),period:t.subState.billingSchedule.scheduleDescriptionNoun})),l&&(f=s._("Your license key will be activated and no         charge made to your payment method on file."),this.props.isLoggedInAsTransactionOwner||(f=s._("This account’s license key will be activated and no         charge made to the payment method on file."))),o&&!p.shouldHideBillingChange(o.gateway_id,o.is_external_billing)){var S="";if(this.pendingScheduledChange()&&t.scheduledSubState&&t.scheduledSubState.plan&&t.scheduledSubState.billingSchedule){var v=t.scheduledSubState.plan,E=void 0;if(1024===v.specQuotaGb){var _=t.scheduledSubState.plan.displayName(!1);E=n.purchased&&!n.scheduled_to_remove?s._("Dropbox %(plus)s + %(evh)s").format({plus:_,evh:this.evhDisplayName,comment:"evh = Extended Version History"}):s._("Dropbox %(plus)s").format({plus:_})}else E=t.scheduledSubState.plan.displayName(!0),n.purchased&&!n.scheduled_to_remove&&(E=s._("%(plus)s + %(evh)s").format({plus:E,evh:this.evhDisplayName,comment:"evh = Extended Version History"}));S=s._("Starting on %(date)s, we’ll bill you once a %(new_period_noun)s for your           %(plan)s plan. Your new %(new_period_adj)s total will be %(new_amount)s.").format({date:t.formattedNextBillingDate,new_period_noun:t.scheduledSubState.billingSchedule.scheduleDescriptionNoun,plan:E,new_period_adj:t.scheduledSubState.billingSchedule.scheduleDescriptionAdjective,new_amount:g.Cash.formatWithTaxLabels(t.nextBillingSummary.total,t.nextBillingSummary)}),this.props.isLoggedInAsTransactionOwner||(S=s._("Starting on %(date)s, we’ll bill this account once a %(new_period_noun)s for           the %(plan)s plan. This account’s new %(new_period_adj)s total will be           %(new_amount)s.").format({date:t.formattedNextBillingDate,new_period_noun:t.scheduledSubState.billingSchedule.scheduleDescriptionNoun,plan:E,new_period_adj:t.scheduledSubState.billingSchedule.scheduleDescriptionAdjective,new_amount:g.Cash.formatWithTaxLabels(t.nextBillingSummary.total,t.nextBillingSummary)}))}else S=s._("Your %(plan)s plan will renew on %(date)s. %(billing_summary)s").format({plan:d,date:t.formattedNextBillingDate,billing_summary:f}),this.props.isLoggedInAsTransactionOwner||(S=s._("This account’s %(plan)s plan will renew on %(date)s. %(billing_summary)s").format({plan:d,date:t.formattedNextBillingDate,billing_summary:f}));b=r.createElement("span",null,S," ")}if(c){var P=s._("Your %(plan)s will downgrade to Dropbox Basic on         %(date)s.").format({plan:d,date:t.formattedNextBillingDate});this.props.isLoggedInAsTransactionOwner||(P=s._("This account’s %(plan)s will downgrade to Dropbox         Basic on %(date)s.").format({plan:d,date:t.formattedNextBillingDate})),b=r.createElement("span",null,P," ")}if(i){var C=this.getTeamName(),w=s._("You’re a member of the %(team_name)s Dropbox account.").format({team_name:C});this.props.isLoggedInAsTransactionOwner||(w=s._("This account is a member of the %(team_name)s Dropbox account.").format({team_name:C})),y=r.createElement("p",{className:"plan-status-section__team_desc"},w)}var T;return!o||p.shouldHideBillingChange(o.gateway_id,o.is_external_billing)||this.isInStandardSchedule()||(T=this.renderContactSupportLink()),u.ACCOUNT_TAURUS_PLANS&&this.shouldDisplayChangePlan()&&this.isInStandardSchedule()&&(this.isPlusPlan()&&!this.isTrialPlan()&&(T=this.renderChangePlanButton(this.openChangePlanModal)),this.isProfessionalPlan()&&!this.isTrialPlan()&&(T=this.renderChangePlanButton(this.openChangePlanModal))),this.props.showCancelButton&&!c&&(T=this.renderCancelPlanButton()),(this.isFreePlusPlan()||l)&&(T=this.renderContactSupportLink()),r.createElement("div",{className:"plan-status-section"},this.renderDropboxLogo(),r.createElement("div",{className:"plan-status-section__description"},r.createElement("h1",{className:"plan-status-section__title"},d),y,r.createElement("p",{className:"plan-status-section__title_description"},b,!l&&this.renderPlanDetails(),r.createElement("br",null),this.renderBillingPeriod())),T)}},t.prototype.renderPlanDetails=function(){return r.createElement("a",{className:"plan-status-section__link",onClick:this.logSeePlanDetails,href:this.plansURL,target:"_blank",rel:"noopener noreferrer"},this.isTaurusPlan()?s._("See plan details"):s._("See available plans"))},t.prototype.renderTrialSection=function(){var e=this.props,t=e.expWebAccountAndroidTrials,n=e.subStatus,a=e.paymentInfo;if(n&&n.subState&&n.subState.plan&&a){var i=a.gateway_id,l=a.trial_info;if(l){var o=r.createElement("noscript",null);p.isIOS(i)||"V1"===t&&p.isAndroid(i)||(o=this.createTrialCtaButtons(!l.is_trial_overdue,this.isProfessionalTrial()));var c=s._("Dropbox %(plus)s").format({plus:n.subState.plan.displayName(!1,!1,i,t)});l.is_trial_overdue&&(c+=" "+s._("(Expired)"));var u;return u=this.isProfessionalTrial()?p.getProfessionalTrialPlanDescription(n):p.getTrialDescription(i,l,n.formattedNextBillingDate,t),r.createElement("div",{className:"plan-status-section"},this.renderDropboxLogo(),r.createElement("div",{className:"plan-status-section__description"},r.createElement("h1",{className:"plan-status-section__title"},c),r.createElement("p",{className:"plan-status-section__title_description"},u," ",this.isProfessionalTrial()&&r.createElement("span",null,this.renderPlanDetails(),r.createElement("br",null),this.renderBillingPeriod()))),o)}}},Object.defineProperty(t.prototype,"hasSelfServablePaymentAfterLicensekey",{get:function(){var e=this.props.paymentInfo;return e&&!p.isLicenseKey(e.gateway_id)&&!p.shouldHidePaymentMethod(e.gateway_id)},enumerable:!0,configurable:!0}),t.prototype.renderLicensePlanSection=function(){var e=this.props.subStatus;if(!e||!e.subState||!e.subState.plan)return r.createElement("noscript",null);var t=s._("Dropbox %(plus)s").format({plus:e.subState.plan.displayName()}),n=r.createElement("noscript",null);if(this.props.hasUnusedLicenseKey){var a=s._("Your Dropbox %(plus)s plan was activated with a license key.         Your next license key will be activated on %(date)s.").format({plus:N.TRADEMARK_PLUS,date:e.formattedNextBillingDate});this.props.isLoggedInAsTransactionOwner||(a=s._("This Dropbox %(plus)s plan was activated with a license key.           The next license key will be activated on %(date)s.").format({plus:N.TRADEMARK_PLUS,date:e.formattedNextBillingDate}));var i=r.createElement("noscript",null);if(this.hasSelfServablePaymentAfterLicensekey)i=r.createElement("div",null,s._("No charge made to your payment method on file.")),this.props.isLoggedInAsTransactionOwner||(i=r.createElement("div",null,s._("No charge made to the payment method on file.")));else{var l=s._("You can add your payment information now to have            your subscription automatically renew when your keys expire.");this.props.isLoggedInAsTransactionOwner||(l=s._("The account owner can add payment information now to have               this subscription automatically renew when the keys expire.")),i=r.createElement("div",null,l,r.createElement("br",null),r.createElement("a",{href:"#",onClick:this.addPaymentClick},s._("Add payment method.")))}n=r.createElement("div",null,a,r.createElement("br",null),i)}else if(this.hasSelfServablePaymentAfterLicensekey){var o=e.scheduledSubState.billingSchedule.scheduleDescriptionNoun,c=s._("Your Dropbox %(plus)s plan was activated with a               license key. The plan will renew on %(date)s.").format({plus:N.TRADEMARK_PLUS,date:e.formattedNextBillingDate}),u=s._("%(new_total)s per %(new_period)s will be charged to your payment method on file.").format({new_total:g.Cash.formatWithTaxLabels(e.nextBillingSummary.total,e.nextBillingSummary),new_period:o});this.props.isLoggedInAsTransactionOwner||(c=s._("This Dropbox %(plus)s plan was activated with a             license key. The plan will renew on %(date)s.").format({plus:N.TRADEMARK_PLUS,date:e.formattedNextBillingDate}),u=s._("%(new_total)s per %(new_period)s will be charged to the payment method on file.").format({new_total:g.Cash.formatWithTaxLabels(e.nextBillingSummary.total,e.nextBillingSummary),new_period:o})),n=r.createElement("div",null,c,r.createElement("br",null),u,r.createElement("br",null),this.renderBillingPeriod())}else{var c=s._("Your Dropbox %(plus)s plan was activated with a license key.                 The plan is active until %(date)s.").format({plus:N.TRADEMARK_PLUS,date:e.formattedNextBillingDate}),d=s._("You can add your payment information now to have               your subscription automatically renew when it expires.");this.props.isLoggedInAsTransactionOwner||(c=s._("This account’s Dropbox %(plus)s plan was activated with a license key.               The plan is active until %(date)s.").format({plus:N.TRADEMARK_PLUS,date:e.formattedNextBillingDate}),d=s._("The account owner can add payment information now to have               this subscription automatically renew when it expires.")),n=r.createElement("div",null,c,r.createElement("br",null),d,r.createElement("br",null),r.createElement("a",{href:"#",onClick:this.addPaymentClick},s._("Add payment method.")))}return r.createElement("div",{className:"plan-status-section"},this.renderDropboxLogo(),r.createElement("div",{className:"plan-status-section__description"},r.createElement("h1",{className:"plan-status-section__title"},t),r.createElement("p",{className:"plan-status-section__title_description"},n)),this.renderContactSupportLink())},t.prototype.render1TBChangeablePlan=function(){var e=this.props,t=e.subStatus,n=e.paymentInfo,a=e.scheduledForDowngrade;if(!t||!t.subState||!t.subState.plan)return r.createElement("noscript",null);var i=t.subState.plan.displayName(!0),l="";t.subState.billingSchedule&&t.subState.billingSchedule.scheduleDescriptionNoun&&t.currentBillingSummary&&t.currentBillingSummary.total&&(l=s._("%(total)s per %(period)s.").format({total:g.Cash.formatWithTaxLabels(t.currentBillingSummary.total,t.currentBillingSummary),period:t.subState.billingSchedule.scheduleDescriptionNoun}));var o=r.createElement("noscript",null);if(n&&!p.shouldHideBillingChange(n.gateway_id,n.is_external_billing)){var c=s._("Your %(plan)s plan will renew on %(date)s. %(billing_summary)s").format({plan:i,date:t.formattedNextBillingDate,billing_summary:l});this.props.isLoggedInAsTransactionOwner||(c=s._("This account’s %(plan)s plan will renew on %(date)s.             %(billing_summary)s").format({plan:i,date:t.formattedNextBillingDate,billing_summary:l})),o=r.createElement("span",null,c)}if(a){var u=s._("Your %(plan)s will downgrade to Dropbox Basic on %(date)s. %(billing_summary)s").format({plan:i,date:t.formattedNextBillingDate,billing_summary:l});this.props.isLoggedInAsTransactionOwner||(u=s._("This account’s %(plan)s will downgrade to Dropbox Basic on %(date)s.           %(billing_summary)s").format({plan:i,date:t.formattedNextBillingDate,billing_summary:l})),o=r.createElement("span",null,u)}var d=this.renderContactSupportLink();return r.createElement("div",{className:"plan-status-section"},this.renderDropboxLogo(),r.createElement("div",{className:"plan-status-section__description"},r.createElement("h1",{className:"plan-status-section__title"},i),r.createElement("p",{className:"plan-status-section__title_description"},o,r.createElement("br",null),this.renderBillingPeriod())),d)},t.prototype.renderPlanSection=function(){var e=this.props,t=e.subStatus,n=e.isExternallyBilled,a=e.paymentInfo,i=e.isLimitedTeam;return e.eligibleFor1tb?this.render1TBChangeablePlan():n&&void 0!==a&&null!==a.reseller_name?this.renderResellerPlan():n&&i&&void 0!==a&&a.gateway_id===m.NOT_APPLICABLE?void 0:t&&t.subState.plan&&t.subState.plan.productFamily===P.ProductFamily.PRO?this.isTrialPlan()?this.renderTrialSection():this.isLicensePlan()?this.renderLicensePlanSection():this.renderPaidPlanSection():this.renderBasicPlanSection()},t.prototype.render=function(){var e=this.props,t=e.isPersonalUser,n=e.isLimitedTeam,a=t||n?this.renderPlanSection():this.renderBusinessPlanSection(),i=null;return"ON"===this.props.planSpectrumVariant&&(i=r.createElement("div",{className:"plan-status__header"},s._("Your plan"))),r.createElement("div",{className:"plan-status"},i,a)},t})(r.Component);t.PlanStatus=I}),define("modules/clean/account_page/widgets/plan/views/pro_upsell_modal_content",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/react/css","modules/clean/static_urls","modules/constants/trademark","modules/clean/react/image"],function(e,t,n,a,i,r,l,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){switch(this.props.variant){case"V1":return this.renderV1();case"V2":return this.renderV2();case"V3":return this.renderV3();default:return null}},t.prototype.renderV1=function(){var e=this.props,t=e.price,n=e.unit,r=t?t.toString():"-",l=t?n:"";return a.createElement("section",null,a.createElement("div",{className:"pro-upsell"},a.createElement("h1",{className:"pro-upsell__headline"},i._("Do more with Dropbox %(trademark_pro)s").format({trademark_pro:o.TRADEMARK_PROFESSIONAL})),a.createElement("div",null,a.createElement("div",{className:"pro-upsell__price"},r),a.createElement("div",{className:"pro-upsell__price-schedule"},l))),a.createElement("ul",{role:"list",className:"reasons-list"},a.createElement("li",{className:"reasons-list__item reasons-list__item--professional"},i._("Everything in %(trademark_plus)s").format({trademark_plus:o.TRADEMARK_PLUS})),a.createElement("li",{className:"reasons-list__item"},i._("Showcase, Smart Sync, shared link controls, and more."))))},t.prototype.renderV2=function(){var e=this.props,t=e.price,n=e.unit,r=t?t.toString():"-",l=t?n:"";return a.createElement("section",null,a.createElement("div",{className:"pro-upsell"},a.createElement("h1",{className:"pro-upsell__headline"},i._("Do more with Dropbox %(trademark_pro)s").format({trademark_pro:o.TRADEMARK_PROFESSIONAL})),a.createElement("div",null,a.createElement("div",{className:"pro-upsell__price"},r),a.createElement("div",{className:"pro-upsell__price-schedule"},l))),a.createElement("div",{className:"grid__container"},a.createElement("ul",{role:"list",className:"reasons-list reasons-list--margin-right"},a.createElement("li",{className:"reasons-list__item reasons-list__item--professional"},i._("Everything in %(trademark_plus)s").format({trademark_plus:o.TRADEMARK_PLUS})),a.createElement("li",{className:"reasons-list__item"},i._("Showcase")),a.createElement("li",{className:"reasons-list__item"},i._("Smart Sync"))),a.createElement("ul",{className:"reasons-list"},a.createElement("li",{className:"reasons-list__item"},i._("Advanced sharing controls")),a.createElement("li",{className:"reasons-list__item"},i._("Priority chat support")),a.createElement("li",{className:"reasons-list__item"},i._("Full text search")))))},t.prototype.renderV3=function(){var e=this.props,t=e.price,n=e.unit,r=t?t.toString():"-",c=t?n:"";return a.createElement("section",null,a.createElement("div",{className:"pro-upsell__image-wrapper"},a.createElement(s.Image,{className:"pro-upsell__image",alt:"",src:l.static_url("/static/images/growth/sell-more-faster-illo@2x-vflHz-UKV.png"),srcHiRes:l.static_url("/static/images/growth/sell-more-faster-illo@2x-vflHz-UKV.png")})),a.createElement("div",{className:"pro-upsell"},a.createElement("h1",{className:"pro-upsell__headline"},i._("What’s included in Dropbox %(trademark_pro)s?").format({trademark_pro:o.TRADEMARK_PROFESSIONAL})),a.createElement("div",null,a.createElement("div",{className:"pro-upsell__price"},r),a.createElement("div",{className:"pro-upsell__price-schedule"},c))),a.createElement("div",{className:"grid__container"},a.createElement("ul",{role:"list",className:"reasons-list reasons-list--margin-right"},a.createElement("li",{className:"reasons-list__item reasons-list__item--professional"},i._("Everything in %(trademark_plus)s").format({trademark_plus:o.TRADEMARK_PLUS})),a.createElement("li",{className:"reasons-list__item"},i._("Showcase"))),a.createElement("ul",{className:"reasons-list"},a.createElement("li",{className:"reasons-list__item"},i._("Advanced sharing controls")),a.createElement("li",{className:"reasons-list__item"},i._("Smart Sync")))))},t})(a.Component);t.ProUpsellModalContent=r(c,["/static/css/teams/admin/widgets/change_plan_modal/pro_upsell_modal_content-vflI1lTsK.css"])}),define("modules/clean/account_page/widgets/plan/views/quota_usage",["require","exports","tslib","external/react","external/classnames","modules/core/browser","modules/clean/react/css","modules/clean/viewer","modules/core/i18n","modules/clean/display_format","modules/clean/react_format","modules/constants/trademark","modules/clean/payments/skus/sku_content"],function(e,t,n,a,i,r,l,o,s,c,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.formatBytes=function(e){return c.format_bytes(e,2,!0,!0,!1)},t.onClickAdvancedUpgrade=function(e){e.preventDefault(),r.redirect("/team/admin/billing/manage")},t}return n.__extends(t,e),Object.defineProperty(t.prototype,"teamName",{get:function(){return o.Viewer.get_viewer().team_name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"freeSpace",{get:function(){var e=this.props.usageBreakdown;return e.quota-e.usage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sharedFiles",{get:function(){return this.props.usageBreakdown.shared_usage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"regularFiles",{get:function(){return this.props.usageBreakdown.unshared_usage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usage",{get:function(){return this.props.usageBreakdown.usage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quota",{get:function(){return this.props.usageBreakdown.quota||.01},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOverQuota",{get:function(){return this.usage>this.quota},enumerable:!0,configurable:!0}),t.prototype.getQuotaUpsell=function(){var e=this.props,t=e.subStatus,n=e.isPersonalUser,i=e.isLimitedTeam,r=e.isMSLTeamMember,l=e.isTeamAdmin,o=e.plusSkuContent;if(t){var c=p.SkuContentClient.deserialize(o),m=null,h=t.subState.plan,_=a.createElement("span",null,s._("When your team runs out of space, accounts will stop syncing         and you won’t be able to add any new files.")," ");return n||i?!h&&this.isOverQuota&&c.spaceLongFormRounded()&&(m=a.createElement("div",{className:"quota-upsell"},s._("With %(plan)s, get %(plus_space_long_form_rounded)s for all your photos, videos, docs and other files.               Keep everything stored safely and at your fingertips.").format({plan:d.TRADEMARK_PLUS,plus_space_long_form_rounded:c.spaceLongFormRounded()})," ",a.createElement("a",{href:"/upgrade?oqa=acc_plan_upgrade_overquota_link"},s._("Upgrade now")))):r?this.isOverQuota&&(m=a.createElement("div",{className:"quota-upsell"},s._("Your Dropbox account is full. To continue, remove files or ask your admin for\n                more space. "),a.createElement("a",{href:"/help/business/space-limit-full"},s._("Learn more about Dropbox space")))):m=h&&h.isAdvancePlan?a.createElement("div",{className:"quota-upsell"},_,l?u.reactFormat(s._("To add more space, <a>contact support</a>."),{a:a.createElement("a",{href:"/support",target:"_blank",rel:"noopener noreferrer"})}):s._("Contact your admin to add more space.")):a.createElement("div",{className:"quota-upsell"},_,l?u.reactFormat(s._("<a>Upgrade to an Advanced plan</a> to get more space."),{a:a.createElement("a",{href:"",onClick:this.onClickAdvancedUpgrade})}):u.reactFormat(s._("Contact your admin to upgrade to an <a>Advanced plan</a> and get more space."),{a:a.createElement("a",{href:"/business/plans-comparison",target:"_blank",rel:"noopener noreferrer"})})),m}},t.prototype.render=function(){var e=this.props,t=e.isPersonalUser,n=e.isLimitedTeam,r=e.isMSLTeamMember,l="",o=u.reactFormat(s._("Using <strong>%(usage)s</strong> of %(quota)s").format({usage:this.formatBytes(this.usage),quota:this.formatBytes(this.quota)}),{strong:a.createElement("strong",{key:"quota-strong"})});l=t||n?this.isOverQuota?s._("Your Personal Dropbox account is full"):s._("Personal Dropbox space"):r?this.isOverQuota?s._("Your Dropbox account space is full"):s._("Your Dropbox account space"):this.isOverQuota?s._("Your %(team_name)s account is full").format({team_name:this.teamName}):s._("%(team_name)s — space").format({team_name:this.teamName});var c=100*this.regularFiles/this.quota,d=c>100?"100":c.toFixed(20),p=d+"%",m=100*this.sharedFiles/this.quota,h=m>100?"100":m.toFixed(20),_=h+"%",g={width:p},f={width:_},b=i({"account-plan-tab-quota-usage":!0,"is-within-quota":!this.isOverQuota,"is-over-quota":this.isOverQuota}),y=i({"bar-graph-part":!0,"bar-graph-normal":!0,"normal-color":!0,"is-zero":0===this.usage}),S=i({"bar-graph-part":!0,"bar-graph-shared":!0,"bar-shared-color":!0,"is-zero":0===this.sharedFiles}),v=i({"bar-graph-legend":!0,"bar-graph-normal":!0,"normal-color":!0}),E=i({"bar-graph-legend":!0,"bar-graph-shared":!0,"shared-color":!0}),P=this.getQuotaUpsell(),C=this.isOverQuota?void 0:a.createElement("div",{className:"bar-graph-legend-group"},a.createElement("div",{className:"bar-graph-legend bar-graph-free"}),a.createElement("span",{className:"bar-graph-key-text"},s._("Unused space")," (",this.formatBytes(this.freeSpace),")"));return a.createElement("div",{className:b},a.createElement("div",{className:"quota-header"},a.createElement("span",{className:"quota-header quota-header__plan"},l),a.createElement("span",{className:"quota-header quota-header__usage"},o)),a.createElement("div",{className:"quota-space-bar"},a.createElement("div",{className:"bar-graph"},a.createElement("div",{className:y,style:g}),a.createElement("div",{className:S,style:f}))),a.createElement("div",{className:"quota-space-legend"},a.createElement("div",{className:"bar-graph-key"},a.createElement("div",{className:"space-key"},a.createElement("div",{className:"bar-graph-legend-group"},a.createElement("div",{className:v}),a.createElement("span",{className:"bar-graph-key-text"},s._("Regular files")," (",this.formatBytes(this.regularFiles),")")),a.createElement("div",{className:"bar-graph-legend-group"},a.createElement("div",{className:E}),a.createElement("span",{className:"bar-graph-key-text"},s._("Shared files")," (",this.formatBytes(this.sharedFiles),")")),C))),P)},t})(a.Component);t.QuotaUsageView=m,t.QuotaUsage=l(m,["/static/css/account/pagelet/quota_usage-vflqT1pDK.css"])}),define("modules/clean/account_page/widgets/plan/views/referral_space",["require","exports","tslib","modules/core/browser","external/react","modules/clean/react/css","modules/core/i18n","modules/clean/account_page/util","modules/clean/account_page/widgets/plan/referral_history/api","modules/clean/static_urls","modules/clean/account_page/components/account_table","modules/clean/account_page/components/button_block","modules/clean/analytics"],function(e,t,n,a,i,r,l,o,s,c,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(t){var a=e.call(this,t)||this;return a.buildReferralHistoryIfNecessary=function(){var e=a.state.history;if(null!==e&&null!==e.rows&&0!==e.rows.length)return i.createElement("div",{className:"referral-table-container"},i.createElement(u.Table,{className:"referral-table"},i.createElement(u.TableHead,null,i.createElement(u.HeaderRow,{className:"referral-header-row"},i.createElement(u.HeaderCell,{className:"referral-bonus-type-header"},l._("Bonus type")),i.createElement(u.HeaderCell,{className:"referral-description-header"}),i.createElement(u.HeaderCell,{className:"referral-updated-header"},l._("Updated")),i.createElement(u.HeaderCell,{className:"referral-earned-header"},l._("Space earned")))),i.createElement(u.TableFooter,{className:"referral-footer"},a.buildReferralFooter()),i.createElement(u.TableBody,null,e.rows.map(function(e,t){if(a.state.showMore||!(t>2))return a.buildReferralRow(e)}))))},a.loadMoreReferralHistory=function(e){return n.__awaiter(a,void 0,void 0,function(){var t;return n.__generator(this,function(n){switch(n.label){case 0:return this.setState({isLoading:!0}),p.ProEventsLogger.log("de_earn_space_view_more_click"),e.preventDefault(),this.state.showMore?[4,s.getReferralHistory(o.getCurrentUser().id,this.state.currentPage+1)]:(this.setState({showMore:!0,isLoading:!1}),[2,!1]);case 1:return t=n.sent(),t.rows=this.state.history.rows.concat(t.rows),this.setState({currentPage:this.state.currentPage+1,history:t,isLoading:!1}),[2,!1]}})})},a.buildReferralFooter=function(){var e=a.state.history;if(a.state.isLoading)return i.createElement("tr",{className:"referral-footer-row"
},i.createElement("td",{colSpan:4},i.createElement("img",{src:c.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:l._("Loading")})));if(!(!a.state.showMore&&e.rows.length<3||a.state.showMore&&!e.has_more))return i.createElement("tr",{className:"referral-footer-row"},i.createElement("td",{colSpan:4},i.createElement("a",{onClick:a.loadMoreReferralHistory,href:"#",rel:"noopener noreferrer"},l._("View more earned space"))))},a.buildReferralRow=function(e){var t=null,n=null;return t=e.type.url?i.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:e.type.url},e.type.str):i.createElement("span",null,e.type.str),n=e.earned.completed?i.createElement("div",null,i.createElement("span",{className:"earned-space"},e.earned.str),i.createElement("img",{src:c.static_url("/static/images/icon_checkmark-vflExOh3Y.png"),alt:""})):e.earned.url?i.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:e.earned.url},e.earned.str):i.createElement("span",null,e.earned.str),i.createElement(u.BodyRow,{className:"referral-body-row",key:e.details+e.updated},i.createElement(u.BodyCell,{className:"referral-bonus-type"},t),i.createElement(u.BodyCell,{className:"referral-description"},e.details),i.createElement(u.BodyCell,{className:"referral-updated"},e.updated),i.createElement(u.BodyCell,{className:"referral-earned"},n))},a.state={history:a.props.referralHistory,showMore:!1,isLoading:!1,currentPage:0},a}return n.__extends(t,e),t.prototype.buildInvitePhrase=function(e){return l._("You can earn more space by referring your friend to Dropbox! You’ll       get a %(referral_amount)s bonus when they install Dropbox on their computer.").format({referral_amount:e})},t.prototype.isLoading=function(){return"ready"!==this.props.referralLoadingState},t.prototype.inviteFriendClick=function(){p.ProEventsLogger.log("de_earn_space_invite_click"),a.redirect("/referrals")},t.prototype.render=function(){if(this.isLoading())return i.createElement("div",{className:"loading-indicator"},i.createElement("img",{src:c.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:l._("Loading")}));var e=this.props.referralInfo;return i.createElement("div",{className:"referral-space"},i.createElement(d.ButtonBlock,{label:l._("Earn more space (%(current_space)s earned)").format({current_space:e.currentSpace}),subtext:this.buildInvitePhrase(e.referralAmount),buttonText:l._("Invite a friend"),kind:"secondary",buttonAction:{kind:"function",handler:this.inviteFriendClick}}),this.buildReferralHistoryIfNecessary())},t})(i.Component);t.ReferralSpace=r(m,["/static/css/account/pagelet/referral_space-vflqD-0ia.css"])}),define("modules/clean/account_page/widgets/plan/views/upsell_module",["require","exports","tslib","external/react","spectrum/button","modules/clean/react/css"],function(e,t,n,a,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.headline,n=e.text,r=e.cta;return a.createElement("section",{className:"upsell-module"},a.createElement("div",{className:"upsell-module__content-container"},a.createElement("div",{className:"upsell-module__text-wrapper"},a.createElement("h2",{className:"upsell-module__headline"},t),a.createElement("p",{className:"upsell-module__body"},n)),a.createElement(i.Button,{className:"upsell-module__button",href:r.link},r.text)))},t})(a.Component);t.UpsellModule=r(l,["/static/css/account/pagelet/upsell_module-vflirlkVO.css"])}),define("modules/clean/deprecated/dbmodal_loading",["require","exports","tslib","modules/clean/dbmodal","modules/clean/deprecated/uirequest"],function(e,t,n,a,i){"use strict";var r=(function(e){function t(t){return e.call(this,t)||this}return n.__extends(t,e),t.initClass=function(){this.prototype.on_confirm_button_click=null,this.prototype.on_cancel_button_click=null},t.prototype.on_show=function(){return this.fetch()},t.prototype.fetch=function(){var e=this;return new i(this.$modal_window,this.options.endpoint_url,{data:this.options.parameters||{},subject_user:this.options.subject_user,html_in_error_msg:this.options.html_in_error_msg,error:function(t,n,a){return e.hide()}})},t})(a.DBModal);return r.initClass(),r}),define("modules/clean/growth/gating",["require","exports","tslib","modules/clean/ajax"],function(e,t,n,a){"use strict";function i(e,t,i){return void 0===i&&(i={}),n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(r){return[2,a.SilentBackgroundRequest(n.__assign({url:"/growth/gating_check",subject_user:e.id,data:{experiment:t}},i)).then(function(e){return JSON.parse(e)})]})})}function r(e,a,r){return void 0===r&&(r={}),n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){return"personal"!==e.role||e.paid?[2,Promise.resolve(t.inactiveGatingStatus)]:[2,i(e,a,r)]})})}Object.defineProperty(t,"__esModule",{value:!0}),t.inactiveGatingStatus={is_active:!1,variant:"OFF"},t.growthCheckGating=i,t.growthCheckBasicUserGating=r}),define("modules/clean/growth/user_action/tracker",["require","exports","tslib","external/lodash","modules/clean/ajax"],function(e,t,n,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t){this.userId=e,this.timers={},t&&t.project&&(this.project=t.project)}return e.prototype.startTimer=function(e){this.timers[e]={start:Date.now(),end:0}},e.prototype.stopTimer=function(e){this.timers[e]&&!this.timers[e].end&&(this.timers[e].end=Date.now())},e.prototype.clearTimer=function(e){delete this.timers[e]},e.prototype.getDuration=function(e){return this.timers[e]?this.timers[e].end?this.timers[e].end-this.timers[e].start:Date.now()-this.timers[e].start:0},e.prototype.track=function(e,t,r){return void 0===t&&(t={}),void 0===r&&(r={}),i.SilentBackgroundRequest(n.__assign({url:"/growth/user_action/track",subject_user:this.userId,data:n.__assign({project:this.project,action:e,duration:this.getDuration(e)},a.pick(t,"endpoint"),{extra:JSON.stringify(t.extra||{})})},r))},e})();t.GrowthUserActionTracker=r}),define("modules/clean/payments/billing_info_base",["require","exports","jquery","modules/clean/payments/cash","modules/clean/payments/payment_form_events","modules/clean/payments/pro_util","modules/core/controller_helpers"],function(e,t,n,a,i,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(){function e(e,t,n,a){this.listen_tax=this.listen_tax.bind(this),this._getCurrency=this._getCurrency.bind(this),this.getCurrentTransitionViewModel=this.getCurrentTransitionViewModel.bind(this),this.updateForm=this.updateForm.bind(this),this._display_tax=this._display_tax.bind(this),this._recompute_costs=this._recompute_costs.bind(this),this._recompute_costs_from_tvm=this._recompute_costs_from_tvm.bind(this),this.$container=e,this.country_to_currency_map=t,this.transition_view_models=n,this.countryToTaxNameMap=a,this.transition_info_fetcher=new r.TransitionInfoFetcher(this.transition_view_models),this.payment_form=l.get_controller(this.$container.find(".payment-form-component")),this.hasTax=null!=this.countryToTaxNameMap,this.transition_view_models&&(this.transition_view_model=this.transition_view_models[0]),this.listen_tax()}return e.prototype.listen_tax=function(){var e=this;if(this.hasTax)return this.$container.on(i.LOCATION_CHANGE_EVENT,function(t,n){if(t.stopPropagation(),r.TaxHelper.require_recompute(e.get_country_code(),e.get_zip_code()))return e.updateForm()})},e.prototype.get_zip_code=function(){return this.$container.find('input:visible[name="zip"]').val()},e.prototype.get_country_code=function(){return this.$container.find('[name="country_code"]').val()},e.prototype._getCountryTaxName=function(e){return this.countryToTaxNameMap[e]||this.countryToTaxNameMap.Other},e.prototype._getCurrency=function(){var e=this.payment_form.get_country_code();return null!=this.country_to_currency_map?this.country_to_currency_map[e]:void 0},e.prototype.getCurrentTransitionViewModel=function(){return this.transition_view_model},e.prototype.updateForm=function(){return this._recompute_costs()},e.prototype._display_tax=function(){return r.TaxHelper.display_tax(this.get_country_code())?(n(".tax-row").removeClass("hidden_elem"),n(".tax-name-wrapper").text(this._getCountryTaxName(this.get_country_code())),!0):(n(".tax-row").addClass("hidden_elem"),!1)},e.prototype._recompute_costs=function(){var e={zip:this.get_zip_code(),country_code:this.get_country_code()};return this.transition_info_fetcher.get(this._recompute_costs_from_tvm,e,!0)},e.prototype._recompute_costs_from_tvm=function(e){var t;if(e){this.transition_view_model=e;var i=this._getCurrency();this.$container.find(".currency-wrapper").text(i);var l=Array.from(r.TaxHelper.compute_tax(e.read_only_invoice,i)),o=l[0],s=l[1],c=l[2],u=a.CashUtil.formatCurrency(o.amount,o.currency);if(this.$container.find(".price-amount-wrapper").text(u),e.rebill){t=a.Cash.fromObject(e.rebill.total);var d=a.CashUtil.formatCurrency(t.amount,t.currency);this.$container.find(".rebill-amount-wrapper").text(d)}if(e.state.total_recurring_price){var p=a.Cash.fromObject(e.state.total_recurring_price),m=a.CashUtil.formatCurrency(p.amount,p.currency);this.$container.find(".rebill-price-wrapper").text(m)}var h=this._getTotalAmount(e),_=a.CashUtil.formatCurrency(h.amount,h.currency);this.$container.find(".total-amount-wrapper").text(_),n(".tax-row").toggleClass("hidden_elem",this._display_tax());var g=a.CashUtil.formatCurrency(c.amount,c.currency);return n(".tax-amount-wrapper").text(g),[o,s,c,t,i]}},e})();t.BillingInfoModalBase=o}),define("modules/clean/payments/billing_info_modal",["require","exports","tslib","jquery","modules/clean/analytics","modules/clean/dbmodal_stack","modules/clean/deprecated/uirequest","modules/clean/payments/billing_info_base","modules/clean/payments/cash","modules/clean/payments/payment_form_events","modules/core/cookies","modules/core/uri","modules/clean/payments/pro_util"],function(e,t,n,a,i,r,l,o,s,c,u,d){"use strict";var p=(function(e){function t(n,o,s,u,p){var m=e.call(this,n,u,s,p)||this;return m.payment_link_map=o,m._postRequest=m._postRequest.bind(m),m._update_disclaimer=m._update_disclaimer.bind(m),m.$container.on("click",".cancel-button",function(){return i.TeamsWebActionsLogger.log("update_billing_open_cancel"),r.DBModalStack.pop()}),m.$container.on("click",".confirm-button",function(){if(i.TeamsWebActionsLogger.log("update_billing_open_save_changes_click"),m.payment_form.validate())return m.$container.find(".confirm-button").prop("disabled",!0),m.payment_form.get_form_inputs(function(e){m.$container.find(".confirm-button").prop("disabled",!1);var n=["resubscribe"];m.$container.find("input, select").each(function(t,i){var r=a(i),l=r.attr("name");if(Array.from(n).includes(l))return e[l]=r.val()});var o=m.payment_form.get_selected_payment_method_id(),s=m.payment_link_map[o];if("extra_params"in s){var c=s.extra_params;a.extend(e,c)}return s.use_form_post?m._postRequest(new d.URI({path:s.endpoint}),e):new l(m.$container,s.endpoint,{data:e,success:function(e){if(e.data&&e.data.success)return i.TeamsWebActionsLogger.log("update_billing_open_save_changes_success"),r.DBModalStack.trigger(t.BILLING_INFO_UPDATED),r.DBModalStack.pop()}})})}),m.payment_form.$container.on(c.PAYMENT_METHOD_TYPE_CHANGE_EVENT,m._update_disclaimer),null!=m.transition_view_models&&m.updateForm(),m}return n.__extends(t,e),t.initClass=function(){this.BILLING_INFO_UPDATED="billing_info_modal:updated"},t.prototype._postRequest=function(e,t){t.t=u.Cookies.read("__Host-js_csrf");var n=document.createElement("form");n.action=e,n.method="POST",document.body.appendChild(n);for(var a=0,i=Object.keys(t||{});a<i.length;a++){var r=i[a],l=document.createElement("input");l.type="hidden",l.name=r,l.value=t[r],n.appendChild(l)}return n.submit()},t.prototype._update_disclaimer=function(e,t){return t=parseInt(t,10),this.$container.find(".payment-method-disclaimer").each(function(e,n){var i=a(n).data("payment-method-id");return a(n).toggleClass("hidden",i!==t)})},t.prototype._getTotalAmount=function(e){return s.Cash.fromObject(e.read_only_invoice.total)},t})(o.BillingInfoModalBase);return p.initClass(),p}),define("modules/clean/payments/payment_form_events",["require","exports"],function(e,t){"use strict";var n=(function(){function e(){}return e.initClass=function(){this.LOCATION_CHANGE_EVENT="db:paymentform:countrycodechanged",this.ZIP_CHANGE_EVENT="db:paymentform:zipchanged",this.PAYMENT_METHOD_TYPE_CHANGE_EVENT="db:paymentform:paymentmethodtypechanged",this.VAT_CHANGE_EVENT="db:paymentform:vatchanged",this.CPF_CHANGE_EVENT="db:paymentform:cpfchanged",this.UNVALIDATED="db:paymentform:unvalidated",this.VALIDATE_ERROR="db:paymentform:validateerror",this.VALIDATE_SUCCESS="db:paymentform:validatesuccess",this.LOADED_EVENT="db:paymentform:loaded",this.IFRAME_LOADED_EVENT="db:paymentform:iframeloaded",this.IFRAME_FIELDS_STATUS_EVENT="db:paymentform:iframefieldsstatusevent",this.EDIT_SIMPLE_COUNTRY_CLICK_EVENT="db:paymentform:editsimplecountry"},e})();return n.initClass(),n}),define("modules/clean/payments/pro_util",["require","exports","external/lodash","modules/clean/ajax","modules/clean/payments/cash","modules/clean/payments/validation","modules/core/exception"],function(e,t,n,a,i){"use strict";function r(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0});var l=(function(){function e(){}return e.compute_tax=function(e,t){for(var n=null,a=null,r=new i.Cash(0,t),l=0,o=Array.from(e.line_items);l<o.length;l++){var s=o[l];1===s.line_item_type?n=s:2===s.line_item_type&&(a=s),s.country_tax_amount&&(r=r.add(i.Cash.fromObject(s.country_tax_amount))),s.state_tax_amount&&(r=r.add(i.Cash.fromObject(s.state_tax_amount)))}return[null!=n?i.Cash.fromObject(n.line_item_price):new i.Cash(0,t),null!=a?i.Cash.fromObject(a.line_item_price):new i.Cash(0,t),r]},e.require_recompute=function(e,t){return"US"===e&&/(^\d{5}$)|(^\d{5}-\d{4}$)/.test(t)},e.display_tax=function(e){return"US"===e},e})();t.TaxHelper=l;var o=(function(){function e(e){if(this._cache_key_from_transition=this._cache_key_from_transition.bind(this),this._get_state_json=this._get_state_json.bind(this),this.get=this.get.bind(this),this._has_inflight_request=this._has_inflight_request.bind(this),this._add_to_cache=this._add_to_cache.bind(this),this._get_transition_info_for=this._get_transition_info_for.bind(this),this.default_transition_view_models=e,this._requests={},this.transition_info_cache={},this.default_transition_view_models)for(var t=0,n=Array.from(this.default_transition_view_models);t<n.length;t++){var a=n[t];this._add_to_cache(a)}}return e.prototype._cache_key=function(e){return n.values(e).join(":")},e.prototype._cache_key_from_transition=function(e){var t={country_code:null!=e.read_only_invoice?e.read_only_invoice.tax_country_code:void 0,zip_code:null!=e.read_only_invoice?e.read_only_invoice.tax_zip_code:void 0};return this._cache_key(t)},e.prototype._get_state_json=function(){var e=r(null!=this.default_transition_view_models?this.default_transition_view_models[0]:void 0,function(e){return e.state});return JSON.stringify(e)},e.prototype.get=function(e,t,i){var r=this,l=this._cache_key(t),o=this._get_transition_info_for(l);if(o)return void e(o);if(!this._requests[l]){if(this._has_inflight_request()&&i)for(var s in this._requests)delete this._requests[s];else if(this._has_inflight_request())return;return this._requests[l]=!0,a.SilentBackgroundRequest({url:"/pro/ajax_transition_view_model",dataType:"json",data:n.assignIn({json_state:this._get_state_json()},t),success:function(t){if(r._add_to_cache(t),null!=r._requests[l])return delete r._requests[l],e(t)},error:function(e){if(null!=r._requests[l])return delete r._requests[l]}})}},e.prototype._has_inflight_request=function(){return Object.keys(this._requests).length},e.prototype._add_to_cache=function(e){var t=this._cache_key_from_transition(e);return this.transition_info_cache[t]=e},e.prototype._get_transition_info_for=function(e){return null!=this.transition_info_cache[e]},e})();t.TransitionInfoFetcher=o}),define("modules/clean/react/payments/edit_invoice_address_modal/edit_invoice_address_modal_loader",["require","exports","tslib","modules/core/notify","external/react","modules/clean/react/css","modules/clean/react/sprite","modules/core/uri","modules/core/i18n","modules/clean/react/arbor/aspen/elements/arbor_inputs","modules/clean/payments/validation","modules/clean/react/modal","modules/clean/static_urls","modules/clean/react/tooltip","modules/clean/analytics","modules/clean/ajax_as_promised"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m,h,_){"use strict";function g(e){return function(t){return null==t||t.length<=e}}function f(e,t){return i.createElement(m.Tooltip,{position:m.TooltipPosition.RIGHT,tooltip_contents:t},e,i.createElement(l.Sprite,{group:"web",name:"info",className:"info-sprite",alt:""}))}Object.defineProperty(t,"__esModule",{value:!0});var b=s._("Country and postal code must match your account’s payment information."),y=s._("Your tax rate on this invoice cannot be updated."),S={addressName:s._("Billing name"),address:s._("Billing address"),city:s._("City"),state:s._("State"),zip:f(s._("Postal code"),b),country:f(s._("Country"),b),exclusionId:s._("VAT number (optional)"),exclusionIdWithTooltip:f(s._("VAT number (optional)"),y)},v=(function(e){function r(t){var n=e.call(this,t)||this;return n.disableds={addressName:!1,address:!1,city:!1,state:!1,zip:!0,country:!0,exclusionId:!1,exclusionIdWithTooltip:!1},n.addressNameLength=100,n.addressLength=250,n.cityLength=50,n.stateLength=50,n.vatLength=25,n.undefinedLength=void 0,n.validateHandlers={addressName:g(n.addressNameLength),address:g(n.addressLength),city:g(n.cityLength),state:g(n.stateLength),zip:function(){return!0},country:function(){return!0},exclusionId:function(){return!0},exclusionIdWithTooltip:function(){return!0}},n.maxLengths={addressName:n.addressNameLength,address:n.addressLength,city:n.cityLength,state:n.stateLength,zip:n.undefinedLength,country:n.undefinedLength,exclusionId:n.vatLength,exclusionIdWithTooltip:n.vatLength},n.errorTexts={addressName:s._("Too long"),address:s._("Too long"),city:s._("Too long"),state:s._("Too long"),zip:"",country:"",exclusionId:"",exclusionIdWithTooltip:""},n.onSave=function(){var e=n.state.formState,t=n.props.invoice;if(e)if(n.logActions("edit_billing_address_started"),n.setState({submitting:!0}),n.isInputValid()){var a={address_name:e.addressName,address:e.address,city:e.city,state:e.state,exclusion_id:e.exclusionId};t&&(a.invoice_id=o.URI.parse(t.link).getQuery().id.toString()),n.makeEditBillingAddressRequest(a)}else n.setState({submitting:!1,showErrors:!0})},n.onCancel=function(){n.logActions("edit_billing_address_cancelled"),d.Modal.close()},n.state={submitting:!1,showErrors:!1},t.isTeam?(n.editUrl="/edit_billing_address",n.viewModelUrl="/edit_billing_address_view_model",n.vatClass="grid__item--1-1",n.modalClass="edit-invoice-modal"):(n.editUrl="/edit_billing_address_individual",n.viewModelUrl="/edit_billing_address_individual_view_model",n.vatClass="grid__item--1-2",n.modalClass="edit-invoice-modal professional-modal"),n}return n.__extends(r,e),r.showInstance=function(e,n){var a=i.createElement(t.EditInvoiceAddressModalLoader,{invoice:e,isTeam:n});d.Modal.showInstance(a)},r.showUpdateTaxProfileModal=function(e,n){var a=i.createElement(t.EditInvoiceAddressModalLoader,{isTeam:e,onUpdated:n});d.Modal.showInstance(a)},r.prototype.componentDidMount=function(){var e=void 0;this.props.invoice&&(e=o.URI.parse(this.props.invoice.link).getQuery().id.toString(),this.disableds.exclusionIdWithTooltip=!0),this.makeRequest(e)},r.prototype.makeRequest=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,a,i;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t={invoice_id:e},[4,_.WebRequest({url:this.viewModelUrl,data:t,dataType:"json"})];case 1:return a=n.sent(),u.hasVat(a.countryCode)&&(this.errorTexts.exclusionId=s._("Please enter a valid VAT number, e.g. %(examples)s.").format({examples:u.getVatExamples(a.countryCode).join(", ")}),this.validateHandlers.exclusionId=function(e){return!e||u.validateVat(a.countryCode,e)}),this.setState({formState:a}),[3,3];case 2:return i=n.sent(),d.Modal.close(),[3,3];case 3:return[2]}})})},r.prototype.render=function(){var e,t=this.state,n=t.formState,a=t.showErrors,r=t.submitting;if(n){var l=null;if(u.hasVat(n.countryCode)){var o=u.getVatPrefix(n.countryCode);l=this.props.invoice?this.renderInput("exclusionIdWithTooltip",this.vatClass):this.renderInput("exclusionId",this.vatClass,o)}e=this.props.isTeam?i.createElement("div",{className:".type--arbor grid__container grid__container--p-large  grid--x-bookend"},this.renderInstructions(n.countryCode),this.renderInput("addressName","grid__item--1-1"),this.renderInput("address","grid__item--1-1"),this.renderInput("city","grid__item--1-2"),this.renderInput("state","grid__item--11-24"),this.renderInput("zip","grid__item--7-24"),this.renderInput("country","grid__item--2-3"),l):i.createElement("div",{className:".type--arbor grid__container grid__container--p-large  grid--x-bookend"},this.renderInput("addressName","grid__item--1-1"),this.renderInput("address","grid__item--1-2"),this.renderInput("city","grid__item--1-4"),this.renderInput("state","grid__item--1-4"),this.renderInput("zip","grid__item--1-2"),this.renderInput("country","grid__item--1-2"),l,this.renderInstructions(n.countryCode))}else e=i.createElement("div",{className:"loading-spinner"},i.createElement("img",{src:p.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:s._("Loading")}));var c=i.createElement(d.ModalButtons,{className:"oq-modal__buttons"},i.createElement(d.ModalButton,{className:"cancel-button",importance:"tertiary",onClick:this.onCancel},s._("Cancel")),i.createElement(d.ModalButton,{disabled:!n||r||a&&!this.isInputValid(),importance:"primary",onClick:this.onSave},s._("Save changes")));return i.createElement(d.Modal,{className:this.modalClass,autoClose:!1,buttonComponent:c,title:s._("Edit invoice details")},i.createElement("div",{className:"dynamic-content"},e))},r.prototype.logActions=function(e){this.props.isTeam?h.TeamsWebActionsLogger.log(e):h.UserActivityLogger.log("web",e)},r.prototype.makeEditBillingAddressRequest=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,i,r;return n.__generator(this,function(n){switch(n.label){case 0:t=this.props.onUpdated,n.label=1;case 1:return n.trys.push([1,3,4,5]),i=this.editUrl,[4,_.WebRequest({url:i,data:e})];case 2:return n.sent(),this.logActions("edit_billing_address_success"),a.Notify.success(s._("Invoice details updated.")),[3,5];case 3:return r=n.sent(),this.logActions("edit_billing_address_edit_failure"),[3,5];case 4:return t&&t(),d.Modal.close(),[7];case 5:return[2]}})})},r.prototype.renderInstructions=function(e){var t,n=this.props.invoice;if(t=n?s._("You are editing details for the %(date)s invoice.").format({date:n.date}):s._("You are editing details for all future invoices. To edit past         invoices, click “Edit” on the invoice item instead."),u.hasVat(e)){var a=s._("Please note that changing your VAT number could impact your           applicable tax rate.");n&&(a=s._("To add or change a VAT number or request a tax refund, contact           support.")),t=t.concat(" ",a)}return i.createElement("div",{className:"grid__item--1-1 instructions"},t)},r.prototype.renderInput=function(e,t,n){var a=this.state,r=a.formState,l=a.showErrors,o="";return r&&(o=r[e]),i.createElement(c.ArborTextInput,{name:e,containerClassName:t,isValid:l?!!this.validateHandlers[e](o)&&"":"",labelText:S[e],errorText:this.errorTexts[e],value:o,onChange:this.onChangeFactory(e),disabled:this.disableds[e],placeholderText:n,maxLength:this.maxLengths[e]})},r.prototype.onChangeFactory=function(e){var t=this;return function(n,a,i){var r=t.state.formState;r&&t.setState(function(t){return r[e]=i,t})}},r.prototype.isInputValid=function(){var e=this.state.formState;return!!e&&(this.validateHandlers.addressName(e.addressName)&&this.validateHandlers.address(e.address)&&this.validateHandlers.city(e.city)&&this.validateHandlers.state(e.state)&&this.validateHandlers.exclusionId(e.exclusionId))},r})(i.Component);t.EditInvoiceAddressModalLoader=r(v,["/static/css/payments/edit_invoice_address_modal/edit_invoice_address_modal-vfl4mD1Gs.css"])}),define("modules/clean/react/payments/pro/components/payments/ideal_form",["require","exports","tslib","external/react","modules/clean/react/payments/common/form_value_helpers","modules/clean/react/payments/pro/components/inputs/inputs","modules/core/i18n"],function(e,t,n,a,i,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onIdealBankChange=function(e){var n=e.value,a=t.props.idealBanks[n];t.props.actions.updateIdealBank({bankId:n,bankName:a})},t}return n.__extends(t,e),t.prototype.idealBankErrorString=function(){var e=this.props.formData.idealBankId;return!i.FormValueHelper.isValid(e)&&e.showError?l._("Please select your bank."):""},t.prototype.render=function(){var e=this.props,t=e.formData,n=e.idealBanks,i=l._("Note: We’ll use your bank information provided by iDEAL     for all future billing cycles. If your bank is not listed, then please select a     different payment method.");return a.createElement("div",null,a.createElement("div",{className:"ideal-fields"},a.createElement(r.LabeledSelectInput,{name:"ideal_bank",labelText:l._("Bank"),value:t.idealBankId.rawValue,onChange:this.onIdealBankChange,errorText:this.idealBankErrorString()},a.createElement("option",{value:"",key:"default","aria-selected":""===t.idealBankId.rawValue},l._("Select your bank...")),Object.keys(n).map(function(e){return a.createElement("option",{value:e,key:e,"aria-selected":t.idealBankId.rawValue===e},n[e])}))),this.props.locationFields,a.createElement("div",{className:"ideal-note"},i))},t})(a.Component);t.IdealForm=o}),define("modules/clean/react/payments/pro/components/payments/payment_info_section",["require","exports","tslib","external/react","modules/clean/analytics","modules/clean/payments/payment_form/payment_form_spec","modules/clean/payments/validation","modules/core/i18n","modules/clean/react/payments/pro/components/inputs/inputs","modules/clean/react/payments/common/form_value_helpers","modules/clean/react/payments/pro/components/payments/ideal_form","modules/clean/react/payments/pro/components/payments/payment_method_selector","modules/clean/react/payments/checkout/components/payment_method_form/credit_card_frame","modules/clean/react/payments/checkout/components/payment_method_form/direct_debit_form"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onCpfChange=function(e){t.props.actions.updateCpf(e.value)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this.props.formData.countryCode.formattedValue;i.ProEventsLogger.log("uj-billing-country",{country:e}),"BR"===e&&this.props.showCpf&&i.ProEventsLogger.log("uj-cpf-viewed-field")},t.prototype.prepareForSubmission=function(){return this.props.formData.paymentMethod.formattedValue===r.PaymentMethod.CreditCard?this.creditCardFrame.tokenize():Promise.resolve(!0)},t.prototype.onCountryCodeChange=function(e){this.props.actions.updateCountryCode(e.value);var t=e.value;i.ProEventsLogger.log("uj-billing-country",{country:t}),"BR"===t&&this.props.showCpf&&i.ProEventsLogger.log("uj-cpf-viewed-field")},t.prototype.onZipCodeChange=function(e){this.props.actions.updateZipCode(e.value)},t.prototype.onVatChange=function(e){this.props.actions.updateVat(e.value)},t.prototype.zipCodeErrorString=function(){var e=this.props.formData.zipCode;return!c.FormValueHelper.isValid(e)&&e.showError?o._("Please enter a valid postal code."):""},t.prototype.vatErrorString=function(){var e=this.props.formData.vat;return!c.FormValueHelper.isValid(e)&&e.showError?o._("Please enter a valid VAT number (ex: %(examples)s).").format({examples:l.getVatExamples(this.props.formData.countryCode.formattedValue).join(", ")}):""},t.prototype.cpfErrorString=function(){var e=this.props.formData.cpf;return!c.FormValueHelper.isValid(e)&&e.showError?o._("Please enter a valid CPF number."):""},t.prototype.renderLocationFields=function(){var e=this.props,t=e.countryList,n=e.paymentSpec,i=e.formData,r=e.isScheduledDowngradeToBasic,c=o._("Postal Code",{comment:"This is the label for the zip code field, and should be kept short."}),u="US"===i.countryCode.formattedValue?o._("Billing ZIP"):c,d=!n.allow_zip_code_for_country(i.countryCode.formattedValue),p=t.map(function(e){var t=e[0],n=e[1];return a.createElement("option",{key:"location-"+t,value:t},n)}),m=null;if(n.should_show_vat_for_country(i.countryCode.formattedValue)){var h=l.getVatPrefix(i.countryCode.formattedValue);m=a.createElement(s.LabeledTextInput,{className:"payment-info__vat",containerClassName:"grid__item--medium--1-2",name:"vat",labelText:o._("VAT number (optional)"),errorText:this.vatErrorString(),placeholder:h,value:i.vat.rawValue,onChange:this.onVatChange.bind(this)})}var _=null;this.props.showCpf&&"BR"===i.countryCode.formattedValue&&(_=a.createElement(s.LabeledTextInput,{className:"payment-info__cpf",containerClassName:"grid__item",name:"cpf",labelText:o._("CPF"),errorText:this.cpfErrorString(),placeholder:"CPF/CNPJ",value:i.cpf.rawValue,onChange:this.onCpfChange}));var g=o._("Please note that changing your billing location      could impact your applicable tax rate.");n.should_show_vat_for_country(i.countryCode.formattedValue)&&(g=o._("Please note that changing your billing location or VAT number      could impact your applicable tax rate."));var f=a.createElement("div",{className:r?"disclaimer-message-full-width":"disclaimer-message"},g,r&&a.createElement("span",null," ",o._("Updating your billing information will cancel your scheduled             plan downgrade. If you still wish to downgrade, you will need to             schedule it again.")));return a.createElement("div",{className:"grid__item"},a.createElement(s.LabeledInputRow,{className:"payment-info__location grid__item grid--x-bookend",errors:[{name:"zip",text:"",className:"grid__item--1-2"}]},a.createElement(s.LabeledTextInput,{className:"payment-info__zip",containerClassName:"grid__item--1-2",name:"zip",labelText:u,value:i.zipCode.rawValue,hasError:!1,disabled:d,onChange:this.onZipCodeChange.bind(this),errorText:this.zipCodeErrorString()}),a.createElement(s.LabeledSelectInput,{className:"payment-info__country",containerClassName:"grid__item--1-2",labelText:o._("Country"),name:"country_code",onChange:this.onCountryCodeChange.bind(this),value:i.countryCode.rawValue},p)),m,_,f)},t.prototype.renderPaymentMethodSelector=function(){var e=this.props,t=e.paymentSpec,n=e.formData,i=e.enableIdealReact;return a.createElement(d.PaymentMethodSelector,{paymentSpec:t,paymentMethod:n.paymentMethod.rawValue,updatePaymentMethod:this.props.actions.updatePaymentMethod,countryCode:n.countryCode.rawValue,zipCode:n.zipCode.rawValue,enableIdealReact:i})},t.prototype.render=function(){var e=this,t=this.props,n=t.actions,i=t.formData,l=t.idealBanks,o=t.enableIdealReact,s=this.renderLocationFields(),c=s;return i.paymentMethod.formattedValue===r.PaymentMethod.DirectDeposit?c=a.createElement(m.DirectDebitForm,{locationFields:s,formData:i,actions:n}):o&&i.paymentMethod.formattedValue===r.PaymentMethod.Ideal&&(c=a.createElement(u.IdealForm,{locationFields:s,formData:i,actions:n,idealBanks:l})),a.createElement("div",{className:"grid__item payment-info"},this.renderPaymentMethodSelector(),a.createElement(p.CreditCardFrame,{getHeightFromIframe:!0,iframeUrl:this.props.iframeUrl,hidden:i.paymentMethod.formattedValue!==r.PaymentMethod.CreditCard,actions:this.props.actions,
ref:function(t){return e.creditCardFrame=t},nonce:i.nonce,bin:i.bin}),c)},t})(a.Component);t.PaymentInfoSection=h}),define("modules/clean/react/payments/pro/components/payments/payment_method_input",["require","exports","tslib","external/react","modules/core/i18n","external/classnames","modules/clean/payments/payment_form/payment_form_spec","modules/clean/react/payments/pro/components/inputs/inputs"],function(e,t,n,a,i,r,l,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.onChange=function(e){this.props.onSelected(this.props.paymentMethod)},t.prototype.render=function(){var e=this.props,t=e.icons,n=e.labelText,s=e.paymentMethod,c=e.numberOfPaymentMethods,u=[],d=["payment-info__option"];3===c?d.push("grid__item--medium--1-4"):4===c?d.push("grid__item--medium--5-24"):d.push("grid__item--medium--1-2");var p;if(n&&(p="payment-method-label#debit",u.push(a.createElement("span",{title:"debit",key:p,className:"debit"},this.props.labelText))),t){if(s===l.PaymentMethod.CreditCard){var m=t.join(", ").replace("_","-"),h=i._("Credit card. We accept %(payment_methods)s").format({payment_methods:m});p="payment-method-label#creditcard",u.push(a.createElement("span",{key:p,className:"ax-visually-hidden"},h))}else s===l.PaymentMethod.PayPal?(p="payment-method-label#paypal",u.push(a.createElement("span",{key:p,className:"ax-visually-hidden"},i._("Paypal")))):s===l.PaymentMethod.Ideal&&(p="payment-method-label#ideal",u.push(a.createElement("span",{key:p,className:"ax-visually-hidden"},i._("iDEAL"))));for(var _=0,g=t;_<g.length;_++){var f=g[_];p="payment-method-icon#"+f,u.push(a.createElement("span",{title:f,key:p,className:f}))}}return a.createElement("div",{className:r(d)},a.createElement(o.LabeledRadioInput,{name:"payment_method",className:"payment-info__payment",value:s.toString(),checked:this.props.selected,onClick:this.onChange.bind(this),onChange:function(){}}),a.createElement("label",{htmlFor:"payment_method_"+s,id:"payment_method_"+s,className:"payment-info__method-label",onClick:this.onChange.bind(this)},u))},t})(a.Component);t.PaymentMethodInput=s}),define("modules/clean/react/payments/pro/components/payments/payment_method_selector",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/payments/payment_form/payment_form_spec","modules/clean/react/payments/pro/components/payments/payment_method_input"],function(e,t,n,a,i,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onPaymentMethodSelected=function(e){t.props.updatePaymentMethod(e)},t}return n.__extends(t,e),t.prototype.getLabelForMethodId=function(e){return e===r.PaymentMethod.CreditCard?a.createElement(l.PaymentMethodInput,{key:"payment-method#"+e,paymentMethod:r.PaymentMethod.CreditCard,selected:this.props.paymentMethod===r.PaymentMethod.CreditCard,onSelected:this.onPaymentMethodSelected.bind(this),icons:this.props.paymentSpec.supported_credit_cards_for_country(this.props.countryCode),numberOfPaymentMethods:this.props.paymentSpec.available_payment_methods_for_country(this.props.countryCode).length}):e===r.PaymentMethod.PayPal?a.createElement(l.PaymentMethodInput,{key:"payment-method#"+e,paymentMethod:r.PaymentMethod.PayPal,selected:this.props.paymentMethod===r.PaymentMethod.PayPal,onSelected:this.onPaymentMethodSelected,icons:["paypal"],numberOfPaymentMethods:this.props.paymentSpec.available_payment_methods_for_country(this.props.countryCode).length}):e===r.PaymentMethod.DirectDeposit?a.createElement(l.PaymentMethodInput,{key:"payment-method#"+e,paymentMethod:r.PaymentMethod.DirectDeposit,selected:this.props.paymentMethod===r.PaymentMethod.DirectDeposit,onSelected:this.onPaymentMethodSelected,labelText:i._("Direct Debit"),numberOfPaymentMethods:this.props.paymentSpec.available_payment_methods_for_country(this.props.countryCode).length}):this.props.enableIdealReact&&e===r.PaymentMethod.Ideal?a.createElement(l.PaymentMethodInput,{key:"payment-method#"+e,paymentMethod:r.PaymentMethod.Ideal,selected:this.props.paymentMethod===r.PaymentMethod.Ideal,onSelected:this.onPaymentMethodSelected,icons:["ideal"],numberOfPaymentMethods:this.props.paymentSpec.available_payment_methods_for_country(this.props.countryCode).length}):null},t.prototype.render=function(){var e=this,t=this.props,n=t.countryCode,i=t.paymentSpec,r=i.available_payment_methods_for_country(n),l=r.map(function(t){return e.getLabelForMethodId(t)});return a.createElement("div",{className:"payment-info__selector grid__item grid__container--p-small"},l)},t})(a.Component);t.PaymentMethodSelector=o}),define("modules/clean/react/payments/update_billing_individual/action_creator",["require","exports","external/redux","modules/clean/react/payments/common/form/actions/actions","modules/clean/react/payments/update_billing_individual/actions"],function(e,t,n,a,i){"use strict";function r(e){return n.bindActionCreators(l(),e.dispatch)}function l(){return{submitBillingForm:i.submitBillingForm,updatePaymentMethod:a.updatePaymentMethod,updateCountryCode:i.updateBillingCountryCode,updateZipCode:a.updateZipCode,updateVat:a.updateVat,updateCpf:a.updateCpf,updateNonce:a.updateNonce,updateBIN:a.updateBIN,updateAccountHolderName:a.updateAccountHolderName,updateIBAN:a.updateIBAN,updateMandateSigned:a.updateMandateSigned,updateIdealBank:a.updateIdealBank}}Object.defineProperty(t,"__esModule",{value:!0}),t.bindBillingActions=r}),define("modules/clean/react/payments/update_billing_individual/actions",["require","exports","modules/core/i18n","modules/core/notify","modules/clean/payments/payment_form/payment_form_spec","modules/clean/react/payments/common/form/actions/actions"],function(e,t,n,a,i,r){"use strict";function l(e,t){return function(n,a){var l=a(),o=l.formData,s=o.countryCode.formattedValue,c=l.pageState.paymentFormSpec,u=["countryCode"];c.allow_zip_code_for_country(s)&&u.push("zipCode"),c.should_show_vat_for_country(s)&&u.push("vat"),t&&"BR"===s&&u.push("cpf");var d;l.formData.paymentMethod.formattedValue===i.PaymentMethod.CreditCard?(u.push("nonce"),u.push("bin"),d="/update_credit_card_billing_info_ajax"):l.formData.paymentMethod.formattedValue===i.PaymentMethod.DirectDeposit?(u.push("accountHolderName","iban","mandateSigned"),d="/update_direct_debit_billing_info_ajax"):l.formData.paymentMethod.formattedValue===i.PaymentMethod.Ideal?(u.push("idealBankId","idealBankName"),d="/update_ideal_billing_info_ajax"):d="/paypal_billing_info",n(r.submitForm(d,u,e,{}))}}function o(e){return function(t,i){var l=i(),o=l.pageState.countryToCurrencyMap;!(e in o)&&l.formData.countryCode.formattedValue in o?a.Notify.error(n._("You can’t change to a country with a different currency. For help, contact support."),3):t(r.updateCountryCode(e))}}Object.defineProperty(t,"__esModule",{value:!0}),t.submitBillingForm=l,t.updateBillingCountryCode=o}),define("modules/clean/react/payments/update_billing_individual/individual_update_billing_modal",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/react/payments/update_billing_individual/store_creator","modules/clean/react/payments/update_billing_individual/action_creator","modules/clean/react/payments/update_billing_individual/reducers","modules/clean/react/payments/pro/components/payments/payment_info_section","modules/clean/payments/payment_form/payment_form_spec","modules/clean/analytics"],function(e,t,n,a,i,r,l,o,s,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(t){var n=e.call(this,t)||this;return n.prepareForSubmission=function(){return n.paymentInfoSection.prepareForSubmission()},n.savePaymentInfoSection=function(e){n.paymentInfoSection=e},n.store=r.createBillingStore(t,o.BillingReducer),n.state=n.store.getState(),n.store.subscribe(function(){var e=n.store.getState();e.pageState.submitSuccess||n.setState(function(t){return n.props.setSubmittingStatus(e.pageState.submitting),e})}),n}return n.__extends(t,e),Object.defineProperty(t.prototype,"actions",{get:function(){return l.bindBillingActions(this.store)},enumerable:!0,configurable:!0}),t.prototype.logVatChange=function(e,t){null===e&&(e=""),null===t&&(t=""),""===e&&""!==t?u.ProEventsLogger.log("update_billing_added_vat"):""!==e&&""===t?u.ProEventsLogger.log("update_billing_removed_vat"):e!==t&&u.ProEventsLogger.log("update_billing_updated_vat")},t.prototype.onAccept=function(){u.ProEventsLogger.log("update_billing_open_save_changes_click"),this.logVatChange(this.props.vat,this.state.formData.vat.formattedValue),this.actions.submitBillingForm(this.prepareForSubmission,this.props.showCpf)},t.prototype.onDismiss=function(){u.ProEventsLogger.log("update_billing_open_cancel")},t.prototype.render=function(){var e,t=this.props,n=t.iframeUrl,r=t.countryList,l=t.idealBanks,o=t.enableIdealReact,u=t.userInfo,d=t.isScheduledDowngradeToBasic,p=this.state,m=p.formData,h=p.pageState;if(m.paymentMethod.rawValue===c.PaymentMethod.PayPal)e=a.createElement("div",{className:"payment-method-disclaimer","data-payment-method-id":"{payment_method.ID}"},i._("You’ll be redirected to PayPal to finish updating your billing information."));else if(m.paymentMethod.rawValue===c.PaymentMethod.Ideal){var _=void 0;_=this.props.idealChargeAmount,e=a.createElement("div",{className:"payment-method-disclaimer","data-payment-method-id":"{payment_method.ID}"},i._("We’ll be charging you %(ideal_charge_amt)s to validate the account when                       you update your bank account information.").format({ideal_charge_amt:_}))}else e=null;return a.createElement("div",{className:"payment-info-section"},a.createElement("div",{className:"payment-method-section grid__container"},a.createElement(s.PaymentInfoSection,{paymentSpec:h.paymentFormSpec,iframeUrl:n,countryList:r,formData:m,actions:this.actions,ref:this.savePaymentInfoSection,idealBanks:l,enableIdealReact:o,userInfo:u,isScheduledDowngradeToBasic:d,showCpf:this.props.showCpf}),e))},t})(a.Component);t.IndividualUpdateBillingModal=d}),define("modules/clean/react/payments/update_billing_individual/individual_update_billing_modal_loader",["require","exports","tslib","external/react","spectrum/button","modules/core/notify","modules/core/i18n","modules/clean/analytics","modules/clean/ajax","modules/clean/react/css","modules/clean/react/modal","modules/clean/react/payments/update_billing_individual/individual_update_billing_modal","modules/clean/static_urls"],function(e,t,n,a,i,r,l,o,s,c,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function c(){var t=e.call(this)||this;return t.onAccept=function(){t.updateBillingModal&&t.updateBillingModal.onAccept(),o.UserActivityLogger.log("web","update_billing_modal_started")},t.onDismiss=function(){t.updateBillingModal&&t.updateBillingModal.onDismiss(),o.UserActivityLogger.log("web","update_billing_modal_cancelled"),u.Modal.close()},t.saveUpdateBillingModal=function(e){t.updateBillingModal=e},t.setSubmittingStatus=function(e){t.setState(function(t){return t.submitting=e,t})},t.state={loadingContent:!0,submitting:!1},t}return n.__extends(c,e),c.showInstance=function(){u.Modal.showInstance(a.createElement(t.IndividualUpdateBillingModalLoader,null))},c.prototype.componentDidMount=function(){var e=this;s.WebRequest({url:"/account/profile/billing_info",success:function(t){var n=JSON.parse(t);e.setState(function(e){return e.loadedProps={countryList:n.countryList,iframeUrl:n.iframeUrl,countryToCurrencyMap:n.countryToCurrencyMap,userInfo:n.userInfo,idealBanks:n.idealBanks,enableIdealReact:n.enableIdealReact,countryCode:n.countryCode,serializedPaymentFormSpec:n.serializedPaymentFormSpec,idealChargeAmount:n.idealChargeAmount,isScheduledDowngradeToBasic:n.isScheduledDowngradeToBasic,vat:n.vat,showCpf:n.showCpf},e.loadingContent=!1,e}),o.UserActivityLogger.log("web","update_billing_modal_success")},error:function(){r.Notify.error(l._("Failed to load modal.")),o.UserActivityLogger.log("web","update_billing_modal_failure"),u.Modal.close()}})},c.prototype.renderButtons=function(){var e=this.state,t=e.loadingContent,n=e.submitting;return a.createElement(u.ModalButtons,{className:"oq-modal__buttons"},a.createElement(i.Button,{className:"cancel-button",variant:"secondary",onClick:this.onDismiss},l._("Cancel")),a.createElement(i.Button,{disabled:t||n,variant:"primary",onClick:this.onAccept},l._("Save changes")))},c.prototype.renderContent=function(){var e=this.state,t=e.loadingContent,n=e.loadedProps;if(t)return a.createElement("div",{className:"loading-spinner"},a.createElement("img",{src:p.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:l._("Loading")}));var i=n,r=i.countryList,o=i.iframeUrl,s=i.countryToCurrencyMap,c=i.countryCode,u=i.serializedPaymentFormSpec,m=i.userInfo,h=i.idealBanks,_=i.enableIdealReact,g=i.idealChargeAmount,f=i.isScheduledDowngradeToBasic,b=i.vat,y=i.showCpf;return a.createElement(d.IndividualUpdateBillingModal,{iframeUrl:o,countryList:r,countryToCurrencyMap:s,countryCode:c,serializedPaymentFormSpec:u,userInfo:m,idealBanks:h,enableIdealReact:_,setSubmittingStatus:this.setSubmittingStatus,ref:this.saveUpdateBillingModal,idealChargeAmount:g,isScheduledDowngradeToBasic:f,vat:b,showCpf:y})},c.prototype.render=function(){return a.createElement(u.Modal,{className:"update-billing-modal",autoClose:!1,buttonComponent:this.renderButtons(),title:l._("Update billing information")},a.createElement("div",{className:"dynamic-content"},this.renderContent()))},c})(a.Component);t.UpdateBillingModalLoaderView=m,t.IndividualUpdateBillingModalLoader=c(m,["/static/css/pro/components/update_billing_modal_individual-vflWTeyle.css"])}),define("modules/clean/react/payments/update_billing_individual/reducers",["require","exports","external/lodash","modules/clean/dbmodal_stack","modules/core/i18n","modules/core/notify","modules/clean/payments/billing_info_modal","modules/clean/react/modal","modules/clean/top_notif","modules/clean/react/payments/common/form/reducers/reducers","modules/clean/react/payments/common/payments/reducers/reducers","modules/clean/react/payments/common/pricing/reducers/reducers","modules/clean/analytics"],function(e,t,n,a,i,r,l,o,s,c,u,d,p){"use strict";function m(e,t){for(var n=0,a=f;n<a.length;n++){var i=a[n];i instanceof m?e=i(e,t):void 0!==i&&(e=i(e,t))}return e}function h(e,t){if("SubmitFormSuccess"!==t.type)return e;var c=n.assignIn({},e.pageState,{submitSuccess:!0});return e=n.assignIn({},e,{pageState:c}),r.Notify.success(i._("We’ve successfully updated your account’s billing information.")),p.ProEventsLogger.log("update_billing_open_save_changes_success"),s.TopNotificationBar.hideById("rebill-bar"),o.Modal.close(),a.DBModalStack.trigger(l.BILLING_INFO_UPDATED,null),e}Object.defineProperty(t,"__esModule",{value:!0});var _=u.PaymentMethodReducers.map(function(e){return function(t,a){var i=e(t,a),r=n.assignIn(t.pageState,i.pageState),l=n.assignIn(t.pricingState,i.pricingState),o=n.assignIn(t.formData,i.formData);return n.assignIn(t,{pageState:r,pricingState:l,formData:o})}}),g=c.FormManagementReducers.filter(function(e){return e!==c.submitFormSuccess}),f=(new Array).concat([h],g,_,d.TransitionManagementReducers);t.BillingReducer=m}),define("modules/clean/react/payments/update_billing_individual/store_creator",["require","exports","external/redux","external/redux-thunk","modules/clean/react/payments/common/payments/state/store_creator","modules/clean/react/payments/common/form_value_factory"],function(e,t,n,a,i,r){"use strict";function l(e,t){var i=o(e),r=n.applyMiddleware(a);return n.createStore(t,i,r)}function o(e){var t=c(e),n=s(e);return{pricingState:n,pageState:t,formData:u(e,t,n)}}function s(e){var t=i.createPaymentPricingState(e);return{countryCode:t.countryCode,countryCodeLoading:t.countryCodeLoading,hasCurrencyChanged:t.hasCurrencyChanged,hasTaxChangedWithinCountry:t.hasTaxChangedWithinCountry,loadingPrices:t.loadingPrices,requestToken:t.requestToken,recentLoadEvent:t.recentLoadEvent}}function c(e){var t=i.createPaymentPageState(e).paymentFormSpec;return{countryToCurrencyMap:e.countryToCurrencyMap,submitSuccess:!1,submitState:null,submitting:!1,paymentFormSpec:t}}function u(e,t,n){var a=e.vat,l=e.cpf,o=e.countryCode,s=i.createPaymentFormData(e,t,n),c=s.paymentMethod,u=s.countryCode,d=s.zipCode,p=s.vat,m=s.cpf,h=s.nonce,_=s.bin,g=s.accountHolderName,f=s.iban,b=s.mandateSigned,y=s.termsAndService,S=s.idealBankId,v=s.idealBankName;return{paymentMethod:c,countryCode:u,zipCode:d,vat:a?r.FormValueFactory.createVat(a,o):p,cpf:l?r.FormValueFactory.createCpf(l,o):m,nonce:h,bin:_,accountHolderName:g,iban:f,mandateSigned:b,termsAndService:y,idealBankId:S,idealBankName:v}}Object.defineProperty(t,"__esModule",{value:!0}),t.createBillingStore=l,t.createFormData=u}),define("modules/clean/teams/admin/lib/billing_history",["require","exports","modules/clean/teams/admin/types/billing_history"],function(e,t,n){"use strict";function a(e){for(var t=[],a=0;a<e.length;a++){var i=e[a];if(a<e.length-1){var l=e[a+1],o=r(l)||r(i);if(i.type===n.BillingRowType.Payment&&l.type===n.BillingRowType.Invoice&&(l.billed===i.paid||l.billed==="("+i.paid+")"||o)&&l.date===i.date){var s={id:a,invoice:l,payment:i,isMobile:o};t.push(s),a++;continue}}i.type===n.BillingRowType.Payment?t.push({id:a,payment:i}):t.push({id:a,invoice:i})}return t}function i(e,n){void 0===n&&(n=t.SelectedYearTypes.ALL_TIME);var i=a(e),r=(new Date).getFullYear().toString();return n===t.SelectedYearTypes.ALL_TIME||(i=n===t.SelectedYearTypes.YEAR_TO_DATE?i.filter(function(e){return e.payment?e.payment.date.indexOf(r)!==-1:!!e.invoice&&e.invoice.date.indexOf(r)!==-1}):i.filter(function(e){return e.payment?e.payment.date.indexOf(n)!==-1:!!e.invoice&&e.invoice.date.indexOf(n)!==-1})),i=i.filter(function(e){return e.invoice&&null!==e.invoice.description||e.payment&&null!==e.payment.description})}function r(e){var t=e.description;return!!t&&(t.indexOf("Google")!==-1||t.indexOf("Apple")!==-1)}Object.defineProperty(t,"__esModule",{value:!0}),t.SelectedYearTypes={ALL_TIME:"all-time",YEAR_TO_DATE:"year-to-date"},t.getHistoryData=i}),define("modules/clean/teams/admin/types/billing_history",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});(function(e){e[e.Invoice=0]="Invoice",e[e.Payment=1]="Payment",e[e.Legacy=2]="Legacy"})(t.BillingRowType||(t.BillingRowType={}))}),define("modules/clean/teams/admin/widgets/admin_priced_list/admin_priced_list",["require","exports","tslib","external/react","modules/clean/react/css"],function(e,t,n,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){return a.createElement("div",{className:"admin-priced-list"},a.createElement("div",null,this.props.children))},t})(a.Component);t.AdminPricedList=i(r,["/static/css/teams/admin/widgets/admin_priced_list/admin_priced_list-vflMAA6ZU.css"])}),define("modules/clean/teams/admin/widgets/admin_priced_list/admin_priced_list_item",["require","exports","tslib","external/react","external/classnames"],function(e,t,n,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChange=function(){},t}return n.__extends(t,e),t.prototype.renderTitleWarningText=function(){var e=this.props.titleWarningText;if(e)return a.createElement("span",{className:"admin-priced-list-item__content_title_warning"}," ",e)},t.prototype.renderTitleSecondaryText=function(){var e=this.props.titleSecondaryText;if(e)return a.createElement("span",{className:"admin-priced-list-item__content_title_secondary"}," ",e)},t.prototype.getClickHandler=function(){if(!this.props.disableItem)return this.props.onClick},t.prototype.render=function(){var e=this.props,t=e.description,n=e.price,r=e.title,l=e.unit,o=e.detailsLink,s=e.disableItem,c=this.props.className?this.props.className:"",u=n?n.toString():"-",d=n?l:"",p=i((m={"admin-priced-list-item":!0,active:this.props.isSelected===!0},m[c]=!0,m.disabled=s,m));return a.createElement("div",{className:p,onClick:this.getClickHandler()},a.createElement("div",{className:"admin-priced-list-item__content"},a.createElement("div",{className:"admin-priced-list-item__content_title"},a.createElement("input",{type:"radio",checked:this.props.isSelected,onChange:this.onChange,disabled:this.props.disableItem}),a.createElement("h1",{className:"f1"},r,this.renderTitleWarningText(),this.renderTitleSecondaryText())),a.createElement("div",{className:"admin-priced-list-item__content_description u-font-meta"},t,o)),a.createElement("div",{className:"admin-priced-list-item__pricing"},a.createElement("div",{className:"admin-priced-list-item__pricing_price"},u),a.createElement("div",{className:"admin-priced-list-item__pricing_unit"},d)));var m},t})(a.Component);t.AdminPricedListItem=r}),define("modules/clean/teams/admin/widgets/billing_history/billing_history_row",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/react/payments/edit_invoice_address_modal/edit_invoice_address_modal_loader","modules/clean/analytics","modules/clean/react/tooltip","modules/clean/react/sprite"],function(e,t,n,a,i,r,l,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c;(function(e){e[e.invoice=0]="invoice",e[e.receipt=1]="receipt"})(c||(c={}));var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onEdit=function(){var e=t.props,n=e.row,a=e.isTeam;n.invoice&&r.EditInvoiceAddressModalLoader.showInstance(n.invoice,a)},t.logReceiptLinkClick=function(){t.props.logAccountBillingTabEvents&&l.ProEventsLogger.log("de_billing_tab_receipt_link_click")},t.logInvoiceLinkClick=function(){t.props.logAccountBillingTabEvents&&l.ProEventsLogger.log("de_billing_tab_invoice_link_click")},t}return n.__extends(t,e),t.prototype.renderCombinedRecords=function(e,t){return a.createElement("tr",{className:"row-content"},a.createElement("td",{className:"row-content__date"},this.renderDate()),a.createElement("td",{className:"row-content__description"},this.renderDescription()),a.createElement("td",{className:"row-content__links"},this.renderLinks()),a.createElement("td",{className:"row-content__price"},this.renderPrice()))},t.prototype.renderSingleRecord=function(e,t){var n=null;e.isVoided&&(n=a.createElement("span",null," (",i._("Voided"),")"));var r=null;if(e.link){var l=i._("Receipt"),u=this.logReceiptLinkClick;t===c.invoice&&(l=i._("Invoice"),u=this.logInvoiceLinkClick),r=a.createElement("td",{className:"row-content__links"},a.createElement("span",null,a.createElement("a",{href:e.link,target:"_blank",rel:"noopener noreferrer",onClick:u},l)))}else if(e.infoTooltip){var d=a.createElement(o.Tooltip,{position:o.TooltipPosition.TOP,tooltip_contents:e.infoTooltip},a.createElement(s.Sprite,{group:"teams",name:"info_active",alt:"",className:"info-sprite"}));r=a.createElement("td",{className:"row-content__links"},d)}else r=a.createElement("td",{className:"row-content__links"});var p=a.createElement("div",null,a.createElement("p",{className:"description-line"},a.createElement("span",null,e.description),n)),m=t===c.receipt?e.paid:e.billed;return a.createElement("tr",{className:"row-content"},a.createElement("td",{className:"row-content__date"},e.date),a.createElement("td",{className:"row-content__description"},p),r,a.createElement("td",{className:"row-content__price"},m))},t.prototype.renderWithoutSingleRowEdit=function(){var e=this.props.row;return e.payment&&e.invoice?this.renderCombinedRecords(e.invoice,e.payment):e.payment?this.renderSingleRecord(e.payment,c.receipt):e.invoice?this.renderSingleRecord(e.invoice,c.invoice):a.createElement("noscript",null)},t.prototype.renderDate=function(){var e=this.props.row,t=e.invoice,n=e.payment;return t&&t.date?t.date:n&&n.date?n.date:null},t.prototype.renderDescription=function(){var e=this.props.row,t=e.invoice,n=e.payment,r=e.isMobile,l=null,o=null;return t&&t.description?l=t.description:n&&n.description&&(l=n.description),r&&t&&t.description&&n&&n.description&&(l=n.description+" | "+t.description),(t&&t.isVoided||n&&n.isVoided)&&(o=a.createElement("span",null," (",i._("Voided"),")")),a.createElement("div",null,a.createElement("p",{className:"description-line"},a.createElement("span",null,l),o))},t.prototype.renderLinks=function(){if(this.props.renderLinks!==!1){var e=this.props,t=e.row,n=e.showEditInvoiceModal,r=e.canEditBilling,l=t.invoice,o=t.payment,s=[];return l&&l.link&&s.push(a.createElement("a",{key:"invoice-link",href:l.link,target:"_blank",rel:"noopener noreferrer",onClick:this.logInvoiceLinkClick},i._("Invoice"))),!t.isMobile&&o&&o.link&&s.push(a.createElement("a",{key:"payment-link",href:o.link,target:"_blank",rel:"noopener noreferrer",onClick:this.logReceiptLinkClick},i._("Receipt"))),n&&l&&!l.isOpen&&l.isEditable&&r&&s.push(a.createElement("button",{key:"edit-link",className:"button-as-link",onClick:this.onEdit},i._("Edit"))),s.length||(l&&l.infoTooltip?s.push(this.renderInfoTooltip(l)):o&&o.infoTooltip&&s.push(this.renderInfoTooltip(o))),s.length?a.createElement("span",null,s):null}},t.prototype.renderInfoTooltip=function(e){return a.createElement(o.Tooltip,{position:o.TooltipPosition.TOP,tooltip_contents:e.infoTooltip},a.createElement(s.Sprite,{group:"teams",name:"info_active",alt:"",className:"info-sprite"}))},t.prototype.renderPrice=function(){var e=this.props.row,t=e.invoice,n=e.payment;if(e.isMobile)return null;var i=null;return t&&n?i=t.isVoided||n.isVoided?a.createElement("span",{className:"row-content__price--line-through"},t.billed):t.billed:n?i=n.paid:t&&(i=t.billed),i},t.prototype.renderWithSingleRowEdit=function(){var e=this.props.row;return e.invoice||e.payment?a.createElement("tr",{className:"row-content","data-variant":!0},a.createElement("td",{className:"row-content__date"},this.renderDate()),a.createElement("td",{className:"row-content__description"},this.renderDescription()),a.createElement("td",{className:"row-content__links"},this.renderLinks()),a.createElement("td",{className:"row-content__price"},this.renderPrice())):null},t.prototype.render=function(){return this.props.showSingleRowEdit?this.renderWithSingleRowEdit():this.renderWithoutSingleRowEdit()},t.defaultProps={canEditBilling:!0},t})(a.Component);t.BillingHistoryTableRow=u}),define("modules/clean/teams/admin/widgets/billing_history/billing_history_table",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/teams/admin/widgets/billing_history/billing_history_row"],function(e,t,n,a,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.buildFooterIfNecessary=function(){if(null!==this.props.footer)return a.createElement("tfoot",{className:"row-footer"},this.props.footer)},t.prototype.render=function(){var e,t=this.props,n=t.amountLabel,l=t.canEditBilling,o=t.displayNoTransactionsOnEmptyRecords,s=t.showEditInvoiceModal,c=t.showSingleRowEdit,u=t.logAccountBillingTabEvents,d=t.isTeam,p=t.renderLinks,m=this.props.billingHistoryRecords,h=n?n:i._("Price");if(o&&0===m.length){var _=this.props.noTransactionLabel?this.props.noTransactionLabel:i._("No transactions");e=a.createElement("tr",{className:"row-content"},a.createElement("td",{className:"row-content__date"}),a.createElement("td",{className:"row-content__description"},_),a.createElement("td",{className:"row-content__links"}),a.createElement("td",{className:"row-content__price"}))}return a.createElement("div",null,a.createElement("table",{className:"billing-history-table",cellSpacing:"0"},a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",{className:"row-header date-row u-font-meta"},i._("Date")),a.createElement("th",{className:"row-header desc-row u-font-meta",colSpan:2},i._("Description")),a.createElement("th",{className:"row-header price-row u-font-meta"},h))),this.buildFooterIfNecessary(),a.createElement("tbody",null,e,m.map(function(e,t){return a.createElement(r.BillingHistoryTableRow,{canEditBilling:l,isTeam:d,key:e.id,logAccountBillingTabEvents:u,renderLinks:p,row:e,showEditInvoiceModal:s,showSingleRowEdit:c})}))))},t})(a.Component);t.BillingHistoryTable=l}),define("modules/clean/teams/admin/widgets/billing_notifications/cancel_billing_changes_modal",["require","exports","tslib","modules/core/i18n","modules/clean/react/modal","modules/clean/payments/skus/subscription_change_plan","modules/clean/payments/skus/subscription_diff","modules/clean/payments/skus/subscription_service","modules/constants/trademark","modules/clean/ajax","modules/clean/dbmodal_stack","modules/core/notify","external/react","modules/clean/teams/admin/widgets/change_plan_modal/change_plan_constants"],function(e,t,n,a,i,r,l,o,s,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h;(function(e){e[e.ALL=1]="ALL",e[e.PLAN=2]="PLAN",e[e.SCHEDULE=3]="SCHEDULE",e[e.LICENSES=4]="LICENSES",e[e.EVH_ADDON=5]="EVH_ADDON",e[e.IND_SUBSCRIPTION=6]="IND_SUBSCRIPTION"})(h=t.CancellationType||(t.CancellationType={}));var _=(function(e){function t(t){var n=e.call(this,t)||this;return n.onAccept=function(){switch(n.props.cancellationType){case h.PLAN:n.cancelPlanOrBillingScheduledChange(h.PLAN);break;case h.SCHEDULE:n.cancelPlanOrBillingScheduledChange(h.SCHEDULE);break;case h.LICENSES:n.cancelLicensesScheduledChanges();break;case h.ALL:n.cancelAll()}},n.subService=new o.SubscriptionService,n.state={submitting:!1},n}return n.__extends(t,e),t.showInstance=function(e){i.Modal.showInstance(p.createElement(t,n.__assign({},e)))},t.prototype.submittingRequest=function(){this.setState(function(e){return e.submitting=!0,e})},t.prototype.doneSubmittingRequest=function(){this.setState(function(e){return e.submitting=!1,e})},t.prototype.cancelAll=function(){var e=this,t=this.props,n=t.transitionPerformed,r=t.subStatus;this.submittingRequest();var o=l.SubscriptionDiff.fromSubscriptionState(r.subState);this.subService.validateAndPerformTransition(o).then(function(t){d.Notify.success(a._("Your scheduled changes have been cancelled!")),n&&n(t),i.Modal.close(),e.props.reOpenModalDialogAfterCancellation&&u.DBModalStack.trigger(m.CHANGE_PLAN_DUAL_MODAL_UPDATED,null)}).finally(function(){e.doneSubmittingRequest()})},t.prototype.cancelLicensesScheduledChanges=function(){var e=this,t=this.props.subStatus,n=l.SubscriptionDiff.fromSubscriptionStatus(t);this.submittingRequest(),n.setTotalLicenses(t.subState.totalLicenses),this.subService.price(n).then(function(t){e.subService.performTransition(t).then(function(t){e.props.transitionPerformed&&e.props.transitionPerformed(t),d.Notify.success(a._("You’ve cancelled your change!")),e.doneSubmittingRequest(),i.Modal.close(),e.props.reOpenModalDialogAfterCancellation&&u.DBModalStack.trigger(m.CHANGE_PLAN_DUAL_MODAL_UPDATED,null)}).catch(function(){e.errorUpdatingChanges()})}).catch(function(){e.errorUpdatingChanges()})},t.prototype.errorUpdatingChanges=function(){d.Notify.error(a._("Failed to revert changes.")),this.doneSubmittingRequest(),i.Modal.close()},t.prototype.cancelPlanOrBillingScheduledChange=function(e){var t,n,l=this,o=this.props,s=o.transitionPerformed,p=o.subStatus;this.submittingRequest(),c.WebRequest({url:"/account/team/change_plan_modal_view_model",success:function(o){if(t=JSON.parse(o).serializedSubChangePlans.map(function(e){return r.SubscriptionChangePlan.deserialize(e)}),n=t.filter(function(t){
return!!(t.finalSubState&&t.finalSubState.plan&&t.finalSubState.billingSchedule&&p.subState&&p.subState.plan&&p.finalSubState&&p.finalSubState.billingSchedule&&p.finalSubState.plan&&p.subState.billingSchedule)&&(e===h.PLAN?p.subState.plan.productType===t.finalSubState.plan.productType&&p.finalSubState.billingSchedule.id===t.finalSubState.billingSchedule.id:e===h.SCHEDULE&&p.finalSubState.plan.productType===t.finalSubState.plan.productType&&p.subState.billingSchedule.id===t.finalSubState.billingSchedule.id)}),n.length>0){var c=n[0];l.subService.performTransition(c).then(function(e){d.Notify.success(a._("You’ve cancelled your change!")),s&&s(e),l.doneSubmittingRequest(),i.Modal.close(),l.props.reOpenModalDialogAfterCancellation&&u.DBModalStack.trigger(m.CHANGE_PLAN_DUAL_MODAL_UPDATED,null)})}else d.Notify.error(a._("Failed to revert changes."))},error:function(){d.Notify.error(a._("Failed to load modal.")),l.doneSubmittingRequest(),i.Modal.close(),l.props.reOpenModalDialogAfterCancellation&&u.DBModalStack.trigger(m.CHANGE_PLAN_DUAL_MODAL_UPDATED,null)}})},t.prototype.render=function(){var e=this.props,t=e.cancellationType,n=e.subStatus;if(!n.subState.plan||!n.subState.billingSchedule)return p.createElement("noscript",null);var r,l=a._("Confirm cancelled change");switch(t){case h.PLAN:r=a._("You’re cancelling your scheduled changes. Your %(trademark_business)s %(plan)s plan           will renew on %(date)s and you will be billed %(schedule)s.").format({trademark_business:s.TRADEMARK_BUSINESS,plan:n.subState.plan.displayName(),date:n.subState.formattedNextBillingDate,schedule:n.subState.billingSchedule.scheduleDescriptionAdjective});break;case h.SCHEDULE:r=a._("You’re cancelling your scheduled changes. Your %(trademark_business)s %(plan)s plan           will renew on %(date)s and you will be billed %(schedule)s.").format({trademark_business:s.TRADEMARK_BUSINESS,plan:n.subState.plan.displayName(),date:n.subState.formattedNextBillingDate,schedule:n.subState.billingSchedule.scheduleDescriptionAdjective});break;case h.LICENSES:r=a._("You’re cancelling your scheduled changes. Your %(trademark_business)s %(plan)s plan           will renew on %(date)s and you will be billed %(schedule)s.").format({trademark_business:s.TRADEMARK_BUSINESS,plan:n.subState.plan.displayName(),date:n.subState.formattedNextBillingDate,schedule:n.subState.billingSchedule.scheduleDescriptionAdjective});break;case h.ALL:l=a._("Confirmation"),r=a._("By confirming, all existing scheduled changes will be cancelled.");break;default:l=a._("Confirmation"),r=a._("By confirming, all existing scheduled changes will be cancelled.")}return p.createElement(i.Modal,{acceptButtonDisabled:this.state.submitting,acceptButtonText:a._("Confirm"),autoClose:!1,dismissButtonText:a._("Don’t cancel"),onAccept:this.onAccept,title:l,submitting:this.state.submitting},p.createElement("p",null,r))},t})(p.Component);t.CancelBillingChangesConfirmationView=_}),define("modules/clean/teams/admin/widgets/billing_notifications/cancellable_item",["require","exports","tslib","external/react","modules/core/i18n","external/classnames"],function(e,t,n,a,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.title,n=e.description,l=e.handleAction,o=e.useSingleCancelLink,s=e.editInsteadOfCancel,c=this.props.className?this.props.className:"",u=r((p={"cancellable-item__button":!0,"link-button":!0},p[c]=!0,p)),d=a.createElement("button",{className:u,onClick:l},i._("Cancel change"));return o&&(d=void 0),s&&(d=a.createElement("button",{className:u,onClick:l},i._("Edit change"))),a.createElement("div",{className:"cancellable-item"},a.createElement("span",{className:"cancellable-item__title"},t)," ",a.createElement("span",{className:"cancellable-item__desc"},n),d);var p},t})(a.Component);t.CancellableItemView=l}),define("modules/clean/teams/admin/widgets/change_plan_modal/change_plan_constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CHANGE_PLAN_DUAL_MODAL_UPDATED="change_plan_dual_modal:updated";(function(e){e[e.PLAN_CHANGE=1]="PLAN_CHANGE",e[e.SCHEDULE_CHANGE=2]="SCHEDULE_CHANGE"})(t.DualPlanModalMode||(t.DualPlanModalMode={}))});
//# sourceMappingURL=pkg-account_subscription.min.js-vfllIHj4C.map